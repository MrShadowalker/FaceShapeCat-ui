import{d as q,f as c,w as p,Y as B,a6 as _,ab as j}from"./tinymce-vendor-3c2b3d6e.js";import{useRuleFormItem as J}from"./useFormItem-613b6d5d.js";import{p as m,R as y,T as R}from"./index-37448b2d.js";import{ar as I,C as V,_ as $}from"./jeecg-online-vendor-f57c6456.js";import"./antd-vue-vendor-05bfa84d.js";import"./vxe-table-vendor-26792376.js";const{createMessage:v,createErrorModal:K}=V(),M=q({name:"JCategorySelect",components:{},inheritAttrs:!1,props:{value:m.oneOfType([m.string,m.array]),placeholder:{type:String,default:"请选择",required:!1},disabled:{type:Boolean,default:!1,required:!1},condition:{type:String,default:"",required:!1},multiple:{type:[Boolean,String],default:!1},loadTriggleChange:{type:Boolean,default:!1,required:!1},pid:{type:String,default:"",required:!1},pcode:{type:String,default:"",required:!1},back:{type:String,default:"",required:!1}},emits:["options-change","change","update:value"],setup(e,{emit:r,refs:b}){const g=c([]),u=c([]),i=c(),f=I(),[C]=J(e,"value","change",g);p(()=>e.value,()=>{D()},{deep:!0}),p(()=>e.pcode,()=>{k()},{deep:!0,immediate:!0});function k(){let a={pid:e.pid,pcode:e.pcode?e.pcode:"0",condition:e.condition};y(a).then(l=>{if(l&&l.length>0){for(let t of l)t.value=t.key,t.leaf==!1?t.isLeaf=!1:t.leaf==!0&&(t.isLeaf=!0);u.value=l}})}function D(){!e.value||e.value=="0"?e.multiple?i.value=[]:i.value={value:null,label:null}:R({ids:e.value}).then(a=>{let l=e.value.split(",");i.value=a.map((t,n)=>({key:l[n],value:l[n],label:t})),e.multiple||(i.value=i.value[0]),S(a[0])})}function S(a){!e.multiple&&e.loadTriggleChange&&d(e.value,a)}function d(a,l){let t={};e.back&&(t[e.back]=l),r("change",a,t),r("update:value",a)}function T(a){let l=a.dataRef;return new Promise(t=>{if(a.children&&a.children.length>0){t();return}let n=l.key,L={pid:n,condition:e.condition};y(L).then(s=>{if(s){for(let o of s)o.value=o.key,o.leaf==!1?o.isLeaf=!1:o.leaf==!0&&(o.isLeaf=!0);h(n,s,u.value),t()}})})}function h(a,l,t){if(t&&t.length>0)for(let n of t)if(n.key==a){!l||l.length==0?n.isLeaf=!0:n.children=l;break}else h(a,l,n.children)}function w(a){if(!a)r("change",""),i.value="",r("update:value","");else if(Array.isArray(a)){let l=[],t=a.map(n=>(l.push(n.label),n.value));d(t.join(","),l.join(",")),i.value=a}else d(a.value,a.label),i.value=a}function A(){return u}function O(){let a=e.condition;return new Promise((l,t)=>{if(!a)l();else try{let n=JSON.parse(a);typeof n=="object"&&n?l():(v.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),t())}catch(n){v.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),t()}})}return{state:C,attrs:f,onChange:w,treeData:u,treeValue:i,asyncLoadTreeData:T}}});function P(e,r,b,g,u,i){const f=B("a-tree-select");return _(),j(f,{allowClear:"",labelInValue:"",style:{width:"100%"},disabled:e.disabled,dropdownStyle:{maxHeight:"400px",overflow:"auto"},placeholder:e.placeholder,loadData:e.asyncLoadTreeData,value:e.treeValue,treeData:e.treeData,multiple:e.multiple,onChange:e.onChange},null,8,["disabled","placeholder","loadData","value","treeData","multiple","onChange"])}const Q=$(M,[["render",P]]);export{Q as default};
