var le=Object.defineProperty;var j=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var q=(o,c,i)=>c in o?le(o,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[c]=i,z=(o,c)=>{for(var i in c||(c={}))re.call(c,i)&&q(o,i,c[i]);if(j)for(var i of j(c))ie.call(c,i)&&q(o,i,c[i]);return o};import{d as K,e as x,u as f,a6 as _,a7 as A,q as S,A as D,ac as b,k as C,F as Q,f as O,w as J,n as ue,V as ce,Y as R,a9 as H,ad as G,Z,ab as de,ae as fe,aj as me}from"./tinymce-vendor-3c2b3d6e.js";import{l as L,p as u,k as pe,Z as ge,g as F,a0 as ve}from"./index-37448b2d.js";import{C as W,ar as he}from"./jeecg-online-vendor-f57c6456.js";import{c as be}from"./index-76418551.js";var V=(o=>(o.all="all",o.image="image",o.file="file",o))(V||{});const we={class:"upload-download-handler"},Ce={class:"upload-mover-handler"},ye=K({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(o){const{createMessage:c}=W(),i=o,p=x(()=>f(i.fileList));function N(){let a=y();if(a===-1){c.warn("移动失败："+a);return}if(a===0){w(a,f(p).length-1);return}w(a,a-1)}function U(){let a=y();if(a===-1){c.warn("移动失败："+a);return}if(a==f(p).length-1){w(a,0);return}w(a,a+1)}function w(a,r){if(a!==r){let d=[...f(p)],v=d[a];d[a]=d[r],d[r]=v,i.emitValue(d.map(g=>g.url).join(","))}}function y(){var r,d;const a=(d=(r=i.element)==null?void 0:r.getElementsByTagName("img")[0])==null?void 0:d.src;if(a){const v=f(p);for(let g=0;g<v.length;g++){let m=v[g].url;const k=a.replace(window.location.origin,"");if(m===k||encodeURI(m)===k)return g}}return-1}function l(){var r,d;const a=(d=(r=i.element)==null?void 0:r.getElementsByTagName("img")[0])==null?void 0:d.src;window.open(a)}return(a,r)=>(_(),A(Q,null,[S(b("div",we,[b("a",{class:"download",title:"下载",onClick:l},[C(f(L),{icon:"ant-design:download"})])],512),[[D,o.download]]),S(b("div",Ce,[b("a",{title:"向前移动",onClick:N},[C(f(L),{icon:"ant-design:arrow-left"})]),b("a",{title:"向后移动",onClick:U},[C(f(L),{icon:"ant-design:arrow-right"})])],512),[[D,o.mover&&p.value.length>1]])],64))}}),xe={key:0},_e={class:"ant-upload-text"},Y="ant-upload-list-item",Be=K({__name:"JUpload",props:{value:u.oneOfType([u.string,u.array]),text:u.string.def("上传"),fileType:u.string.def(V.all),bizPath:u.string.def("temp"),returnUrl:u.bool.def(!0),maxCount:u.number.def(0),buttonVisible:u.bool.def(!0),multiple:u.bool.def(!0),mover:u.bool.def(!0),download:u.bool.def(!0),removeConfirm:u.bool.def(!1),beforeUpload:u.func,disabled:u.bool.def(!1),replaceLastOne:u.bool.def(!1)},emits:["change","update:value"],setup(o,{expose:c,emit:i}){const{createMessage:p,createConfirm:N}=W(),{prefixCls:U}=pe("j-upload"),w=he(),y=i,l=o,a=ge(),r=O([]),d=O(!0),v=O(),g=x(()=>l.maxCount>0&&r.value.length>=l.maxCount),m=x(()=>l.fileType===V.image),k=x(()=>l.disabled===!0?!0:g.value===!0?l.replaceLastOne!==!0:!1),X=x(()=>{const e=Object.assign({},l,f(w));return e.name="file",e.listType=m.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":l.disabled}],e.data=z({biz:l.bizPath},e.data),e.beforeUpload||(e.beforeUpload=ee),m.value&&!e.accept&&(e.accept="image/*"),e});J(()=>l.value,e=>{Array.isArray(e)?l.returnUrl?T(e.join(",")):E(e):l.returnUrl?T(e):e&&E(JSON.parse(e))},{immediate:!0}),J(r,()=>ue(()=>I()),{immediate:!0});function I(){if(!m.value)return;const e=v.value?v.value.getElementsByClassName(Y):null;if(!(!e||e.length===0))for(const n of e)n.getAttribute("data-has-actions")==="true"||n.addEventListener("mouseover",M)}function M(e){const t=(()=>{for(const P of e.path){if(P.classList.contains(Y))return P;if(P.classList.contains(`${U}-container`))return null}return null})();if(!t)return;const s=t.getElementsByClassName("ant-upload-list-item-actions");if(!s||s.length===0)return;const h=document.createElement("div");h.className="upload-actions-container",ce(ye,{element:t,fileList:r,mover:l.mover,download:l.download,emitValue:B}).mount(h),s[0].appendChild(h),t.setAttribute("data-has-actions","true"),t.removeEventListener("mouseover",M)}function T(e){if(!e||e.length==0){r.value=[];return}let n=[];for(const t of e.split(",")){let s=F(t);n.push({uid:$(),name:oe(t),status:"done",url:s,response:{status:"history",message:t}})}r.value=n}function E(e){if(!e||e.length==0){r.value=[];return}let n=[];for(const t of e){let s=F(t.filePath);n.push({uid:$(),name:t.fileName,url:s,status:"done",response:{status:"history",message:t.filePath}})}r.value=n}function ee(e){return d.value=!0,m.value&&e.type.indexOf("image")<0?(p.warning("请上传图片"),d.value=!1,!1):typeof l.beforeUpload=="function"?l.beforeUpload(e):!0}function te(){return l.removeConfirm?new Promise(e=>{N({title:"删除",content:`确定要删除这${m.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}):!0}function ne(e){!e.file.status&&d.value===!1&&e.fileList.pop();let n=e.fileList;if(l.maxCount>0&&n.length>=l.maxCount)if(l.maxCount-n.length>=0)n=n.slice(-l.maxCount);else return;if(e.file.status==="done"){let t=[];e.file.response.success?t=n.map(s=>{if(s.response){let h=s.response.message;s.url=F(h)}return s}):(t=n.filter(s=>s.uid!=e.file.uid),p.error(`${e.file.name} 上传失败.`)),n=t}else e.file.status==="error"&&p.error(`${e.file.name} 上传失败.`);if(r.value=n,e.file.status==="done"||e.file.status==="removed")if(l.returnUrl)ae();else{let t=[];for(const s of n)if(s.status==="done"){let h={fileName:s.name,filePath:s.response.message,fileSize:s.size};t.push(h)}else return;B(JSON.stringify(t))}}function ae(){let e=r.value,n="";(!e||e.length==0)&&(n="");let t=[];for(const s of e)if(s.status==="done")t.push(s.response.message);else return;t.length>0&&(n=t.join(",")),B(n)}function se(e){m.value?be({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function B(e){y("change",e),y("update:value",e)}function $(){return"-"+parseInt(Math.random()*1e4+1,10)}function oe(e){if(e.lastIndexOf("\\")>=0){let n=new RegExp("\\\\","g");e=e.replace(n,"/")}return e.substring(e.lastIndexOf("/")+1)}return c({addActionsListener:I}),(e,n)=>{const t=R("a-button"),s=R("a-upload");return _(),A("div",{ref_key:"containerRef",ref:v,class:me(`${f(U)}-container`)},[C(s,fe({headers:f(a),multiple:o.multiple,action:f(ve),fileList:r.value,disabled:o.disabled},X.value,{onRemove:te,onChange:ne,onPreview:se}),{default:H(()=>[m.value?(_(),A(Q,{key:0},[g.value?Z("",!0):(_(),A("div",xe,[C(f(L),{icon:"ant-design:plus-outlined"}),b("div",_e,G(o.text),1)]))],64)):o.buttonVisible?(_(),de(t,{key:1,disabled:k.value},{default:H(()=>[C(f(L),{icon:"ant-design:upload-outlined"}),b("span",null,G(o.text),1)]),_:1},8,["disabled"])):Z("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{V as U,Be as _};
