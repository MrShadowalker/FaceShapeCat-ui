import{d as A,f as c,u as n,h as N,e as q,ac as M,Y as m,a6 as E,a7 as F,k as r,ae as O,a9 as u,E as b,ad as z,Z as J}from"./tinymce-vendor-3c2b3d6e.js";import{B as K}from"./index-64ecc8b2.js";import{m as j,ar as G,C as H,ap as P,_ as W}from"./jeecg-online-vendor-f57c6456.js";import{C as X}from"./index-37448b2d.js";import"./BasicModal-9d388b71.js";import"./antd-vue-vendor-05bfa84d.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";const Y=A({name:"JImportModal",components:{BasicModal:K},props:{url:{type:String,default:"",required:!1},biz:{type:String,default:"",required:!1},online:{type:Boolean,default:!1,required:!1}},emits:["ok","register"],setup(e,{emit:_,refs:S}){const{createMessage:g,createWarningModal:k}=H(),[y,{closeModal:h}]=X(a=>{v(a)}),i=j(),C=G(),l=c(!1),o=c([]),w=c(""),p=c(""),f=c(0),$=Object.assign({},n(e),n(C));N(()=>{e.url&&(w.value=`${i.uploadUrl}${e.url}`)});const D=q(()=>!(n(o).length>0));function B(){h(),v()}function L(a){f.value=a?1:0}function I(a){const d=n(o).indexOf(a),t=n(o).slice();t.splice(d,1),o.value=t}function R(a){return o.value=[...n(o),a],!1}function V(){let{biz:a,online:d}=e;const t=new FormData;a&&t.append("isSingleTableImport",a),n(p)&&n(p).length>0&&t.append("foreignKeys",n(p)),d&&t.append("validateStatus",n(f)),n(o).forEach(s=>{t.append("files[]",s)}),l.value=!0;let U={"Content-Type":"multipart/form-data;boundary = "+new Date().getTime()};P.post({url:e.url,params:t,headers:U},{isTransformResponse:!1}).then(s=>{l.value=!1,s.success?(s.code==201?T(s.message,s.result):g.success(s.message),B(),v(),_("ok")):g.warning(s.message)}).catch(()=>{l.value=!1})}function T(a,d){let t=i.uploadUrl+d;k({title:"导入成功,但是有错误数据!",centered:!1,content:`<div>
                        <span>${a}</span><br/>
                        <span>具体详情请<a href = ${t} target="_blank"> 点击下载 </a> </span>
                      </div>`})}function v(a){o.value=[],l.value=!1,p.value=a,f.value=0}return{register:y,getBindValue:$,uploadDisabled:D,fileList:o,uploading:l,validateStatus:f,handleClose:B,handleChangeValidateStatus:L,handleRemove:I,beforeUpload:R,handleImport:V}}}),Z={key:0,style:{margin:"0 5px 5px"}},x=M("span",{style:{display:"inline-block",height:"32px","line-height":"32px","vertical-align":"middle"}},"是否开启校验:",-1),Q={style:{"margin-left":"6px"}};function ee(e,_,S,g,k,y){const h=m("a-switch"),i=m("a-button"),C=m("a-upload"),l=m("BasicModal");return E(),F("div",null,[r(l,O(e.$attrs,{onRegister:e.register,title:"导入EXCEL",width:600,onCancel:e.handleClose,confirmLoading:e.uploading,destroyOnClose:""}),{footer:u(()=>[r(i,{onClick:e.handleClose},{default:u(()=>[b("关闭")]),_:1},8,["onClick"]),r(i,{type:"primary",onClick:e.handleImport,disabled:e.uploadDisabled,loading:e.uploading},{default:u(()=>[b(z(e.uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","disabled","loading"])]),default:u(()=>[e.online?(E(),F("div",Z,[x,M("span",Q,[r(h,{checked:e.validateStatus==1,onChange:e.handleChangeValidateStatus,"checked-children":"是","un-checked-children":"否"},null,8,["checked","onChange"])])])):J("",!0),r(C,{name:"file",accept:".xls,.xlsx",multiple:!0,fileList:e.fileList,onRemove:e.handleRemove,beforeUpload:e.beforeUpload},{default:u(()=>[r(i,{preIcon:"ant-design:upload-outlined"},{default:u(()=>[b("选择导入文件")]),_:1})]),_:1},8,["fileList","onRemove","beforeUpload"])]),_:1},16,["onRegister","onCancel","confirmLoading"])])}const ue=W(Y,[["render",ee]]);export{ue as default};
