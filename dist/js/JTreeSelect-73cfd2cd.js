var f=(p,b,l)=>new Promise((C,m)=>{var h=o=>{try{r(l.next(o))}catch(u){m(u)}},n=o=>{try{r(l.throw(o))}catch(u){m(u)}},r=o=>o.done?C(o.value):Promise.resolve(o.value).then(h,n);r((l=l.apply(p,b)).next())});import{d as j,f as v,w as g,Y as B,a6 as J,ab as H,ae as M,u as d}from"./tinymce-vendor-3c2b3d6e.js";import{ar as $,ap as y,C as A}from"./jeecg-online-vendor-f57c6456.js";import{p as i}from"./index-37448b2d.js";const z=j({__name:"JTreeSelect",props:{value:i.string.def(""),placeholder:i.string.def("请选择"),dict:i.string.def("id"),parentCode:i.string.def(""),pidField:i.string.def("pid"),pidValue:i.string.def(""),hasChildField:i.string.def(""),converIsLeafVal:i.integer.def(1),condition:i.string.def(""),multiple:i.bool.def(!1),loadTriggleChange:i.bool.def(!1),reload:i.number.def(1),url:i.string.def(""),params:i.object.def({}),treeCheckAble:i.bool.def(!1)},emits:["change","update:value"],setup(p,{emit:b}){const l=p,C=$(),m=b,{createMessage:h}=A(),n=v([]),r=v(null),o=v(""),u=v(""),k=v("");g(()=>l.value,()=>D(),{deep:!0,immediate:!0}),g(()=>l.dict,()=>{I(),T()},{deep:!0,immediate:!0}),g(()=>l.reload,()=>f(this,null,function*(){n.value=[],yield T()}),{immediate:!1});function D(){return f(this,null,function*(){if(!l.value||l.value=="0")l.multiple?r.value=[]:r.value={label:null,value:null};else if(l.url)_();else{let e={key:l.value},a=yield y.get({url:`/sys/dict/loadDictItem/${l.dict}`,params:e},{isTransformResponse:!1});if(a.success){if(l.multiple){let s=l.value.split(",");r.value=a.result.map((t,c)=>({key:s[c],value:s[c],label:t}))}else r.value={key:l.value,value:l.value,label:a.result[0]};F(a.result[0])}}})}function F(e){!l.multiple&&l.loadTriggleChange&&m("change",l.value,e)}function I(){var a;let e=(a=l.dict)==null?void 0:a.split(",");o.value=e[0],u.value=e[1],k.value=e[2]}function T(){return f(this,null,function*(){let e={pid:l.pidValue,pidField:l.pidField,hasChildField:l.hasChildField,converIsLeafVal:l.converIsLeafVal,condition:l.condition,tableName:d(o),text:d(u),code:d(k)},a=yield y.get({url:"/sys/dict/loadTreeData",params:e},{isTransformResponse:!1});if(a.success&&a.result){for(let s of a.result)s.value=s.key,s.isLeaf=!!s.leaf;n.value=[...a.result]}})}function P(e){return f(this,null,function*(){if(e.dataRef.children||l.url)return Promise.resolve();let a=e.dataRef.key,s={pid:a,pidField:l.pidField,hasChildField:l.hasChildField,converIsLeafVal:l.converIsLeafVal,condition:l.condition,tableName:d(o),text:d(u),code:d(k)},t=yield y.get({url:"/sys/dict/loadTreeData",params:s},{isTransformResponse:!1});if(t.success){for(let c of t.result)c.value=c.key,c.isLeaf=!!c.leaf;L(a,t.result,n.value),n.value=[...n.value]}return Promise.resolve()})}function L(e,a,s){if(s&&s.length>0)for(let t of s)if(t.key==e){!a||a.length==0?t.isLeaf=!0:t.children=a;break}else L(e,a,t.children)}function R(e){e?e instanceof Array?w(e.map(a=>a.value).join(",")):w(e.value):w(""),r.value=e}function w(e){m("change",e),m("update:value",e)}function x(e){}function S(){let e=l.condition;return new Promise((a,s)=>{if(!e)a();else try{let t=JSON.parse(e);typeof t=="object"&&t?a():(h.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),s())}catch(t){h.error("组件JTreeSelect-condition传值有误，需要一个json字符串!"),s()}})}g(()=>l.url,e=>f(this,null,function*(){e&&(yield N())}));function N(){return f(this,null,function*(){let e=l.url,a=l.params,s=yield y.get({url:e,params:a},{isTransformResponse:!1});if(s.success&&s.result){for(let t of s.result)t.key=t.value,t.isLeaf=!!t.leaf;n.value=[...s.result]}})}function _(){let e=n.value,a=[];V(e,a),a.length>0&&(r.value=a,F(a[0]))}function V(e,a){let s=l.value;if(e&&e.length)for(let t of e)s===t.value?a.push({key:t.key,value:t.value,label:t.label||t.title}):V(t.children,a)}return S().then(()=>{I(),T(),D()}),(e,a)=>{const s=B("a-tree-select");return J(),H(s,M({allowClear:"",labelInValue:"",style:{width:"100%"},getPopupContainer:t=>t==null?void 0:t.parentNode,dropdownStyle:{maxHeight:"400px",overflow:"auto"},placeholder:p.placeholder,loadData:P,value:r.value,treeData:n.value,multiple:p.multiple},d(C),{onChange:R,onSearch:x,"tree-checkable":p.treeCheckAble}),null,16,["getPopupContainer","placeholder","value","treeData","multiple","tree-checkable"])}}});export{z as _};
