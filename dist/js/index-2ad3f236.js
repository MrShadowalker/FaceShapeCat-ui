var Ue=Object.defineProperty,Pe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var ne=(e,t,n)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))Ie.call(t,n)&&ne(e,n,t[n]);if(te)for(var n of te(t))Le.call(t,n)&&ne(e,n,t[n]);return e},O=(e,t)=>Pe(e,ke(t));var V=(e,t,n)=>new Promise((u,s)=>{var f=a=>{try{r(n.next(a))}catch(l){s(l)}},c=a=>{try{r(n.throw(a))}catch(l){s(l)}},r=a=>a.done?u(a.value):Promise.resolve(a.value).then(f,c);r((n=n.apply(e,t)).next())});import{B as x,at as Re,v as J,i as Ae,_ as G,C as Te,ak as $e,w as se,y as Ne}from"./jeecg-online-vendor-f57c6456.js";import{e as L,u as k,p as Be,c as De,d as E,I as oe,Y as b,a6 as y,a7 as B,aj as q,F as M,aa as ae,Q as X,ab as T,ah as K,ae as j,a9 as _,k as p,ai as Fe,Z as $,E as D,ad as F,aq as Me,w as ee,n as Ee,r as Oe,f as W,H as ze,ac as je}from"./tinymce-vendor-3c2b3d6e.js";import{X as xe,aE as Ge,T as re,ap as He,ah as Ve,Z as Q,U as We,A as Ze,o as qe}from"./antd-vue-vendor-05bfa84d.js";import{B as ie}from"./index-64ecc8b2.js";import{A as Xe,l as ue,P as Ke,D as Qe,p as z,k as Ye,q as Je,C as ce,r as et,E as le}from"./index-37448b2d.js";import{u as tt}from"./BasicModal-9d388b71.js";import{downloadByUrl as nt}from"./download-2caf3e60.js";const{t:Y}=x();function ot({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:u}){const s=L(()=>{const r=k(e);return r&&r.length>0?r:[]}),f=L(()=>k(s).map(r=>r.indexOf("/")>0||r.startsWith(".")?r:`.${r}`).join(",")),c=L(()=>{const r=k(t);if(r)return r;const a=[],l=k(e);l.length>0&&a.push(Y("component.upload.accept",[l.join(",")]));const g=k(u);g&&a.push(Y("component.upload.maxSize",[g]));const w=k(n);return w&&w!==1/0&&a.push(Y("component.upload.maxNumber",[w])),a.join("，")});return{getAccept:s,getStringAccept:f,getHelpText:c}}var S=(e=>(e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e))(S||{});const de={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:{}},api:{type:Function,default:null,required:!0},name:{type:String,default:"file"},filename:{type:String,default:null}},at=O(I({value:{type:Array,default:()=>[]}},de),{showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),lt={value:{type:Array,default:()=>[]}},st={columns:{type:[Array],default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}};function rt(e,t){const n=t.join("|");return new RegExp("\\.("+n+")$","i").test(e.name)}function it(e){return pe(e.name)}function pe(e){return/\.(jpg|jpeg|png|gif)$/i.test(e)}function ut(e){return new Promise((t,n)=>{const u=new FileReader;u.readAsDataURL(e),u.onload=()=>t({result:u.result,file:e}),u.onerror=s=>n(s)})}const me=Symbol("basic-table");function Wt(e){Be(me,e)}function ct(){return De(me)}const{table:dt}=Xe,{pageSizeOptions:pt,defaultPageSize:mt,defaultSize:ft,fetchSetting:gt,defaultSortFn:ht,defaultFilterFn:vt}=dt,Zt="key",qt=pt,Xt=mt,Kt=gt,Qt=ht,Yt=vt,Jt="center",en=ft,tn="INDEX",yt="ACTION",bt=E({name:"TableAction",components:{Icon:ue,PopConfirmButton:Ke,Divider:xe,Dropdown:Qe,MoreOutlined:Ge,Tooltip:re},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},divider:z.bool.def(!0),outside:z.bool,stopButtonPropagation:z.bool.def(!1)},setup(e){const{prefixCls:t}=Ye("basic-table-action");let n={};e.outside||(n=ct());const{hasPermission:u}=Je();function s(o){const i=o.ifShow;let v=!0;return Re(i)&&(v=i),J(i)&&(v=i(o)),v}const f=L(()=>(oe(e.actions)||[]).filter(o=>u(o.auth)&&s(o)).map(o=>{const{popConfirm:i}=o;if(i){const v=i.overlayClassName;i.overlayClassName=`${v||""} ${t}-popconfirm`}return O(I(I({getPopupContainer:()=>{var v;return(v=k(n==null?void 0:n.wrapRef.value))!=null?v:document.body},type:"link",size:"small"},o),i||{}),{onConfirm:r(i==null?void 0:i.confirm),onCancel:i==null?void 0:i.cancel,enable:!!i})})),c=L(()=>{const o=(oe(e.dropDownActions)||[]).filter(i=>u(i.auth)&&s(i));return o.map((i,v)=>{const{label:d,popConfirm:h}=i;if(h){const H=h.overlayClassName;h.overlayClassName=`${H||""} ${t}-popconfirm`}return h&&(h.confirm=r(h==null?void 0:h.confirm)),O(I(I({},i),h),{onConfirm:r(h==null?void 0:h.confirm),onCancel:h==null?void 0:h.cancel,text:d,divider:v<o.length-1?e.divider:!1})})}),r=o=>typeof o!="function"?o:()=>new Promise(v=>{const d=o();Object.prototype.toString.call(d)==="[object Promise]"?d.finally(()=>{v()}).catch(h=>{}):v()}),a=L(()=>k(c).filter(o=>o.slot)),l=L(()=>{var v,d;const i=(((v=n==null?void 0:n.getColumns)==null?void 0:v.call(n))||[]).find(h=>h.flag===yt);return(d=i==null?void 0:i.align)!=null?d:"left"});function g(o){return I({getPopupContainer:()=>{var i;return(i=k(n==null?void 0:n.wrapRef.value))!=null?i:document.body},placement:"bottom"},Ae(o)?{title:o}:o)}function w(o){if(!e.stopButtonPropagation)return;o.composedPath().find(d=>{var h;return((h=d.tagName)==null?void 0:h.toUpperCase())==="BUTTON"})&&o.stopPropagation()}return{prefixCls:t,getActions:f,getDropdownList:c,getDropdownSlotList:a,getAlign:l,onCellClick:w,getTooltip:g}}});function wt(e,t,n,u,s,f){const c=b("Icon"),r=b("PopConfirmButton"),a=b("Tooltip"),l=b("Divider"),g=b("a-button"),w=b("Dropdown");return y(),B("div",{class:q([e.prefixCls,e.getAlign]),onClick:t[0]||(t[0]=(...o)=>e.onCellClick&&e.onCellClick(...o))},[(y(!0),B(M,null,ae(e.getActions,(o,i)=>(y(),B(M,{key:`${i}-${o.label}`},[o.slot?X(e.$slots,"customButton",{key:0}):(y(),B(M,{key:1},[o.tooltip?(y(),T(a,K(j({key:0},e.getTooltip(o.tooltip))),{default:_(()=>[p(r,K(Fe(o)),{default:_(()=>[o.icon?(y(),T(c,{key:0,icon:o.icon,class:q({"mr-1":!!o.label})},null,8,["icon","class"])):$("",!0),o.label?(y(),B(M,{key:1},[D(F(o.label),1)],64)):$("",!0)]),_:2},1040)]),_:2},1040)):(y(),T(r,K(j({key:1},o)),{default:_(()=>[o.icon?(y(),T(c,{key:0,icon:o.icon,class:q({"mr-1":!!o.label})},null,8,["icon","class"])):$("",!0),o.label?(y(),B(M,{key:1},[D(F(o.label),1)],64)):$("",!0)]),_:2},1040))],64)),e.divider&&i<e.getActions.length-1?(y(),T(l,{key:2,type:"vertical",class:"action-divider"})):$("",!0)],64))),128)),e.dropDownActions&&e.getDropdownList.length>0?(y(),T(w,{key:0,trigger:["hover"],dropMenuList:e.getDropdownList,popconfirm:""},Me({default:_(()=>[X(e.$slots,"more"),e.$slots.more?$("",!0):(y(),T(g,{key:0,type:"link",size:"small"},{default:_(()=>[D(" 更多 "),p(c,{icon:"mdi-light:chevron-down"})]),_:1}))]),_:2},[ae(e.getDropdownSlotList,(o,i)=>({name:o.slot,fn:_(()=>[X(e.$slots,o.slot)])}))]),1032,["dropMenuList"])):$("",!0)],2)}const fe=G(bt,[["render",wt]]),Ct=E({components:{Image:He},props:{fileUrl:z.string.def(""),fileName:z.string.def("")}});const _t={class:"thumb"};function St(e,t,n,u,s,f){const c=b("Image");return y(),B("span",_t,[e.fileUrl?(y(),T(c,{key:0,src:e.fileUrl,width:104},null,8,["src"])):$("",!0)])}const ge=G(Ct,[["render",St]]),{t:U}=x();function Ut(){return[{dataIndex:"thumbUrl",title:U("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&p(ge,{fileUrl:t},null)}},{dataIndex:"name",title:U("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:n,status:u}=t||{};let s="normal";return u===S.ERROR?s="exception":u===S.UPLOADING?s="active":u===S.SUCCESS&&(s="success"),p("span",null,[p("p",{class:"truncate mb-1",title:e},[e]),p(Ve,{percent:n,size:"small",status:s},null)])}},{dataIndex:"size",title:U("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:U("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===S.SUCCESS?p(Q,{color:"green"},{default:()=>U("component.upload.uploadSuccess")}):e===S.ERROR?p(Q,{color:"red"},{default:()=>U("component.upload.uploadError")}):e===S.UPLOADING?p(Q,{color:"blue"},{default:()=>U("component.upload.uploading")}):e}]}function Pt(e){return{width:120,title:U("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:t})=>{const n=[{label:U("component.upload.del"),color:"error",onClick:e.bind(null,t)}];return p(fe,{actions:n,outside:!0},null)}}}function kt(){return[{dataIndex:"url",title:U("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return pe(t)&&p(ge,{fileUrl:t},null)}},{dataIndex:"name",title:U("component.upload.fileName"),align:"left"}]}function It({handleRemove:e,handleDownload:t}){return{width:160,title:U("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:n})=>{const u=[{label:U("component.upload.del"),color:"error",onClick:e.bind(null,n)},{label:U("component.upload.download"),onClick:t.bind(null,n)}];return p(fe,{actions:u,outside:!0},null)}}}const he=E({name:"FileList",props:st,setup(e){const t=tt();return ee(()=>e.dataSource,()=>{Ee(()=>{var n;(n=t==null?void 0:t.redoModalHeight)==null||n.call(t)})}),()=>{const{columns:n,actionColumn:u,dataSource:s}=e,f=[...n,u];return p("table",{class:"file-table"},[p("colgroup",null,[f.map(c=>{const{width:r=0,dataIndex:a}=c,l={width:`${r}px`,minWidth:`${r}px`};return p("col",{style:r?l:{},key:a},null)})]),p("thead",null,[p("tr",{class:"file-table-tr"},[f.map(c=>{const{title:r="",align:a="center",dataIndex:l}=c;return p("th",{class:["file-table-th",a],key:l},[r])})])]),p("tbody",null,[s.map((c={},r)=>p("tr",{class:"file-table-tr",key:`${r+c.name||""}`},[f.map(a=>{const{dataIndex:l="",customRender:g,align:w="center"}=a,o=g&&J(g);return p("td",{class:["file-table-td",w],key:l},[o?g==null?void 0:g({text:c[l],record:c}):c[l]])})]))])])}}});const Lt=E({components:{BasicModal:ie,Upload:We,Alert:Ze,FileList:he},props:O(I({},de),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const n=Oe({fileList:[]}),u=W(!1),s=W([]),{accept:f,helpText:c,maxNumber:r,maxSize:a}=ze(e),{t:l}=x(),[g,{closeModal:w}]=ce(),{getAccept:o,getStringAccept:i,getHelpText:v}=ot({acceptRef:f,helpTextRef:c,maxNumberRef:r,maxSizeRef:a}),{createMessage:d}=Te(),h=L(()=>s.value.length>0&&!s.value.every(m=>m.status===S.SUCCESS)),H=L(()=>{const m=s.value.some(C=>C.status===S.SUCCESS);return{disabled:u.value||s.value.length===0||!m}}),ve=L(()=>{const m=s.value.some(C=>C.status===S.ERROR);return u.value?l("component.upload.uploading"):l(m?"component.upload.reUploadFailed":"component.upload.startUpload")});function ye(m){const{size:C,name:P}=m,{maxSize:R}=e,N=k(o);if(R&&m.size/1024/1024>=R)return d.error(l("component.upload.maxSizeMultiple",[R])),!1;if(N.length>0&&!rt(m,N))return d.error(l("component.upload.acceptUpload",[N.join(",")])),!1;const A={uuid:et(),file:m,size:C,name:P,percent:0,type:P.split(".").pop()};return it(m)?ut(m).then(({result:Z})=>{s.value=[...k(s),I({thumbUrl:Z},A)]}):s.value=[...k(s),A],!1}function be(m){const C=s.value.findIndex(P=>P.uuid===m.uuid);C!==-1&&s.value.splice(C,1),t("delete",m)}function we(m){return V(this,null,function*(){var P;const{api:C}=e;if(!C||!J(C))return $e("upload api must exist and be a function");try{m.status=S.UPLOADING;const{data:R}=yield(P=e.api)==null?void 0:P.call(e,{data:I({},e.uploadParams||{}),file:m.file,name:e.name,filename:e.filename},function(A){const Z=A.loaded/A.total*100|0;m.percent=Z});return m.status=S.SUCCESS,m.responseData=R,{success:!0,error:null}}catch(R){return m.status=S.ERROR,{success:!1,error:R}}})}function Ce(){return V(this,null,function*(){var C;const{maxNumber:m}=e;if(s.value.length+((C=e.previewFileList)==null?void 0:C.length)>m)return d.warning(l("component.upload.maxNumber",[m]));try{u.value=!0;const P=s.value.filter(A=>A.status!==S.SUCCESS)||[],R=yield Promise.all(P.map(A=>we(A)));u.value=!1;const N=R.filter(A=>!A.success);if(N.length>0)throw N}catch(P){throw u.value=!1,P}})}function _e(){const{maxNumber:m}=e;if(s.value.length>m)return d.warning(l("component.upload.maxNumber",[m]));if(u.value)return d.warning(l("component.upload.saveWarn"));const C=[];for(const P of s.value){const{status:R,responseData:N}=P;R===S.SUCCESS&&N&&C.push(N.url)}if(C.length<=0)return d.warning(l("component.upload.saveError"));s.value=[],w(),t("change",C)}function Se(){return V(this,null,function*(){return u.value?(d.warning(l("component.upload.uploadWait")),!1):(s.value=[],!0)})}return{columns:Ut(),actionColumn:Pt(be),register:g,closeModal:w,getHelpText:v,getStringAccept:i,getOkButtonProps:H,beforeUpload:ye,fileListRef:s,state:n,isUploadingRef:u,handleStartUpload:Ce,handleOk:_e,handleCloseFunc:Se,getIsSelectFile:h,getUploadBtnText:ve,t:l}}});const Rt={class:"upload-modal-toolbar"};function At(e,t,n,u,s,f){const c=b("a-button"),r=b("Alert"),a=b("Upload"),l=b("FileList"),g=b("BasicModal");return y(),T(g,j({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,wrapClassName:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerFooter:_(()=>[p(c,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:_(()=>[D(F(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:_(()=>[je("div",Rt,[p(r,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),p(a,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,class:"upload-modal-toolbar__btn"},{default:_(()=>[p(c,{type:"primary"},{default:_(()=>[D(F(e.t("component.upload.choose")),1)]),_:1})]),_:1},8,["accept","multiple","before-upload"])]),p(l,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])}const Tt=G(Lt,[["render",At]]),$t=E({components:{BasicModal:ie,FileList:he},props:lt,emits:["list-change","register","delete"],setup(e,{emit:t}){const[n,{closeModal:u}]=ce(),{t:s}=x(),f=W([]);ee(()=>e.value,a=>{se(a)||(a=[]),f.value=a.filter(l=>!!l).map(l=>({url:l,type:l.split(".").pop()||"",name:l.split("/").pop()||""}))},{immediate:!0});function c(a){const l=f.value.findIndex(g=>g.url===a.url);if(l!==-1){const g=f.value.splice(l,1);t("delete",g[0].url),t("list-change",f.value.map(w=>w.url))}}function r(a){const{url:l=""}=a;nt({url:l})}return{t:s,register:n,closeModal:u,fileListRef:f,columns:kt(),actionColumn:It({handleRemove:c,handleDownload:r})}}});function Nt(e,t,n,u,s,f){const c=b("FileList"),r=b("BasicModal");return y(),T(r,j({width:"800px",title:e.t("component.upload.preview"),wrapClassName:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:_(()=>[p(c,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}const Bt=G($t,[["render",Nt]]),Dt=E({name:"BasicUpload",components:{UploadModal:Tt,UploadPreviewModal:Bt,Icon:ue,Tooltip:re},props:at,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:n}){const{t:u}=x(),[s,{openModal:f}]=le(),[c,{openModal:r}]=le(),a=W([]),l=L(()=>{const{emptyHidePreview:d}=e;return d&&d?a.value.length>0:!0}),g=L(()=>{const d=I(I({},n),e);return qe(d,"onChange")});ee(()=>e.value,(d=[])=>{a.value=se(d)?d:[]},{immediate:!0});function w(d){a.value=[...k(a),...d||[]],t("update:value",a.value),t("change",a.value)}function o(d){a.value=[...d||[]],t("update:value",a.value),t("change",a.value)}function i(d){t("delete",d)}function v(d){t("preview-delete",d)}return{registerUploadModal:s,openUploadModal:f,handleChange:w,handlePreviewChange:o,registerPreviewModal:c,openPreviewModal:r,fileList:a,showPreview:l,bindValue:g,handleDelete:i,handlePreviewDelete:v,t:u}}});function Ft(e,t,n,u,s,f){const c=b("a-button"),r=b("Icon"),a=b("Tooltip"),l=b("a-button-group"),g=b("UploadModal"),w=b("UploadPreviewModal");return y(),B("div",null,[p(l,null,{default:_(()=>[p(c,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:_(()=>[D(F(e.t("component.upload.upload")),1)]),_:1},8,["onClick"]),e.showPreview?(y(),T(a,{key:0,placement:"bottom"},{title:_(()=>[D(F(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(y(),B(M,{key:0},[D(F(e.fileList.length),1)],64)):$("",!0)]),default:_(()=>[p(c,{onClick:e.openPreviewModal},{default:_(()=>[p(r,{icon:"bi:eye"}),e.fileList.length&&e.showPreviewNumber?(y(),B(M,{key:0},[D(F(e.fileList.length),1)],64)):$("",!0)]),_:1},8,["onClick"])]),_:1})):$("",!0)]),_:1}),p(g,j(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),p(w,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}const Mt=G(Dt,[["render",Ft]]),nn=Ne(Mt);export{yt as A,nn as B,Jt as D,Kt as F,tn as I,Xt as P,fe as Q,Zt as R,qt as a,Qt as b,Yt as c,en as d,Wt as e,ct as u};
