var j=(u,_,h)=>new Promise((x,T)=>{var U=r=>{try{t(h.next(r))}catch(G){T(G)}},L=r=>{try{t(h.throw(r))}catch(G){T(G)}},t=r=>r.done?x(r.value):Promise.resolve(r.value).then(U,L);t((h=h.apply(u,_)).next())});import{d as pe,f as B,r as ce,e as me,o as fe,Y as i,a6 as ve,ab as _e,a9 as o,k as e,ae as b,u as v,ac as g,ad as w,E as M,a4 as ye,a5 as be,n as ge}from"./tinymce-vendor-3c2b3d6e.js";import{C as $,ap as C,_ as he}from"./jeecg-online-vendor-f57c6456.js";import{aI as Be,a5 as we}from"./antd-vue-vendor-05bfa84d.js";import{l as F}from"./JDictSelectTag-f0227cc5.js";import{J as xe}from"./JSearchSelect-4158b9a9.js";import{J as Ge}from"./JImageUpload-1b0b2e46.js";const{createConfirm:Ce}=$();const Re="/evBuy/exportXls",$e="/evBuy/importExcel",Ne=u=>C.get({url:"/evBuy/list",params:u});const R=u=>C.get({url:"/evGoods/queryById",params:u}),Ye=(u,_)=>C.delete({url:"/evBuy/delete",params:u},{joinParamsToUrl:!0}).then(()=>{_()}),Je=(u,_)=>{Ce({iconType:"warning",title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>C.delete({url:"/evBuy/deleteBatch",data:u},{joinParamsToUrl:!0}).then(()=>{_()})})},Te=(u,_)=>{let h=_?"/evBuy/editGoods":"/evBuy/addGoods";return C.post({url:h,params:u},{isTransformResponse:!1})},N=u=>(ye("data-v-71f6e79b"),u=u(),be(),u),Ie=N(()=>g("span",{style:{color:"#999999"}},"进货列表",-1)),Ue={style:{width:"120px !important",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Le=N(()=>g("span",{style:{color:"#999999"}},"供应商信息",-1)),qe=pe({__name:"EvPurchaseOrderForm",props:{formDisabled:{type:Boolean,default:!1},formData:{type:Object,default:()=>{}},formBpm:{type:Boolean,default:!0}},emits:["register","ok"],setup(u,{expose:_,emit:h}){const x=u,T=B(),U=we.useForm,L=h,t=ce({id:"",code:"",amountTotal:0,evBuyGoodsList:[],supplier:"",payMoney:0,contact:"",buyTime:"",payType:"",payStatus:"",shopId:""}),{createMessage:r}=$(),G=B({xs:{span:24},sm:{span:3}}),Y=B({xs:{span:24},sm:{span:6}}),J=B({xs:{span:24},sm:{span:16}}),H=B({xs:{span:24},sm:{span:20}}),q=B(!1),V={payMoney:[{required:!0,message:"请输入实际金额!"}],code:[{required:!0,message:"请输入采购单号!"}],supplier:[{required:!0,message:"请输入供应商!"}],contact:[{required:!0,message:"请输入供应商联系人!"}],payType:[{required:!0,message:"请选择支付方式!"}],buyTime:[{required:!0,message:"请选择采购时间!"}],payStatus:[{required:!0,message:"请选择付款状态!"}],goodsStatus:[{required:!0,message:"请选择采购状态!"}],shopId:[{required:!0,message:"请选择采购店铺!"}],phone:[{required:!0,pattern:/^1[3456789]\d{9}$/,message:"手机号码格式有误"}]},{resetFields:X,validate:z,validateInfos:y}=U(t,V,{immediate:!0}),P=B([]),p=me(()=>x.formBpm===!0?x.formData.disabled!==!1:x.formDisabled);fe(()=>{});const O=d=>{d.price&&d.num&&(d.total=d.price*d.num),Q()};function K(d){t.evBuyGoodsList.splice(d,1)}const Q=()=>{t.amountTotal=0;for(let d=0;d<t.evBuyGoodsList.length;d++){const l=t.evBuyGoodsList[d];t.amountTotal+=l.total}t.payMoney=t.amountTotal};function ke(d,l){for(let s=0;s<t.evBuyGoodsList.length;s++)if(s!=l&&d==t.evBuyGoodsList[s].goodsId){r.error("商品重复!");const n=t.evBuyGoodsList[l];n.goodsId="",n.spec="",n.unit="",n.code="",n.salePrice=0,t.evBuyGoodsList[l]=n;return}}function W(d,l){R({id:d}).then(s=>{const n=t.evBuyGoodsList[l];n.spec=s.spec,n.unit=s.unit,n.code=s.code,n.salePrice=s.price})}function Z(d){for(let l=0;l<t.evBuyGoodsList.length;l++){const s=t.evBuyGoodsList[l];for(let n=0;n<P.value.length;n++){const m=P.value[n];s.goodsId==m.id&&(s.spec=m.spec,s.unit=m.unit,s.code=m.code)}}}function A(){t.evBuyGoodsList.push({unit:"",code:"",spec:"",goodsId:"",salePrice:0,price:0,num:0,total:0})}function ee(){S({})}function S(d){ge(()=>{X(),Object.assign(t,{}),d.id&&te(d.id)})}const te=d=>{R({id:d}).then(l=>{if(Object.assign(t,l),t.evBuyGoodsList.length>0)for(let s=0;s<t.evBuyGoodsList.length;s++){const n=t.evBuyGoodsList[s];Z(n.goodsId),O(n)}})};function ae(){return j(this,null,function*(){if(yield z(),t.evBuyGoodsList.length<1){r.warning("请填写商品信息");return}for(let s=0;s<t.evBuyGoodsList.length;s++){const n=t.evBuyGoodsList[s];if(!n.num||!n.total||!n.price||!n.goodsId){r.warning("请将商品数据填写完整");return}}q.value=!0;const d=B(!1);let l=t;l.id&&(d.value=!0),yield Te(l,d.value).then(s=>{s.success?(r.success(s.message),L("ok")):r.warning(s.message)}).finally(()=>{q.value=!1})})}return _({add:ee,edit:S,submitForm:ae}),(d,l)=>{const s=i("a-form-item"),n=i("a-col"),m=i("a-input"),I=i("a-input-number"),oe=i("a-date-picker"),D=i("a-row"),E=i("a-divider"),f=i("a-table-column"),le=i("a-tooltip"),se=i("a-space"),ne=i("a-button"),de=i("a-table"),ue=i("a-textarea"),ie=i("a-form"),re=i("a-spin");return ve(),_e(re,{spinning:q.value},{default:o(()=>[e(ie,{ref_key:"formRef",ref:T,class:"antd-modal-form",labelCol:Y.value,wrapperCol:J.value},{default:o(()=>[e(D,null,{default:o(()=>[e(n,{span:16},{default:o(()=>[e(D,null,{default:o(()=>[e(n,{span:14},{default:o(()=>[e(s,b({label:"采购店铺"},v(y).shopId),{default:o(()=>[e(F,{type:"select",value:t.shopId,"onUpdate:value":l[0]||(l[0]=a=>t.shopId=a),dictCode:"sys_depart,depart_name,id,parent_id!=''",placeholder:"请选择采购店铺",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:10},{default:o(()=>[e(s,b({label:"付款方式"},v(y).payType),{default:o(()=>[e(F,{type:"select",value:t.payType,"onUpdate:value":l[1]||(l[1]=a=>t.payType=a),dictCode:"ev_pay_type",placeholder:"请选择付款方式",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:14},{default:o(()=>[e(s,b({label:"采购单号"},v(y).code),{default:o(()=>[e(m,{value:t.code,"onUpdate:value":l[2]||(l[2]=a=>t.code=a),placeholder:"请输入采购单号",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:10},{default:o(()=>[e(s,{label:"合计金额"},{default:o(()=>[e(I,{id:"inputNumber",value:t.amountTotal,"onUpdate:value":l[3]||(l[3]=a=>t.amountTotal=a),formatter:a=>`${a}元`,min:0,disabled:""},null,8,["value","formatter"])]),_:1})]),_:1}),e(n,{span:14},{default:o(()=>[e(s,b({label:"采购时间"},v(y).buyTime),{default:o(()=>[e(oe,{placeholder:"请选择采购时间",value:t.buyTime,"onUpdate:value":l[4]||(l[4]=a=>t.buyTime=a),showTime:"","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:10},{default:o(()=>[e(s,b({label:"实际付款"},v(y).payMoney),{default:o(()=>[e(I,{id:"inputNumber",value:t.payMoney,"onUpdate:value":l[5]||(l[5]=a=>t.payMoney=a),formatter:a=>`${a}元`,min:0,disabled:p.value},null,8,["value","formatter","disabled"])]),_:1},16)]),_:1})]),_:1})]),_:1}),e(n,{span:8},{default:o(()=>[e(s,{label:"付款凭证",required:"true"},{default:o(()=>[e(Ge,{value:t.img,"onUpdate:value":l[6]||(l[6]=a=>t.img=a),disabled:p.value,fileMax:4},null,8,["value","disabled"])]),_:1})]),_:1}),e(E,{orientation:"left",style:{height:"2px","border-color":"#999999"}},{default:o(()=>[Ie]),_:1}),e(n,{span:24},{default:o(()=>[e(de,{pagination:!1,"data-source":t.evBuyGoodsList},{default:o(()=>[e(f,{title:"序号",width:"80px",align:"center"},{default:o(({record:a,index:c})=>[g("span",null,w(c+1),1)]),_:1}),e(f,{title:"商品",width:"160px",align:"center"},{default:o(({record:a,index:c})=>[e(xe,{onChange:k=>W(k,c),style:{width:"160px"},dict:"ev_goods,name,id,del_flag = '0'",value:a.goodsId,"onUpdate:value":k=>a.goodsId=k},null,8,["onChange","value","onUpdate:value"])]),_:1}),e(f,{title:"商品编号",width:"120px",align:"center"},{default:o(({record:a})=>[g("span",null,w(a.code),1)]),_:1}),e(f,{title:"计量单位",width:"120px",align:"center"},{default:o(({record:a})=>[g("span",null,w(a.unit),1)]),_:1}),e(f,{title:"规格型号",width:"120px",align:"center"},{default:o(({record:a})=>[e(le,{autoAdjustOverflow:"true"},{title:o(()=>[M(w(a.spec),1)]),default:o(()=>[g("span",Ue,w(a.spec),1)]),_:2},1024)]),_:1}),e(f,{title:"零售价",width:"100px",align:"center"},{default:o(({record:a})=>[g("span",null,w(a.salePrice)+"元",1)]),_:1}),e(f,{title:"进货单价",width:"110px",align:"center"},{default:o(({record:a})=>[e(I,{id:"inputNumber",value:a.price,"onUpdate:value":c=>a.price=c,formatter:c=>`${c}元`,min:0,onChange:c=>O(a),disabled:p.value},null,8,["value","onUpdate:value","formatter","onChange","disabled"])]),_:1}),e(f,{title:"数量",width:"110px",align:"center"},{default:o(({record:a})=>[e(I,{style:{width:"60px !important"},value:a.num,"onUpdate:value":c=>a.num=c,min:0,onChange:c=>O(a),disabled:p.value},null,8,["value","onUpdate:value","onChange","disabled"])]),_:1}),e(f,{title:"总价",width:"120px",align:"center"},{default:o(({record:a})=>[g("span",null,w(a.total)+"元",1)]),_:1}),e(f,{width:"120px",align:"center"},{title:o(()=>[e(se,{style:{cursor:"pointer"},onClick:A},{default:o(()=>[e(v(Be)),M("添加")]),_:1})]),default:o(({index:a})=>[g("span",null,[e(ne,{onClick:c=>K(a)},{default:o(()=>[M("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data-source"])]),_:1}),e(E,{orientation:"left",style:{height:"2px","border-color":"#999999"}},{default:o(()=>[Le]),_:1}),e(n,{span:12},{default:o(()=>[e(s,b({label:"供应商"},v(y).supplier),{default:o(()=>[e(m,{value:t.supplier,"onUpdate:value":l[7]||(l[7]=a=>t.supplier=a),placeholder:"请输入供应商",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:12},{default:o(()=>[e(s,b({label:"供应商联系人"},v(y).contact),{default:o(()=>[e(m,{value:t.contact,"onUpdate:value":l[8]||(l[8]=a=>t.contact=a),placeholder:"请输入供应商联系人",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:12},{default:o(()=>[e(s,b({label:"供应商联系电话"},v(y).phone),{default:o(()=>[e(m,{value:t.phone,"onUpdate:value":l[9]||(l[9]=a=>t.phone=a),placeholder:"请输入供应商联系电话",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(n,{span:12},{default:o(()=>[e(s,{label:"供应商联系地址"},{default:o(()=>[e(m,{value:t.address,"onUpdate:value":l[10]||(l[10]=a=>t.address=a),placeholder:"请输入供应商联系地址",disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1}),e(n,{span:24},{default:o(()=>[e(s,b({label:"备注"},v(y).description,{labelCol:G.value,wrapperCol:H.value}),{default:o(()=>[e(ue,{value:t.description,"onUpdate:value":l[11]||(l[11]=a=>t.description=a),disabled:p.value,rows:4},null,8,["value","disabled"])]),_:1},16,["labelCol","wrapperCol"])]),_:1})]),_:1})]),_:1},8,["labelCol","wrapperCol"])]),_:1},8,["spinning"])}}});const Oe=he(qe,[["__scopeId","data-v-71f6e79b"]]),He=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{Oe as E,$e as a,Je as b,He as c,Ye as d,Re as g,Ne as l};
