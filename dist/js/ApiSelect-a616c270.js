var P=Object.defineProperty,_=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var V=(e,n,t)=>n in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,$=(e,n)=>{for(var t in n||(n={}))E.call(n,t)&&V(e,t,n[t]);if(L)for(var t of L(n))R.call(n,t)&&V(e,t,n[t]);return e},k=(e,n)=>_(e,z(n));var y=(e,n,t)=>new Promise((c,l)=>{var f=o=>{try{r(t.next(o))}catch(u){l(u)}},i=o=>{try{r(t.throw(o))}catch(u){l(u)}},r=o=>o.done?c(o.value):Promise.resolve(o.value).then(f,i);r((t=t.apply(e,n)).next())});import{d as q,f as v,e as N,u as d,h as j,w as M,Y as B,a6 as Q,ab as Y,ae as G,aq as H,aa as J,a9 as F,Q as K,ah as W,ai as X,k as D,ac as Z,E as x,ad as ee}from"./tinymce-vendor-3c2b3d6e.js";import{z as ae,ag as te,o as ne,ax as oe}from"./antd-vue-vendor-05bfa84d.js";import{ar as se,v as ie,B as le,_ as re}from"./jeecg-online-vendor-f57c6456.js";import{useRuleFormItem as ue}from"./useFormItem-613b6d5d.js";import{p as m}from"./index-37448b2d.js";import"./vxe-table-vendor-26792376.js";const de=q({name:"ApiSelect",components:{Select:ae,LoadingOutlined:te},inheritAttrs:!1,props:{value:[Array,Object,String,Number],numberToString:m.bool,api:{type:Function,default:null},params:{type:Object,default:()=>({})},resultField:m.string.def(""),labelField:m.string.def("label"),valueField:m.string.def("value"),immediate:m.bool.def(!0)},emits:["options-change","change"],setup(e,{emit:n}){const t=v([]),c=v(!1),l=v(!0),f=v([]),i=se(),{t:r}=le(),[o,u]=ue(e,"value","change",f);let h;const T=N(()=>{let a=d(i)||{};return a&&a["onUpdate:value"]&&(h=a["onUpdate:value"],delete a["onUpdate:value"]),a.filterOption===void 0&&(a.filterOption=(s,p)=>typeof p.label=="string"?p.label.toLowerCase().indexOf(s.toLowerCase())!=-1:!0),a}),C=N(()=>{const{labelField:a,valueField:s,numberToString:p}=e;return d(t).reduce((w,g)=>{if(g){const A=g[s];w.push(k($({},ne(g,[a,s])),{label:g[a],value:p?`${A}`:A}))}return w},[])});j(()=>{e.immediate&&b()}),M(()=>e.params,()=>{!d(l)&&b()},{deep:!0}),j(()=>{e.value&&S()});function b(){return y(this,null,function*(){const a=e.api;if(!(!a||!ie(a))){t.value=[];try{c.value=!0;const s=yield a(e.params);if(Array.isArray(s)){t.value=s,O();return}e.resultField&&(t.value=oe(s,e.resultField)||[]),O()}catch(s){}finally{c.value=!1,d(i).mode=="multiple"&&!Array.isArray(d(o))&&u([]),U()}}})}function U(){let a=e.value;a&&typeof a=="string"&&a!="null"&&a!="undefined"&&(o.value=a.split(","))}function S(){return y(this,null,function*(){!e.immediate&&d(l)&&(yield b(),l.value=!1)})}function O(){n("options-change",d(C))}function I(a,...s){h&&h(a),f.value=s}return{state:o,attrs_:T,attrs:i,getOptions:C,loading:c,t:r,handleFetch:S,handleChange:I}}});function ce(e,n,t,c,l,f){const i=B("LoadingOutlined"),r=B("Select");return Q(),Y(r,G({onDropdownVisibleChange:e.handleFetch},e.attrs_,{onChange:e.handleChange,options:e.getOptions,value:e.state,"onUpdate:value":n[0]||(n[0]=o=>e.state=o)}),H({_:2},[J(Object.keys(e.$slots),o=>({name:o,fn:F(u=>[K(e.$slots,o,W(X(u||{})))])})),e.loading?{name:"suffixIcon",fn:F(()=>[D(i,{spin:""})]),key:"0"}:void 0,e.loading?{name:"notFoundContent",fn:F(()=>[Z("span",null,[D(i,{spin:"",class:"mr-1"}),x(" "+ee(e.t("component.form.apiSelectNotFound")),1)])]),key:"1"}:void 0]),1040,["onDropdownVisibleChange","onChange","options","value"])}const ye=re(de,[["render",ce]]);export{ye as default};
