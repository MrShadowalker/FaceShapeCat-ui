var U=(a,D,_)=>new Promise((s,i)=>{var g=c=>{try{l(_.next(c))}catch(u){i(u)}},r=c=>{try{l(_.throw(c))}catch(u){i(u)}},l=c=>c.done?s(c.value):Promise.resolve(c.value).then(g,r);l((_=_.apply(a,D)).next())});import{d as O,f as v,l as N,a4 as J,a5 as Y,ac as y,Y as w,a6 as f,ab as b,a9 as d,E,Z,k as m,a7 as L,F as z,aa as q,ad as x}from"./tinymce-vendor-3c2b3d6e.js";import{B as G}from"./index-64ecc8b2.js";import{g as K,a as P,w as Q,d as X}from"./ThirdApp.api-bf73b8d7.js";import{C as ee,g as ae}from"./index-37448b2d.js";import{u as te,C as se,_ as ne}from"./jeecg-online-vendor-f57c6456.js";import{M as W}from"./antd-vue-vendor-05bfa84d.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";const oe=O({name:"ThirdAppBindWeEnterpriseModal",components:{BasicModal:G},setup(a,{emit:D}){const _=v("企业微信绑定"),s=v({}),i=v(!1),g=v(!1),{createMessage:r}=se(),l=v([]),c=v(""),u=v(!1),k=te(),[C,{closeModal:S}]=ee(e=>U(this,null,function*(){i.value=!0,e.izBind?yield n():yield R(),u.value=e.izBind}));function R(){return U(this,null,function*(){yield K().then(e=>{if(e.success){let t=e.result.userList;s.value=e.result,l.value=e.result.userList,i.value=!1}else r.warning(e.message),i.value=!1})})}function n(){return U(this,null,function*(){yield P().then(e=>{e.success?(s.value.jwUserDepartVos=e.result,i.value=!1):(r.warn(e.message),i.value=!1)})})}function B(){return U(this,null,function*(){g.value=!0;let e=s.value.userList,t=[];for(const o of s.value.jwUserDepartVos)o.wechatUserId&&(e=e.filter(h=>h.wechatUserId!=o.wechatUserId),t.push({wechatUserId:o.wechatUserId,wechatDepartId:o.wechatDepartId,wechatRealName:o.wechatRealName,userId:o.userId}));let p="";if(e&&e.length>0){for(const o of e)t.push({wechatUserId:o.wechatUserId,wechatDepartId:o.wechatDepartId,wechatRealName:o.wechatRealName});p="检测到未绑定的企业微信用户 "+e.length+" 位，平台将会为这 "+e.length+" 位用户创建新的账号"}W.confirm({title:"确认同步",content:p,okText:"确认",onOk:()=>{let o=JSON.stringify(t);Q({jwUserDepartJson:o}).then(h=>{let F={};h.success&&(h.result&&(F={width:600,title:h.message,content:()=>{let j,$=["成功信息如下：",A(N,h.result.successInfo.map((V,T)=>`${T+1}. ${V}`).join(`
`))];return h.success?j=[...$,N("br"),"无失败信息！"]:j=["失败信息如下：",A(N,h.result.failInfo.map((V,T)=>`${T+1}. ${V}`).join(`
`)),N("br"),...$],j}}),S(),D("success",F,h))}).finally(()=>{g.value=!1})}})})}function I(e,t,p){s.value.jwUserDepartVos[p].wechatUserId=t.wechatUserId,s.value.jwUserDepartVos[p].wechatRealName=t.wechatRealName,s.value.jwUserDepartVos[p].wechatDepartId=t.wechatDepartId,l.value=l.value.filter(o=>o.wechatUserId!=t.wechatUserId)}function M(e,t){u.value?W.confirm({title:"确认取消绑定吗",okText:"确认",onOk:()=>U(this,null,function*(){yield X({id:t.thirdId,sysUserId:k.getUserInfo.id}).then(p=>{p.success?(r.success("取消绑定成功！"),n()):r.warning(p.message)})})}):(l.value.push({wechatUserId:t.wechatUserId,wechatRealName:t.wechatRealName,wechatDepartId:t.wechatDepartId}),s.value.jwUserDepartVos[e].wechatUserId="",s.value.jwUserDepartVos[e].wechatRealName="",s.value.jwUserDepartVos[e].wechatDepartId="")}function A(e,t){return e("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},t)}return{title:_,registerModal:C,handleSubmit:B,bindData:s,getFileAccessHttpUrl:ae,loading:i,userList:l,handleSelect:I,handleRemoveClick:M,btnLoading:g,izBind:u}}});const H=a=>(J("data-v-91c5edbc"),a=a(),Y(),a),le={class:"we-bind"},re=H(()=>y("span",null,"组织用户",-1)),ce=H(()=>y("span",null,"企业微信用户",-1)),de={class:"we-account"},ie={class:"we-account"},ue={key:0,class:"we-remove"},pe=["onClick"];function he(a,D,_,s,i,g){const r=w("a-col"),l=w("a-row"),c=w("a-avatar"),u=w("a-input"),k=w("a-select"),C=w("a-spin"),S=w("a-button"),R=w("BasicModal");return f(),b(R,{onRegister:a.registerModal,width:800,title:a.title,destroyOnClose:""},{footer:d(()=>[a.izBind?Z("",!0):(f(),b(S,{key:0,type:"primary",onClick:a.handleSubmit},{default:d(()=>[E("同步")]),_:1},8,["onClick"]))]),default:d(()=>[m(C,{spinning:a.loading},{default:d(()=>[y("div",le,[m(l,{span:24,class:"we-title-background"},{default:d(()=>[m(r,{span:12,class:"border-right"},{default:d(()=>[re]),_:1}),m(r,{span:12,class:"padding-left"},{default:d(()=>[ce]),_:1})]),_:1}),m(l,{span:24},{default:d(()=>[(f(!0),L(z,null,q(a.bindData.jwUserDepartVos,(n,B)=>(f(),L(z,null,[m(r,{span:12,class:"border-right padding-left border-bottom"},{default:d(()=>[y("div",de,[n.avatar?(f(),b(c,{key:0,src:a.getFileAccessHttpUrl(n.avatar),size:28},null,8,["src"])):(f(),b(c,{key:1,size:28},{default:d(()=>[E(x(n.realName.length>2?n.realName.substr(0,2):n.realName),1)]),_:2},1024)),m(u,{style:{"margin-left":"20px"},value:n.realName,readonly:""},null,8,["value"])])]),_:2},1024),m(r,{span:12,class:"padding-left border-bottom"},{default:d(()=>[y("div",ie,[n.wechatUserId||a.izBind?(f(),L("span",ue,[E(x(n.wechatRealName)+" ",1),y("span",{style:{"margin-right":"20px"},onClick:I=>a.handleRemoveClick(B,n)},"移出",8,pe)])):(f(),b(k,{key:1,value:n.wechatUserId,"onUpdate:value":I=>n.wechatUserId=I,options:a.userList,fieldNames:{label:"wechatRealName",value:"wechatUserId"},style:{width:"200px"},showSearch:"",onSelect:(I,M)=>a.handleSelect(I,M,B)},null,8,["value","onUpdate:value","options","onSelect"]))])]),_:2},1024)],64))),256))]),_:1})])]),_:1},8,["spinning"])]),_:1},8,["onRegister","title"])}const De=ne(oe,[["render",he],["__scopeId","data-v-91c5edbc"]]);export{De as default};
