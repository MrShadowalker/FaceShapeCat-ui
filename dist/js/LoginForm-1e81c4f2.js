var z=(E,l,d)=>new Promise((i,v)=>{var _=u=>{try{g(d.next(u))}catch(y){v(y)}},o=u=>{try{g(d.throw(u))}catch(y){v(y)}},g=u=>u.done?i(u.value):Promise.resolve(u.value).then(_,o);g((d=d.apply(E,l)).next())});import{d as V,f as S,r as q,e as G,u as e,o as W,a6 as F,a7 as R,q as K,A as U,k as s,a9 as a,E as p,ad as f,ac as C,aj as Q,a8 as X,F as H,I as J}from"./tinymce-vendor-3c2b3d6e.js";import{c as Y}from"./checkcode-5ec5fe8f.js";import{bf as Z,j as $,F as ee,B as k,X as se,b1 as te,bg as ae,b3 as oe,a5 as j,a7 as ne,a6 as le}from"./antd-vue-vendor-05bfa84d.js";import ie from"./LoginFormTitle-a753d4da.js";import re from"./ThirdModal-2b91df07.js";import{u as de,bc as ue,bd as ce,bi as x,B as me,C as pe,be as fe,bj as ge}from"./jeecg-online-vendor-f57c6456.js";import{k as ye}from"./index-37448b2d.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./useThirdLogin-b70adaa5.js";import"./vxe-table-vendor-26792376.js";const Ce=["src"],Te=V({__name:"LoginForm",setup(E){const l=ne,d=le,i=j.Item,v=$.Password,_=Z({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:o}=me(),{notification:g,createErrorModal:u}=pe(),{prefixCls:y}=ye("login"),N=de(),{setLoginState:w,getLoginState:A}=ue(),{getFormRules:O}=ce(),T=S(),D=S(),I=S(!1),L=S(!1),c=q({account:"admin",password:"123456",inputCode:""}),m=q({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:P}=fe(T),M=G(()=>e(A)===x.LOGIN);function B(){return z(this,null,function*(){const r=yield P();if(r)try{I.value=!0;const{userInfo:t}=yield N.login(J({password:r.password,username:r.account,captcha:r.inputCode,checkKey:m.checkKey,mode:"none"}));t&&g.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${t.realname}`,duration:3})}catch(t){g.error({message:o("sys.api.errorTip"),description:t.message||o("sys.api.networkExceptionMsg"),duration:3}),I.value=!1,h()}})}function h(){c.inputCode="",m.checkKey=1629428467008,ge(m.checkKey).then(r=>{m.randCodeImage=r,m.requestCodeSuccess=!0})}function b(r){D.value.onThirdLogin(r)}return W(()=>{h()}),(r,t)=>(F(),R(H,null,[K(s(ie,{class:"enter-x"},null,512),[[U,M.value]]),K(s(e(j),{class:"p-4 enter-x",model:c,rules:e(O),ref_key:"formRef",ref:T,onKeypress:X(B,["enter"])},{default:a(()=>[s(e(i),{name:"account",class:"enter-x"},{default:a(()=>[s(e($),{size:"large",value:c.account,"onUpdate:value":t[0]||(t[0]=n=>c.account=n),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:a(()=>[s(e(v),{size:"large",visibilityToggle:"",value:c.password,"onUpdate:value":t[1]||(t[1]=n=>c.password=n),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(l),{span:12},{default:a(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:a(()=>[s(e($),{size:"large",value:c.inputCode,"onUpdate:value":t[2]||(t[2]=n=>c.inputCode=n),placeholder:e(o)("sys.login.inputCode"),style:{"min-width":"100px"}},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(l),{span:8},{default:a(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:a(()=>[m.requestCodeSuccess?(F(),R("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:h},null,8,Ce)):(F(),R("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:Y,onClick:h}))]),_:1})]),_:1})]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(l),{span:12},{default:a(()=>[s(e(i),null,{default:a(()=>[s(e(ee),{checked:L.value,"onUpdate:checked":t[3]||(t[3]=n=>L.value=n),size:"small"},{default:a(()=>[p(f(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(l),{span:12},{default:a(()=>[s(e(i),{style:{"text-align":"right"}},{default:a(()=>[s(e(k),{type:"link",size:"small",onClick:t[4]||(t[4]=n=>e(w)(e(x).RESET_PASSWORD))},{default:a(()=>[p(f(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:a(()=>[s(e(k),{type:"primary",size:"large",block:"",onClick:B,loading:I.value},{default:a(()=>[p(f(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(l),{md:8,xs:24},{default:a(()=>[s(e(k),{block:"",onClick:t[5]||(t[5]=n=>e(w)(e(x).MOBILE))},{default:a(()=>[p(f(e(o)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:a(()=>[s(e(k),{block:"",onClick:t[6]||(t[6]=n=>e(w)(e(x).QR_CODE))},{default:a(()=>[p(f(e(o)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:7,xs:24},{default:a(()=>[s(e(k),{block:"",onClick:t[7]||(t[7]=n=>e(w)(e(x).REGISTER))},{default:a(()=>[p(f(e(o)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(se),{class:"enter-x"},{default:a(()=>[p(f(e(o)("sys.login.otherSignIn")),1)]),_:1}),C("div",{class:Q(["flex justify-evenly enter-x",`${e(y)}-sign-in-way`])},[C("a",{onClick:t[8]||(t[8]=n=>b("github")),title:"github"},[s(e(te))]),C("a",{onClick:t[9]||(t[9]=n=>b("wechat_enterprise")),title:"企业微信"},[s(e(_),{class:"item-icon",type:"icon-qiyeweixin3"})]),C("a",{onClick:t[10]||(t[10]=n=>b("dingtalk")),title:"钉钉"},[s(e(ae))]),C("a",{onClick:t[11]||(t[11]=n=>b("wechat_open")),title:"微信"},[s(e(oe))])],2)]),_:1},8,["model","rules"]),[[U,M.value]]),s(re,{ref_key:"thirdModalRef",ref:D},null,512)],64))}});export{Te as default};
