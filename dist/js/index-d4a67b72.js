var we=Object.defineProperty,Ne=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var se=(e,k,h)=>k in e?we(e,k,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[k]=h,I=(e,k)=>{for(var h in k||(k={}))Ie.call(k,h)&&se(e,h,k[h]);if(ce)for(var h of ce(k))Ue.call(k,h)&&se(e,h,k[h]);return e},re=(e,k)=>Ne(e,Me(k));var ie=(e,k,h)=>new Promise((A,p)=>{var v=C=>{try{y(h.next(C))}catch(D){p(D)}},s=C=>{try{y(h.throw(C))}catch(D){p(D)}},y=C=>C.done?A(C.value):Promise.resolve(C.value).then(v,s);y((h=h.apply(e,k)).next())});import{d as Se,f as Ke,ap as Pe,e as M,w as P,a6 as N,a7 as H,u as c,Q as Oe,Z as U,ab as G,a9 as j,E as oe,ad as de,aj as ue,k as L,F as Z,aa as He,ah as je,ai as Ve,z as Re,l as Xe,r as he,h as V,o as Ye,I as $,q as ye,A as fe,ae as $e,i as ze}from"./tinymce-vendor-3c2b3d6e.js";import{aR as Qe,aS as qe,aT as Ge,n as Je,D as Ze,d as W,o as We,S as et,Q as tt,l as ke,aU as nt,ax as at}from"./antd-vue-vendor-05bfa84d.js";import{b as lt,B as ct,l as ee,a1 as st,w as rt,z as it}from"./index-37448b2d.js";import{B as ot,N as pe,J as dt,aS as ut,b5 as ht,w as yt,v as J,at as ge,am as ft}from"./jeecg-online-vendor-f57c6456.js";import{createBEM as xe}from"./bem-a6e46c9e.js";import{b as kt,i as pt}from"./props-3977d3d5.js";import{useContextMenu as gt}from"./useContextMenu-3e9e42e0.js";var T=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(T||{});const St=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Kt=kt({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),xt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},Lt=Se({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:k}){const h=Ke(""),[A]=xe("tree-header"),p=e,v=k,s=Pe(),{t:y}=ot(),C=M(()=>["mr-1","w-full",{"ml-5":s.headerTitle||p.title}]),D=M(()=>{const{checkable:t}=p,l=[{label:y("component.tree.expandAll"),value:T.EXPAND_ALL},{label:y("component.tree.unExpandAll"),value:T.UN_EXPAND_ALL,divider:t}];return t?[{label:y("component.tree.selectAll"),value:T.SELECT_ALL},{label:y("component.tree.unSelectAll"),value:T.UN_SELECT_ALL,divider:t},...l,{label:y("component.tree.checkStrictly"),value:T.CHECK_STRICTLY},{label:y("component.tree.checkUnStrictly"),value:T.CHECK_UN_STRICTLY}]:l});function B(t){var a,i,r,f;const{key:l}=t;switch(l){case T.SELECT_ALL:(a=p.checkAll)==null||a.call(p,!0);break;case T.UN_SELECT_ALL:(i=p.checkAll)==null||i.call(p,!1);break;case T.EXPAND_ALL:(r=p.expandAll)==null||r.call(p,!0);break;case T.UN_EXPAND_ALL:(f=p.expandAll)==null||f.call(p,!1);break;case T.CHECK_STRICTLY:v("strictly-change",!1);break;case T.CHECK_UN_STRICTLY:v("strictly-change",!0);break}}function u(t){v("search",t)}const o=lt(u,200);return P(()=>h.value,t=>{o(t)}),P(()=>p.searchText,t=>{t!==h.value&&(h.value=t)}),(t,l)=>(N(),H("div",{class:ue([c(A)(),"flex px-2 py-1.5 items-center"])},[c(s).headerTitle?Oe(t.$slots,"headerTitle",{key:0}):U("",!0),!c(s).headerTitle&&t.title?(N(),G(c(ct),{key:1,helpMessage:t.helpMessage},{default:j(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):U("",!0),t.search||t.toolbar?(N(),H("div",xt,[t.search?(N(),H("div",{key:0,class:ue(C.value)},[L(c(Qe),{placeholder:c(y)("common.searchText"),size:"small",allowClear:"",value:h.value,"onUpdate:value":l[0]||(l[0]=a=>h.value=a),onSearch:l[1]||(l[1]=a=>t.$emit("clickSearch",a))},null,8,["placeholder","value"])],2)):U("",!0),t.toolbar?(N(),G(c(Ze),{key:1,onClick:l[2]||(l[2]=Re(()=>{},["prevent"]))},{overlay:j(()=>[L(c(Je),{onClick:B},{default:j(()=>[(N(!0),H(Z,null,He(D.value,a=>(N(),H(Z,{key:a.value},[L(c(qe),je(Ve({key:a.value})),{default:j(()=>[oe(de(a.label),1)]),_:2},1040),a.divider?(N(),G(c(Ge),{key:0})):U("",!0)],64))),128))]),_:1})]),default:j(()=>[L(c(ee),{icon:"ion:ellipsis-vertical"})]),_:1})):U("",!0)])):U("",!0)],2))}}),Ct=({icon:e})=>e?pt(e)?Xe(ee,{icon:e,class:"mr-1"}):ee:null;function At(e,k){function h(u){const o=[],t=u||c(e),{key:l,children:a}=c(k);if(!a||!l)return o;for(let i=0;i<t.length;i++){const r=t[i];o.push(r[l]);const f=r[a];f&&f.length&&o.push(...h(f))}return o}function A(u){const o=[],t=u||c(e),{key:l,children:a}=c(k);if(!a||!l)return o;for(let i=0;i<t.length;i++){const r=t[i];r.disabled!==!0&&r.selectable!==!1&&o.push(r[l]);const f=r[a];f&&f.length&&o.push(...A(f))}return o}function p(u,o){const t=[],l=o||c(e),{key:a,children:i}=c(k);if(!i||!a)return t;for(let r=0;r<l.length;r++){const f=l[r],E=f[i];u===f[a]?(t.push(f[a]),E&&E.length&&t.push(...h(E))):E&&E.length&&t.push(...p(u,E))}return t}function v(u,o,t){if(!u)return;const l=t||c(e),{key:a,children:i}=c(k);if(!(!i||!a))for(let r=0;r<l.length;r++){const f=l[r],E=f[i];if(f[a]===u){l[r]=I(I({},l[r]),o);break}else E&&E.length&&v(u,o,f[i])}}function s(u=1,o,t=1){if(!u)return[];const l=[],a=o||c(e)||[];for(let i=0;i<a.length;i++){const r=a[i],{key:f,children:E}=c(k),z=f?r[f]:"",O=E?r[E]:[];l.push(z),O&&O.length&&t<u&&(t+=1,l.push(...s(u,O,t)))}return l}function y({parentKey:u=null,node:o,push:t="push"}){const l=W(c(e));if(!u){l[t](o),e.value=l;return}const{key:a,children:i}=c(k);!i||!a||(pe(l,r=>{if(r[a]===u)return r[i]=r[i]||[],r[i][t](o),!0}),e.value=l)}function C({parentKey:u=null,list:o,push:t="push"}){const l=W(c(e));if(!(!o||o.length<1))if(u){const{key:a,children:i}=c(k);if(!i||!a)return;pe(l,r=>{if(r[a]===u){r[i]=r[i]||[];for(let f=0;f<o.length;f++)r[i][t](o[f]);return e.value=l,!0}})}else for(let a=0;a<o.length;a++)l[t](o[a])}function D(u,o){if(!u)return;const t=o||c(e),{key:l,children:a}=c(k);if(!(!a||!l))for(let i=0;i<t.length;i++){const r=t[i],f=r[a];if(r[l]===u){t.splice(i,1);break}else f&&f.length&&D(u,r[a])}}function B(u,o,t){return!u&&u!==0?null:((o||c(e)).forEach(a=>{if(t!=null&&t.key||(t==null?void 0:t.key)===0)return t;if(a.key===u){t=a;return}a.children&&a.children.length&&(t=B(u,a.children,t))}),t||null)}return{deleteNodeByKey:D,insertNodeByKey:y,insertNodesByKey:C,filterByLevel:s,updateNodeByKey:v,getAllKeys:h,getChildrenKeys:p,getEnabledKeys:A,getSelectedNode:B}}function vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ze(e)}const wt=Se({name:"BasicTree",inheritAttrs:!1,props:Kt,emits:St,setup(e,{attrs:k,slots:h,emit:A,expose:p}){const[v]=xe("tree"),s=he({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),y=he({startSearch:!1,searchText:"",searchData:[]}),C=Ke([]),[D]=gt(),B=M(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),u=M(()=>{let n=re(I(I({blockNode:!0},k),e),{expandedKeys:s.expandedKeys,selectedKeys:s.selectedKeys,checkedKeys:s.checkedKeys,checkStrictly:s.checkStrictly,fieldNames:c(B),"onUpdate:expandedKeys":d=>{s.expandedKeys=d,A("update:expandedKeys",d)},"onUpdate:selectedKeys":d=>{s.selectedKeys=d,A("update:selectedKeys",d)},onCheck:(d,K)=>{let g=$(s.checkedKeys);if(yt(g)&&y.startSearch){const x=K.node.eventKey;g=nt(g,z(x)),K.checked&&g.push(x),s.checkedKeys=g}else s.checkedKeys=d;const S=$(s.checkedKeys);A("update:value",S),A("check",S,K)},onRightClick:Ae});return We(n,"treeData","class")}),o=M(()=>y.startSearch?y.searchData:c(C)),t=M(()=>!o.value||o.value.length===0),{deleteNodeByKey:l,insertNodeByKey:a,insertNodesByKey:i,filterByLevel:r,updateNodeByKey:f,getAllKeys:E,getChildrenKeys:z,getEnabledKeys:O,getSelectedNode:Le}=At(C,B);function Ce(n,d){return!d&&e.renderIcon&&J(e.renderIcon)?e.renderIcon(n):d}function Ae(K){return ie(this,arguments,function*({event:n,node:d}){var m;const{rightMenuList:g=[],beforeRightClick:S}=e;let x={event:n,items:[]};if(S&&J(S)){let b=yield S(d,n);Array.isArray(b)?x.items=b:Object.assign(x,b)}else x.items=g;(m=x.items)!=null&&m.length&&(x.items=x.items.filter(b=>!b.hidden),D(x))})}function R(n){s.expandedKeys=n}function ve(){return s.expandedKeys}function te(n){s.selectedKeys=n}function Ee(){return s.selectedKeys}function ne(n){s.checkedKeys=n}function Te(){return s.checkedKeys}function ae(n){s.checkedKeys=n?O():[]}function Q(n){s.expandedKeys=n?E():[]}function be(n){s.checkStrictly=n}P(()=>e.searchValue,n=>{n!==y.searchText&&(y.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&q(y.searchText)});function q(n){if(n!==y.searchText&&(y.searchText=n),A("update:searchValue",n),!n){y.startSearch=!1;return}const{filterFn:d,checkable:K,expandOnSearch:g,checkOnSearch:S,selectedOnSearch:x}=c(e);y.startSearch=!0;const{title:m,key:b}=c(B),F=[];if(y.searchData=dt(c(C),_=>{var X,Y;const w=d?d(n,_,c(B)):(Y=(X=_[m])==null?void 0:X.includes(n))!=null?Y:!1;return w&&F.push(_[b]),w},c(B)),g){const _=ut(y.searchData).map(w=>w[b]);_&&_.length&&R(_)}S&&K&&F.length&&ne(F),x&&F.length&&te(F)}function _e(n,d){if(!(!e.clickRowToExpand||!d||d.length===0))if(!s.expandedKeys.includes(n))R([...s.expandedKeys,n]);else{const K=[...s.expandedKeys],g=K.findIndex(S=>S===n);g!==-1&&K.splice(g,1),R(K)}}V(()=>{C.value=e.treeData}),Ye(()=>{const n=parseInt(e.defaultExpandLevel);n>0?s.expandedKeys=r(n):e.defaultExpandAll&&Q(!0)}),V(()=>{s.expandedKeys=e.expandedKeys}),V(()=>{s.selectedKeys=e.selectedKeys}),V(()=>{s.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{s.checkedKeys=$(e.value||e.checkedKeys||[])},{immediate:!0}),P(()=>s.checkedKeys,()=>{const n=$(s.checkedKeys);A("update:value",n),A("change",n)}),V(()=>{s.checkStrictly=e.checkStrictly});const Be={setExpandedKeys:R,getExpandedKeys:ve,setSelectedKeys:te,getSelectedKeys:Ee,setCheckedKeys:ne,getCheckedKeys:Te,insertNodeByKey:a,insertNodesByKey:i,deleteNodeByKey:l,updateNodeByKey:f,getSelectedNode:Le,checkAll:ae,expandAll:Q,filterByLevel:n=>{s.expandedKeys=r(n)},setSearchValue:n=>{q(n)},getSearchValue:()=>y.searchText};function De(n){const{actionList:d}=e;if(!(!d||d.length===0))return d.map((K,g)=>{var x;let S=!0;return J(K.show)?S=(x=K.show)==null?void 0:x.call(K,n):ge(K.show)&&(S=K.show),S?L("span",{key:g,class:v("action")},[K.render(n)]):null})}const Fe=M(()=>{const n=W(o.value);return ht(n,(d,K)=>{var le;const g=y.searchText,{highlight:S}=c(e),{title:x,key:m,children:b}=c(B),F=Ce(d,d.icon),_=at(d,x),w=g?_.indexOf(g):-1,X=y.startSearch&&!ft(g)&&S&&w!==-1,Y=`color: ${ge(S)?"#f50":S}`,me=X?L("span",{class:(le=c(u))!=null&&le.blockNode?`${v("content")}`:""},[L("span",null,[_.substr(0,w)]),L("span",{style:Y},[g]),L("span",null,[_.substr(w+g.length)])]):_;return d[x]=L("span",{class:`${v("title")} pl-2`,onClick:_e.bind(null,d[m],d[b])},[h!=null&&h.title?it(h,"title",d):L(Z,null,[F&&L(Ct,{icon:F},null),me,L("span",{class:v("actions")},[De(d)])])]),d}),n});return p(Be),()=>{let n;const{title:d,helpMessage:K,toolbar:g,search:S,checkable:x}=e,m=d||g||S||h.headerTitle,b={height:"calc(100% - 38px)"};return L("div",{class:[v(),"h-full",k.class]},[m&&L(Lt,{checkable:x,checkAll:ae,expandAll:Q,title:d,search:S,toolbar:g,helpMessage:K,onStrictlyChange:be,onSearch:q,onClickSearch:F=>A("search",F),searchText:y.searchText},vt(n=st(h))?n:{default:()=>[n]}),L(et,{spinning:c(e.loading),tip:"加载中..."},{default:()=>[ye(L(rt,{style:b},{default:()=>[L(tt,$e(c(u),{showIcon:!1,treeData:Fe.value}),null)]}),[[fe,!c(t)]]),ye(L(ke,{image:ke.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[fe,c(t)]])]})])}}});export{wt as _};
