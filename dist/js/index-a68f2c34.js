var D=Object.defineProperty;var I=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var x=(e,s,l)=>s in e?D(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,B=(e,s)=>{for(var l in s||(s={}))O.call(s,l)&&x(e,l,s[l]);if(I)for(var l of I(s))V.call(s,l)&&x(e,l,s[l]);return e};var U=(e,s,l)=>new Promise((y,o)=>{var S=r=>{try{c(l.next(r))}catch(f){o(f)}},h=r=>{try{c(l.throw(r))}catch(f){o(f)}},c=r=>r.done?y(r.value):Promise.resolve(r.value).then(S,h);c((l=l.apply(e,s)).next())});import{d as H,f as M,e as v,w as T,I as Y,a4 as me,a5 as ye,Y as b,a6 as u,a7 as m,aj as Z,F as E,aa as F,ab as _,ac as L,ad as G,Z as C,a9 as J,k as z}from"./tinymce-vendor-3c2b3d6e.js";import{aI as K,a5 as W}from"./antd-vue-vendor-05bfa84d.js";import"./index-64ecc8b2.js";import{U as X,m as A,a as ee}from"./UserSelectModal-bbf30df5.js";import{ap as te,_ as se}from"./jeecg-online-vendor-f57c6456.js";import le from"./SelectedUserItem-6a7f0563.js";import{E as oe}from"./index-37448b2d.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";import"./UserList-9509c9fd.js";import"./UserListAndDepart-7270315e.js";import"./UserListAndRole-64eda5ed.js";const ne=H({name:"UserSelect",components:{PlusOutlined:K,UserSelectModal:X,SelectedUserItem:le},props:{store:{type:String,default:"id"},value:{type:String,default:""},multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},query:{type:Boolean,default:!1},maxCount:{type:Number,default:2},disabled:{type:Boolean,default:!1},izExcludeMy:{type:Boolean,default:!1},inSuperQuery:{type:Boolean,default:!1}},emits:["update:value","change"],setup(e,{emit:s}){const l=W.useInjectFormItemContext(),y=M(!0),o=M([]),S=v(()=>{let t=o.value,n=e.maxCount;return t.length<=n?t:t.filter((i,a)=>a<n)}),h=v(()=>{let t=e.maxCount,n=o.value.length;return n>t?{status:!0,count:n-t}:{status:!1}}),[c,{openModal:r,closeModal:f}]=oe();function d(){if(e.disabled===!0)return;let t=Y(o.value);r(!0,{list:t})}function j(t){o.value=t,k(),f()}function k(){y.value=!1;let t=[],n=o.value;n&&n.length>0&&(t=n.map(a=>a[e.store]));let i=t.join(",");s("update:value",i),s("change",i),l.onFieldChange()}T(()=>e.value,t=>U(this,null,function*(){t?y.value===!0&&(yield N(t)):o.value=[],y.value=!0}),{immediate:!0});function N(t){return U(this,null,function*(){let n=!1,i=t,a=[];if(o.value=[],t){let g=t.split(",").map(p=>p.trim()).filter(p=>p!="");g.includes(A)?(n=!0,a=g.filter(p=>p!=A)):a=g}if(a.length>0){i=a.join(",");const g="/sys/user/list";let p={[e.store]:i};const w=yield te.get({url:g,params:p},{isTransformResponse:!1});if(w.success){const{records:q}=w.result;o.value=q}}n&&o.value.push(B({},ee))})}const P=v(()=>e.disabled===!0?!1:e.multi===!0?!0:!(o.value.length>0));function Q(t){let n=o.value,i=-1;for(let a=0;a<n.length;a++)if(n[a].id==t){i=a;break}i>=0&&(n.splice(i,1),o.value=n,k())}function R(t){t.preventDefault(),t.stopPropagation(),d()}const $=v(()=>e.query===!0);return{registerModal:c,onShowModal:d,isSearchFormComp:$,onSelected:j,showAddButton:P,unSelectUser:Q,selectedUserList:o,showUserList:S,ellipsisInfo:h,click2Add:R}}});const ae={key:1,style:{height:"30px","line-height":"30px",display:"inline-block","margin-left":"7px",color:"#bfbfbf"}},re={key:2,class:"user-selected-item"},ie={class:"user-select-ellipsis"},ue={style:{color:"red"}},de={key:1,style:{display:"flex","flex-wrap":"wrap","flex-direction":"row"}};function ce(e,s,l,y,o,S){const h=b("SelectedUserItem"),c=b("PlusOutlined"),r=b("a-button"),f=b("user-select-modal");return u(),m("div",null,[e.isSearchFormComp?(u(),m("div",{key:0,onClick:s[0]||(s[0]=(...d)=>e.click2Add&&e.click2Add(...d)),class:Z(e.disabled?"disabled-user-select":""),style:{padding:"0 5px","background-color":"#fff",border:"1px solid #ccc","border-radius":"3px","box-sizing":"border-box",display:"flex",color:"#9e9e9e","font-size":"14px","flex-wrap":"wrap","min-height":"32px"}},[e.selectedUserList.length>0?(u(!0),m(E,{key:0},F(e.showUserList,d=>(u(),_(h,{info:d,onUnSelect:e.unSelectUser,query:""},null,8,["info","onUnSelect"]))),256)):(u(),m("span",ae,"请选择用户")),e.ellipsisInfo.status?(u(),m("div",re,[L("div",ie,[L("span",ue,"+"+G(e.ellipsisInfo.count)+"...",1)])])):C("",!0)],2)):(u(),m("div",de,[e.selectedUserList.length>0?(u(!0),m(E,{key:0},F(e.selectedUserList,d=>(u(),_(h,{info:d,onUnSelect:e.unSelectUser},null,8,["info","onUnSelect"]))),256)):C("",!0),e.showAddButton?(u(),_(r,{key:1,shape:"circle",onClick:e.onShowModal},{default:J(()=>[z(c)]),_:1},8,["onClick"])):C("",!0)])),z(f,{inSuperQuery:e.inSuperQuery,multi:e.multi,getContainer:e.getContainer,onRegister:e.registerModal,onSelected:e.onSelected,izExcludeMy:e.izExcludeMy},null,8,["inSuperQuery","multi","getContainer","onRegister","onSelected","izExcludeMy"])])}const Be=se(ne,[["render",ce],["__scopeId","data-v-f987db35"]]);export{Be as default};
