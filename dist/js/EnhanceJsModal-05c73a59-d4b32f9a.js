import{d as $,f as p,r as H,Y as y,a6 as w,ab as T,a9 as s,k as d,E as k,Z as J}from"./tinymce-vendor-3c2b3d6e.js";import{B as q}from"./index-64ecc8b2.js";import"./index-09260ce4.js";import{J as I}from"./useOnlineTest-e4bd8be3-90aac6cd.js";import{E as G,u as z}from"./EnhanceJsHistory-352b46b1-ba18ac0e.js";import{q as L,b as Q}from"./enhance.api-138e6826-eef1fe1e.js";import{C as X,bs as Y}from"./jeecg-online-vendor-f57c6456.js";import{Q as Z}from"./JAddInput-a2153936.js";import{C as ee,E as te}from"./index-37448b2d.js";import"./BasicModal-9d388b71.js";import"./antd-vue-vendor-05bfa84d.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";import"./useForm-df7d93c5.js";import"./componentMap-e2e33057.js";import"./useFormItem-613b6d5d.js";import"./index-2ad3f236.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./JSelectUser-6efbe652.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./JImageUpload-1b0b2e46.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JSelectDept-073e3b74.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./useTreeBiz-a3326efb.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JPopup-8248ac78.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./JTreeSelect-73cfd2cd.js";import"./JEllipsis-242e7bd0.js";import"./JUpload-70acb676.js";import"./index-76418551.js";import"./JSearchSelect-4158b9a9.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";import"./formUtils-09c7de86.js";import"./areaDataUtil-10873080.js";import"./data-9be677e2.js";import"./index-2d7d6454.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./depart.api-76b2f38a.js";var E=(e,n,m)=>new Promise((v,f)=>{var o=r=>{try{u(m.next(r))}catch(a){f(a)}},i=r=>{try{u(m.throw(r))}catch(a){f(a)}},u=r=>r.done?v(r.value):Promise.resolve(r.value).then(o,i);u((m=m.apply(e,n)).next())});const R={list:[".acceptHrefParams",".currentPage",".currentTableName",".currentTableName",".description",".hasChildrenField",".ID",".pageSize",".queryParam",".selectedRowKeys",".selectedRows",".sortField",".sortType",".total",".loadData()",".clearSelectedRow()",".getLoadDataParams()",".isTree()","beforeEdit(row){ }","beforeDelete(row){ }","console.log()"],form:[".loading",".isUpdate",".onlineFormRef",".refMap",".subActiveKey",".sh",".submitFlowFlag",".subFormHeight",".subTableHeight",".tableName",".$nextTick",".addSubRows(tableName, rows)",".changeOptions(field, options)",".clearSubRows(tableName)",".clearThenAddRows(tableName, rows)",".getFieldsValue()",".getSubTableInstance(tableName)",".setFieldsValue(row)",".triggleChangeValues(values,id,target)",".triggleChangeValue(field, value)",".onlineFormValueChange(field, value, otherValus)","beforeSubmit(row){ }","loaded(){ }","onlChange(){ }","子表名_onlChange(){ }",".changeOptions()","getAction(url, param)","postAction(url, param)","putAction(url, param)","deleteAction(url, param)","console.log()"],common:["this",".openCustomModal(title,width,row,formComponent,requestUrl,hide,show)"]},oe=$({name:"EnhanceJs",components:{BasicModal:q,JCodeEditor:Z,EnhanceJsHistory:G},emits:["register"],setup(){const{createMessage:e}=X(),n=z(),m=p(),v=p(),f=H({form:{},list:{}}),o=p("list"),i=p(""),u=p(!1),r=p(!1),a=p(""),c=H({form:"",list:""}),g={form:!1,list:!1},b=p(!1),h=[...R.list,...R.common],K=[...R.form,...R.common],[D,{closeModal:S}]=ee(t=>E(this,null,function*(){A(t.row)})),[F,x]=te(),{aiTestMode:P,genEnhanceJsData:M}=I();function A(t){i.value=t.id,r.value=!1,a.value=t.tableName;let l=n.getEnhanceJs(i.value);(l==null?void 0:l.length)>0?(o.value=l[l.length-1].type,u.value=!0):u.value=!1,g.form=!1,g.list=!1,o.value?N(o.value):N("form"),b.value=!0,setTimeout(()=>b.value=!1,150)}function B(){return E(this,null,function*(){yield Promise.all([V("form"),V("list")]),S(),e.success("保存成功")})}function V(t){return E(this,null,function*(){let l=f[t],C={cgJs:c[t],cgJsType:t};if(!g[t]||l.cgJs===C.cgJs)return;let _=!!l.id;_&&(C=Object.assign({},l,C)),yield L(i.value,C,_),n.addEnhanceJs({code:i.value,str:C.cgJs,type:C.cgJsType,date:new Date().getTime()})})}function U(){S()}function N(t){return E(this,null,function*(){o.value=t;try{if(!g[t]){let l=yield Q(i.value,t);Object.assign(f[t],{id:null},l),c[t]=f[t].cgJs,g[t]=!0}}catch(l){}setTimeout(()=>{t=="list"?v.value.refresh():m.value.refresh()},150)})}function j(){x.openModal(!0,{code:i.value,type:o.value})}function O(t){c[o.value]!=t&&(r.value=!0,c[o.value]=t)}function W(){o.value==="form"?M(a.value,o.value,m.value):M(a.value,o.value,v.value)}return{formEditorRef:m,listEditorRef:v,reloading:b,enhanceValues:c,enhanceType:o,showHistory:u,aiTestMode:P,tableName:a,genEnhanceJsData:M,onGenTestData:W,onChangeType:N,onCodeChange:O,onShowHistory:j,onSubmit:B,onCancel:U,registerModal:D,registerEnhanceJsHistory:F,listKeyWords:h,formKeyWords:K}}});function ae(e,n,m,v,f,o){const i=y("JCodeEditor"),u=y("a-tab-pane"),r=y("a-tabs"),a=y("a-button"),c=y("a-space"),g=y("EnhanceJsHistory"),b=y("BasicModal");return w(),T(b,{onRegister:e.registerModal,title:"JS增强",width:800,bodyStyle:{height:"360px"}},{footer:s(()=>[d(c,null,{default:s(()=>[d(a,{onClick:e.onCancel},{default:s(()=>[k("关闭")]),_:1},8,["onClick"]),d(a,{type:"primary",onClick:e.onSubmit},{default:s(()=>[k("确定")]),_:1},8,["onClick"])]),_:1}),d(c,{style:{float:"left"}},{default:s(()=>[e.showHistory?(w(),T(a,{key:0,onClick:e.onShowHistory},{default:s(()=>[k("查看历史版本")]),_:1},8,["onClick"])):J("",!0),e.aiTestMode?(w(),T(a,{key:1,onClick:e.onGenTestData},{default:s(()=>[k("生成测试数据")]),_:1},8,["onClick"])):J("",!0)]),_:1})]),default:s(()=>[d(r,{activeKey:e.enhanceType,"onUpdate:activeKey":n[2]||(n[2]=h=>e.enhanceType=h),onChange:e.onChangeType},{default:s(()=>[d(u,{tab:"form",key:"form",forceRender:""},{default:s(()=>[!e.reloading&&e.enhanceType==="form"?(w(),T(i,{key:0,ref:"formEditorRef",value:e.enhanceValues.form,"onUpdate:value":n[0]||(n[0]=h=>e.enhanceValues.form=h),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange,keywords:e.formKeyWords},null,8,["value","onChange","keywords"])):J("",!0)]),_:1}),d(u,{tab:"list",key:"list",forceRender:""},{default:s(()=>[!e.reloading&&e.enhanceType==="list"?(w(),T(i,{key:0,ref:"listEditorRef",value:e.enhanceValues.list,"onUpdate:value":n[1]||(n[1]=h=>e.enhanceValues.list=h),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange,keywords:e.listKeyWords},null,8,["value","onChange","keywords"])):J("",!0)]),_:1})]),_:1},8,["activeKey","onChange"]),d(g,{onRegister:e.registerEnhanceJsHistory},null,8,["onRegister"])]),_:1},8,["onRegister"])}const lt=Y(oe,[["render",ae]]);export{lt as default};
