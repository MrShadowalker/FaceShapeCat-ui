import{e as A,h as Ce}from"./useExtendComponent-325fe3f1-007b9393.js";import{C as Te,b8 as Se,ap as O,I as Pe,ao as De,bv as Oe,aQ as xe}from"./jeecg-online-vendor-f57c6456.js";import{f as y,p as Ee,I as R,j as ke,n as ge,r as pe}from"./tinymce-vendor-3c2b3d6e.js";import{aJ as Re,o as Fe,m as we,E as N}from"./index-37448b2d.js";import{g as Ie,I as $e}from"./useCustomHook-acb00837-32b1f38e.js";import"./index-64ecc8b2.js";import{s as de,a as Me}from"./constant-754f1a9d-eadfd1e1.js";import{h as Ue}from"./cgformState-d9f8ec42-a08af090.js";import{p as je,M as Ne}from"./antd-vue-vendor-05bfa84d.js";var Be=Object.defineProperty,Qe=Object.defineProperties,Je=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,be=(l,u,c)=>u in l?Be(l,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[u]=c,U=(l,u)=>{for(var c in u||(u={}))Ke.call(u,c)&&be(l,c,u[c]);if(he)for(var c of he(u))ze.call(u,c)&&be(l,c,u[c]);return l},fe=(l,u)=>Qe(l,Je(u)),H=(l,u,c)=>new Promise((d,S)=>{var T=h=>{try{p(c.next(h))}catch(v){S(v)}},P=h=>{try{p(c.throw(h))}catch(v){S(v)}},p=h=>h.done?d(h.value):Promise.resolve(h.value).then(T,P);p((c=c.apply(l,u)).next())});const _e={acceptHrefParams:"<p> 跳转时获取的参数信息",currentPage:"<p> 当前页数",currentTableName:"<p> 当前表名",description:"<p> 当前表描述",hasChildrenField:"<p> 是否有子节点的字段名，仅树形表单下有效",isDesForm:"<p> xx",isTree:"<m> 是否是树形表单 ",loadData:"<m> 加载列表数据",pageSize:"<p> 每一页显示条数",queryParam:"<p> 查询条件对象，每次点击查询后才会更新此数据",selectedRowKeys:"<p> 选中的行的id数组",sortField:"<p> 排序字段",sortType:"<p> 排序规则",total:"<p> 总页数",foreignKeyValue:"<p> Erp一对多子表外键选中对应主表字段的值",isErpSubTable:"<p> 是否Erp一对多子表",foreignKeyField:"<p> Erp一对多子表外键字段",themeTemplate:"<p> 主题模板",isInnerSubTable:"<p> 是否内嵌一对多子表",innerSubTableName:"<p> 内嵌一对多子表名",mTableSelectedRcordId:"<p>内嵌主表展开行的id"},Le={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess",getErpColumns:"/online/cgform/api/getErpColumns/",list:"/online/cgform/api/subform/list/"};let ye={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const Ae={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(l,u)=>u[0]+"-"+u[1]+" 共"+l+"条",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:j,createErrorModal:He}=Te();function nt(l={}){var u;const c=(u=l.code)!=null?u:"",d=y(c);Ee("tableId",d);const S=Se(),T=y(),P=y(),p=y(!1),h=y([]),v=y(!0),B=y(),q=Ue();Re();let m={};const b={execButtonEnhance:function(n,e){if(o[A][n])if(Ce===n)w(n);else{let t=R(e);return o[A][n].call(o,o,t)}else if(o[A][n+"_hook"])if(e){let t=R(e);w(n+"_hook",t)}else w(n+"_hook")},isTree:function(n){return typeof n=="boolean"?(o.isTreeTable=n,n):o.isTreeTable}};function w(n,e){let t=o[A][n].toLocaleString().match(Ie);if(t.length>1){let r=t[1];V(r,e)}}const o=new Proxy(_e,{get(n,e){if(typeof b[e]=="function")return b[e];{let t=m[d.value];return Reflect.get(t,e)}},set(n,e,t){let r=Y();return Reflect.set(typeof t=="function"?b:r,e,t)},deleteProperty(n,e){return e===d.value?(delete m[e],!0):!1}}),{executeJsEnhanced:V}=$e({},o);function X(){let n=S.params.id;return n||(n=""),n}Fe(()=>{!c&&_(),d.value&&q.removeChangedTable(d.value)}),ke(()=>{delete m[d.value]});function Y(){let n=m[d.value];if(!n){l.themeTemplate==de&&(ye.pageSize=5);let e=Object.assign({},ye,{onlineUrl:Le});n=JSON.parse(JSON.stringify(e)),m[d.value]=n}return n}function Q(){let n={},e=S.query;e&&(Object.keys(e).map(t=>{n[t]=e[t]}),o.acceptHrefParams=n)}function J(n=""){let e;return n==de?e=`${o.onlineUrl.getErpColumns}${d.value}`:e=`${o.onlineUrl.getColumns}${d.value}`,new Promise((t,r)=>{O.get({url:e},{isTransformResponse:!1}).then(a=>{a.success?t(a.result):(j.warning(a.message),r())}).catch(()=>{r()})})}function x(){return new Promise((n,e)=>{let t=K(),r=`${o.onlineUrl.getData}${d.value}`;o.isTree()===!0?r=`${o.onlineUrl.getTreeData}${d.value}`:o.isInnerSubTable===!0&&(r=`${o.onlineUrl.list}${o.innerSubTableName}/${o.mTableSelectedRcordId}`,t={tabletype:3}),o.isErpSubTable===!0&&(t[o.foreignKeyField]=o.foreignKeyValue,delete t.hasQuery),O.get({url:r,params:t},{isTransformResponse:!1}).then(a=>{a.success?(o.isInnerSubTable===!0?F({records:a.result,total:a.result.length}):F(a.result),n(!0)):(a.message==="NO_DB_SYNC"?He({title:"数据库未同步",content:"请先同步数据库再查看此页面！",onOk:()=>Pe.back()}):j.warning(a.message),e(!1))}).catch(()=>{let a="请求列表数据异常!";j.warning(a),e(!1)})})}function K(){const{sortField:n,sortType:e,acceptHrefParams:t,queryParam:r}=o;let a={};o.isTree(),a.hasQuery="true";let s=Object.assign({},a,t,r,{column:n,order:e});p.value?(s.pageNo=p.value.current,s.pageSize=p.value.pageSize):s.pageSize=-521;let i=re();return s.superQueryMatchType=i.matchType||"",s.superQueryParams=i.params||"",we(s)}function F(n){let e=0;Number(n.total)>0?(o.isTree()===!0?(h.value=E(n.records),ge(()=>{z(h.value)})):h.value=n.records,e=Number(n.total)):h.value=[],p.value&&(p.value=fe(U({},p.value),{total:e}))}function W(n,e,t){t&&t.order?(o.sortField=t.field,o.sortType=t.order=="ascend"?"asc":"desc"):(o.sortField="id",o.sortType="asc"),p.value&&(p.value=n),x()}function Z(n){o.description=n.description,o.currentTableName=n.currentTableName,o.isDesForm=n.isDesForm,o.desFormCode=n.desFormCode,o.ID=d.value;let{acceptHrefParams:e,queryParam:t,superQuery:r,currentPage:a,pageSize:s}=o;Q(),t?T.value&&T.value.initDefaultValues(t,e):o.queryParam={},r?P.value&&P.value.initDefaultValues(r):o.superQuery={params:"",matchType:""},n.paginationFlag=="Y"?p.value=fe(U({},Ae),{current:a,pageSize:s}):p.value=!1}function G(){return H(this,null,function*(){v.value=!0,yield ge(),v.value=!1})}const D={loadData:x,getLoadDataParams:K,reloadTable:G};Object.keys(D).map(n=>{o[n]=D[n]});let ee=y(!1);function te(){return H(this,arguments,function*(n={}){p.value&&(p.value=fe(U({},p.value),{current:n.mode=="search"||!p.value.current?1:p.value.current})),l.themeTemplate!==de&&o.clearSelectedRow(),yield x()})}function E(n){if(n)return n.map(e=>{let t=o.hasChildrenField;if(e[t]=="1"){let r={id:e.id+"_loadChild",name:"loading...",isLoading:!0};r.jeecg_row_key=r.id,e.children=[r]}return e})}const k=y([]);function ne(n){k.value=n}function z(n){let e=k.value;if(e.length>0){const{sortField:t,sortType:r,pidField:a}=o;let s=Object.assign({},{column:t,order:r});s.hasQuery="in";let i=Object.assign({});i.rule="in",i.type="text",i.val=e.join(","),i.field=a,i=[i],s.superQueryParams=encodeURI(JSON.stringify(i)),s.superQueryMatchType="and",s.batchFlag="true";let f=`${o.onlineUrl.getTreeData}${d.value}`;O.get({url:f,params:s},{isTransformResponse:!1}).then(g=>{if(g.success&&g.result.records&&g.result.records.length>0){let ue=g.result.records;const $=new Map;for(let M of ue){let C=M[a];if(e.join(",").includes(C)){let L=$.get(C);L==null&&(L=[]),L.push(M),$.set(C,L)}}let ce=$,me=M=>{M&&M.forEach(C=>{e.includes(C.id)&&(C.children=E(ce.get(C.id)),me(C.children))})};me(n)}}).catch(()=>{let g="loadDataByExpandedRows请求列表数据异常!";j.warning(g)})}else return Promise.resolve()}function re(){if(!o.superQuery)return{};const{superQuery:{params:n,matchType:e},currentTableName:t}=o;let r=t+"@",a=[];if(n.length>0)for(let i of n){let f=U({},i),g=f.field;g.startsWith(r)&&(f.field=g.replace(r,"")),a.push(f)}let s=a.length>0?JSON.stringify(a):"";return{params:encodeURIComponent(s),matchType:e}}const I=y(!1);function ae(n,e){o.superQuery={params:n,matchType:e},n.length==0||n.length==null?I.value=!1:I.value=!0,p.value.current=1,x()}const[oe,{openModal:le}]=N();function se(n){if(n||(n={}),!n.row){let e=o.selectedRows;if(!e||e.length==0||e.length>1){j.warning("请选择一条数据");return}n.row=e[0]}n.code=d.value,le(!0,n)}o.openCustomModal=se;function _(){let n=X();d.value=n}!c&&!d.value&&_();function ie(n){let e=n.head.extConfigJson;e&&(B.value=JSON.parse(e))}return U({ID:d,onlineQueryFormOuter:T,superQueryButtonRef:P,loading:ee,reload:te,dataSource:h,pagination:p,tableReloading:v,handleSpecialConfig:Z,onlineTableContext:o,handleChangeInTable:W,getColumnList:J,getTreeDataByResult:E,expandedRowKeys:k,handleExpandedRowsChange:ne,onlineExtConfigJson:B,handleFormConfig:ie,superQueryStatus:I,handleSuperQuery:ae,registerCustomModal:oe},D)}const ve="onl_";function rt(l,u,c={}){const d={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[S,{openModal:T}]=N(),[P,{openModal:p}]=N(),[h,{openModal:v}]=N(),[B,{openModal:q}]=N(),{createMessage:m}=Te(),b=pe(d),w=pe([]),o=pe([]);function V(e){if(w.length=0,o.length=0,e&&e.length>0)for(let t=0;t<e.length;t++){let r=je(e[t],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");r.buttonStyle=="button"?o.push(r):r.buttonStyle=="link"&&w.push(r)}}function X(e){Object.keys(b).forEach(t=>{b[t]=!0}),e&&e.length>0&&Object.keys(b).forEach(t=>{e.indexOf(t)>=0&&(b[t]=!1)})}function Y(e){let t={isUpdate:!1};e&&(t.param=e),T(!0,t)}function Q(e){l.beforeEdit(e).then(()=>{T(!0,{isUpdate:!0,record:e})}).catch(t=>{m.warning(t)})}const J=e=>({label:"删除",popConfirm:{title:"是否删除？",confirm:x.bind(null,e)}});function x(e){l.beforeDelete(e).then(()=>{k(e.id,!1)}).catch(t=>{m.warning(t)})}function K(e){let t=D(e),r=t&&(t=="1"||t=="3"||t=="4")||!t;return R(b.update)===!0&&r?[{label:"编辑",onClick:a=>{c.editClickCallback&&c.editClickCallback(e.id,a),Q(e)}}]:[]}function F(e){return{label:"提交流程",popConfirm:{title:"确认提交流程吗？",confirm:E.bind(null,e)}}}function W(e){return{label:"审批进度",onClick:Z.bind(null,e)}}function Z(e){const{currentTableName:t}=l;let r=ve+t,a=e.id;q(!0,{flowCode:r,dataId:a})}function G(e,t={}){let r=[];if(R(b.detail)===!0&&r.push({label:"详情",onClick:ee.bind(null,e)}),t.themeTemplate!=Me&&l.hasBpmStatus===!0&&R(b.bpm)===!0){let f=D(e);!f||f=="1"?r.push(F(e)):r.push(W(e))}if(u.value){let{reportPrintShow:f,reportPrintUrl:g}=u.value;f&&g&&r.push({label:"打印",onClick(){let ue=g,$=e.id,ce=De();Oe(ue,$,ce)}})}let a=D(e),s=a&&a=="1"||!a;R(b.delete)===!0&&s&&r.push(J(e));let i=w;if(i&&i.length>0)for(let f of i)ie(f.exp||"",e)===!0&&r.push({label:f.buttonName,onClick:z.bind(null,e,f.buttonCode,f.optType)});return r}function D(e){const t="bpm_status";let r=e[t];return r||(r=e[t.toUpperCase()]),r}function ee(e){v(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function te(e){const{currentTableName:t,onlineUrl:{startProcess:r}}=l;let a={url:r,params:{flowCode:ve+t,id:e.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},s={isTransformResponse:!1};return new Promise((i,f)=>{O.post(a,s).then(g=>{g.success?(i(g),m.success(g.message)):(f(),m.warning(g.message))})})}function E(e){return H(this,null,function*(){yield te(e),l.loadData()})}function k(e,t=!0){let r=`${l.onlineUrl.optPre}${l.ID}/${e}`;return new Promise((a,s)=>{O.delete({url:r},{isTransformResponse:!1}).then(i=>{i.success?(m.success(i.message),l.loadData(),t||c.singleDelCallback&&c.singleDelCallback(e),a(!0)):(m.warning(i.message),s())})})}function ne(){let e=l.selectedRowKeys;if(e.length<=0)return m.warning("请选择一条记录！"),!1;{let t=[];e.forEach(function(a){let s=a;s&&s.endsWith("_loadChild")&&(s=s.replace("_loadChild","")),t.indexOf(s)<0&&t.push(s)});let r=t.join(",");Ne.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>H(this,null,function*(){yield k(r),l.clearSelectedRow()})})}}function z(e,t,r){if(r=="js")l.execButtonEnhance(t,e);else if(r=="action"){let a={formId:l.ID,buttonCode:t,dataId:e.id},s=`${l.onlineUrl.buttonAction}`;O.post({url:s,params:a},{isTransformResponse:!1}).then(i=>{i.success?(l.loadData(),m.success("处理完成!")):m.warning(i.message)})}}function re(e){l.execButtonEnhance(e)}function I(e){let t=l.selectedRowKeys;if(!t||t.length==0)return m.warning("请先选中一条记录"),!1;let r=t.join(","),a={formId:l.ID,buttonCode:e,dataId:r},s=`${l.onlineUrl.buttonAction}`;O.post({url:s,params:a},{isTransformResponse:!1}).then(i=>{i.success?(l.loadData(),l.clearSelectedRow(),m.success("处理完成!")):m.warning(i.message)})}function ae(){p(!0)}const oe=()=>`${l.onlineUrl.importXls}${l.ID}`,{handleExportXlsx:le}=xe();function se(){let e=l.getLoadDataParams(),t=l.selectedRowKeys;t&&t.length>0&&(e.selections=t.join(",")),l.isErpSubTable===!0&&l.foreignKeyField&&l.foreignKeyValue&&(e[l.foreignKeyField]=l.foreignKeyValue);let r=JSON.stringify(we(e)),a=`${l.onlineUrl.exportXls}${l.ID}`;const s=l.description;return le(s,a,{paramsStr:r})}function _(e,t){const r=[];e.split("||").forEach(s=>{const i=[];s.trim().split("&&").forEach(f=>{i.push(n(f.trim(),t))}),r.push(i.join("&&"))});const a=r.join("||");return new Function(`return ${a}`)()}function ie(e,t){return!e||e==""?!0:e.indexOf("||")==-1&&e.indexOf("&&")==-1?n(e,t):_(e,t)}function n(e,t){if(!e||e=="")return!0;let r=e.split("#"),a=t[r[0]],s=r[1].toLowerCase();return s==="eq"?a==r[2]:s==="ne"?a!=r[2]:s==="empty"?r[2]==="true"?!a||a=="":a&&a.length>0:s==="in"?r[2].split(",").indexOf(String(a))>=0:!1}return{buttonSwitch:b,cgLinkButtonList:w,cgTopButtonList:o,importUrl:oe,registerModal:S,handleAdd:Y,handleEdit:Q,handleBatchDelete:ne,registerImportModal:P,onImportExcel:ae,onExportExcel:se,getDropDownActions:G,getActions:K,cgButtonJsHandler:re,cgButtonActionHandler:I,cgButtonLinkHandler:z,initButtonList:V,initButtonSwitch:X,getDeleteButton:J,handleSubmitFlow:E,getSubmitFlowButton:F,registerDetailModal:h,registerBpmModal:B}}export{rt as d,nt as p};
