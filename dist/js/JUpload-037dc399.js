var te=Object.defineProperty;var V=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var B=(l,r,i)=>r in l?te(l,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[r]=i,j=(l,r)=>{for(var i in r||(r={}))ae.call(r,i)&&B(l,i,r[i]);if(V)for(var i of V(r))se.call(r,i)&&B(l,i,r[i]);return l};import{d as ne,f as x,e as m,u as c,w as z,n as le,V as oe,Y as J,a6 as p,a7 as _,k as y,a9 as T,F as re,ac as M,ad as S,Z as $,ab as ie,ae as ue,aj as fe}from"./tinymce-vendor-3c2b3d6e.js";import{p as o,k as de,Z as ce,g as U,l as E,a0 as me}from"./index-37448b2d.js";import{ar as pe,C as ge}from"./jeecg-online-vendor-f57c6456.js";import{c as ve}from"./index-76418551.js";import be from"./UploadItemActions-dbfa39da.js";var L=(l=>(l.all="all",l.image="image",l.file="file",l))(L||{});const he={key:0},Ce={class:"ant-upload-text"},R="ant-upload-list-item",xe=ne({__name:"JUpload",props:{value:o.oneOfType([o.string,o.array]),text:o.string.def("上传"),fileType:o.string.def(L.all),bizPath:o.string.def("temp"),returnUrl:o.bool.def(!0),maxCount:o.number.def(0),buttonVisible:o.bool.def(!0),multiple:o.bool.def(!0),mover:o.bool.def(!0),download:o.bool.def(!0),removeConfirm:o.bool.def(!1),beforeUpload:o.func,disabled:o.bool.def(!1),replaceLastOne:o.bool.def(!1)},emits:["change","update:value"],setup(l,{expose:r,emit:i}){const{createMessage:g,createConfirm:D}=ge(),{prefixCls:w}=de("j-upload"),G=pe(),P=i,n=l,H=ce(),u=x([]),v=x(!0),b=x(),A=m(()=>n.maxCount>0&&u.value.length>=n.maxCount),f=m(()=>n.fileType===L.image),Z=m(()=>n.disabled===!0?!0:A.value===!0?n.replaceLastOne!==!0:!1),Y=m(()=>{const e=Object.assign({},n,c(G));return e.name="file",e.listType=f.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":n.disabled}],e.data=j({biz:n.bizPath},e.data),e.beforeUpload||(e.beforeUpload=q),f.value&&!e.accept&&(e.accept="image/*"),e});z(()=>n.value,e=>{Array.isArray(e)?n.returnUrl?k(e.join(",")):I(e):n.returnUrl?k(e):e&&I(JSON.parse(e))},{immediate:!0}),z(u,()=>le(()=>N()),{immediate:!0});function N(){if(!f.value)return;const e=b.value?b.value.getElementsByClassName(R):null;if(!(!e||e.length===0))for(const a of e)a.getAttribute("data-has-actions")==="true"||a.addEventListener("mouseover",O)}function O(e){const t=(()=>{for(const C of e.path){if(C.classList.contains(R))return C;if(C.classList.contains(`${w}-container`))return null}return null})();if(!t)return;const s=t.getElementsByClassName("ant-upload-list-item-actions");if(!s||s.length===0)return;const d=document.createElement("div");d.className="upload-actions-container",oe(be,{element:t,fileList:u,mover:n.mover,download:n.download,emitValue:h}).mount(d),s[0].appendChild(d),t.setAttribute("data-has-actions","true"),t.removeEventListener("mouseover",O)}function k(e){if(!e||e.length==0){u.value=[];return}let a=[];for(const t of e.split(",")){let s=U(t);a.push({uid:F(),name:ee(t),status:"done",url:s,response:{status:"history",message:t}})}u.value=a}function I(e){if(!e||e.length==0){u.value=[];return}let a=[];for(const t of e){let s=U(t.filePath);a.push({uid:F(),name:t.fileName,url:s,status:"done",response:{status:"history",message:t.filePath}})}u.value=a}function q(e){return v.value=!0,f.value&&e.type.indexOf("image")<0?(g.warning("请上传图片"),v.value=!1,!1):typeof n.beforeUpload=="function"?n.beforeUpload(e):!0}function K(){return n.removeConfirm?new Promise(e=>{D({title:"删除",content:`确定要删除这${f.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}):!0}function Q(e){!e.file.status&&v.value===!1&&e.fileList.pop();let a=e.fileList;if(n.maxCount>0&&a.length>=n.maxCount)if(n.maxCount-a.length>=0)a=a.slice(-n.maxCount);else return;if(e.file.status==="done"){let t=[];e.file.response.success?t=a.map(s=>{if(s.response){let d=s.response.message;s.url=U(d)}return s}):(t=a.filter(s=>s.uid!=e.file.uid),g.error(`${e.file.name} 上传失败.`)),a=t}else e.file.status==="error"&&g.error(`${e.file.name} 上传失败.`);if(u.value=a,e.file.status==="done"||e.file.status==="removed")if(n.returnUrl)W();else{let t=[];for(const s of a)if(s.status==="done"){let d={fileName:s.name,filePath:s.response.message,fileSize:s.size};t.push(d)}else return;h(JSON.stringify(t))}}function W(){let e=u.value,a="";(!e||e.length==0)&&(a="");let t=[];for(const s of e)if(s.status==="done")t.push(s.response.message);else return;t.length>0&&(a=t.join(",")),h(a)}function X(e){f.value?ve({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function h(e){P("change",e),P("update:value",e)}function F(){return"-"+parseInt(Math.random()*1e4+1,10)}function ee(e){if(e.lastIndexOf("\\")>=0){let a=new RegExp("\\\\","g");e=e.replace(a,"/")}return e.substring(e.lastIndexOf("/")+1)}return r({addActionsListener:N}),(e,a)=>{const t=J("a-button"),s=J("a-upload");return p(),_("div",{ref_key:"containerRef",ref:b,class:fe(`${c(w)}-container`)},[y(s,ue({headers:c(H),multiple:l.multiple,action:c(me),fileList:u.value,disabled:l.disabled},Y.value,{onRemove:K,onChange:Q,onPreview:X}),{default:T(()=>[f.value?(p(),_(re,{key:0},[A.value?$("",!0):(p(),_("div",he,[y(c(E),{icon:"ant-design:plus-outlined"}),M("div",Ce,S(l.text),1)]))],64)):l.buttonVisible?(p(),ie(t,{key:1,disabled:Z.value},{default:T(()=>[y(c(E),{icon:"ant-design:upload-outlined"}),M("span",null,S(l.text),1)]),_:1},8,["disabled"])):$("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});const Ae=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{Ae as J,L as U,xe as _};
