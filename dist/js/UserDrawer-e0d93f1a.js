var P=Object.defineProperty;var D=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var b=(s,o,r)=>o in s?P(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,A=(s,o)=>{for(var r in o||(o={}))L.call(o,r)&&b(s,r,o[r]);if(D)for(var r of D(o))k.call(o,r)&&b(s,r,o[r]);return s};var y=(s,o,r)=>new Promise((v,i)=>{var h=p=>{try{n(r.next(p))}catch(c){i(c)}},a=p=>{try{n(r.throw(p))}catch(c){i(c)}},n=p=>p.done?v(p.value):Promise.resolve(p.value).then(h,a);n((r=r.apply(s,o)).next())});import{d as O,M as C,f as w,e as V,u as t,a6 as W,ab as j,a9 as x,k as N,ae as G}from"./tinymce-vendor-3c2b3d6e.js";import"./index-09260ce4.js";import{f as K}from"./user.data-dbf79b1f.js";import{u as M,B as $}from"./index-563223fc.js";import{g as q,b as z,c as E,e as H,s as J}from"./user.api-367a7bce.js";import{useDrawerAdaptiveWidth as Q}from"./useAdaptiveWidth-a0286c92.js";import{an as X}from"./jeecg-online-vendor-f57c6456.js";import{u as Y,B as Z}from"./useForm-df7d93c5.js";import"./index-37448b2d.js";import"./antd-vue-vendor-05bfa84d.js";import"./vxe-table-vendor-26792376.js";import"./componentMap-e2e33057.js";import"./useFormItem-613b6d5d.js";import"./index-2ad3f236.js";import"./index-64ecc8b2.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./JAddInput-a2153936.js";import"./areaDataUtil-10873080.js";import"./data-9be677e2.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./index-2d7d6454.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./depart.api-76b2f38a.js";import"./JSelectUser-6efbe652.js";import"./JImageUpload-1b0b2e46.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JSelectDept-073e3b74.js";import"./useTreeBiz-a3326efb.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JPopup-8248ac78.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./JTreeSelect-73cfd2cd.js";import"./JEllipsis-242e7bd0.js";import"./JUpload-70acb676.js";import"./index-76418551.js";import"./JSearchSelect-4158b9a9.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";import"./validator-a0d2ebc7.js";import"./renderUtils-59564de6.js";import"./formUtils-09c7de86.js";const mr=O({__name:"UserDrawer",emits:["success","register"],setup(s,{emit:o}){const r=o,v=C(),i=w(!0),h=w(""),a=w([]),[n,{setProps:p,resetFields:c,setFieldsValue:g,validate:F,updateSchema:R}]=Y({labelWidth:90,schemas:K,showActionButtonGroup:!1}),u=w(!0),[T,{setDrawerProps:I,closeDrawer:B}]=M(e=>y(this,null,function*(){var m;if(yield c(),u.value=(m=e==null?void 0:e.showFooter)!=null?m:!0,I({confirmLoading:!1,showFooter:u.value}),i.value=!!(e!=null&&e.isUpdate),t(i)){h.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const l=yield q({userid:e.record.id});l&&l.length>0&&(e.record.selectedroles=l)}catch(l){}const d=yield z({userId:e.record.id});if(d&&d.length>0){e.record.selecteddeparts=d;let l=Array.from(d,({key:f})=>f);e.record.selecteddeparts=l.join(","),a.value=d.map(f=>({label:f.title,value:f.key}))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=!e.record.departIds||e.record.departIds==""?[]:e.record.departIds}e.selectedroles&&(yield g({selectedroles:e.selectedroles})),R([{field:"password",show:!t(i)},{field:"confirmPassword",ifShow:!t(i)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:a}},{field:"selecteddeparts",show:!(e!=null&&e.departDisabled)},{field:"selectedroles",show:!(e!=null&&e.departDisabled),componentProps:{api:e.tenantSaas?E:H}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!t(i)&&e.tenantSaas&&(yield g({relTenantIds:X().toString()})),typeof e.record=="object"&&g(A({},e.record)),p({disabled:!u.value})})),S=V(()=>t(i)?"编辑用户":"新增用户"),{adaptiveWidth:U}=Q();function _(){return y(this,null,function*(){try{let e=yield F();I({confirmLoading:!0}),e.userIdentity===1&&(e.departIds="");let m=t(i);yield J(e,m),B(),r("success",{isUpdateVal:m,values:e})}finally{I({confirmLoading:!1})}})}return(e,m)=>(W(),j(t($),G(e.$attrs,{onRegister:t(T),title:S.value,width:t(U),onOk:_,showFooter:u.value,destroyOnClose:""}),{default:x(()=>[N(t(Z),{onRegister:t(n)},null,8,["onRegister"])]),_:1},16,["onRegister","title","width","showFooter"]))}});export{mr as default};
