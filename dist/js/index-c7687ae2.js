var et=Object.defineProperty,at=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var A=(t,o,n)=>o in t?et(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,B=(t,o)=>{for(var n in o||(o={}))ot.call(o,n)&&A(t,n,o[n]);if(G)for(var n of G(o))nt.call(o,n)&&A(t,n,o[n]);return t},$=(t,o)=>at(t,st(o));var N=(t,o,n)=>new Promise((d,g)=>{var v=e=>{try{i(n.next(e))}catch(r){g(r)}},y=e=>{try{i(n.throw(e))}catch(r){g(r)}},i=e=>e.done?d(e.value):Promise.resolve(e.value).then(v,y);i((n=n.apply(t,o)).next())});import{d as K,f as R,e as S,u as D,w as it,a4 as Ht,a5 as Kt,Y as l,a6 as p,ab as _,aj as V,a9 as f,a7 as h,F as U,aa as rt,ao as lt,k as c,ac as P,E as ct,ad as O,Z as k,r as pt,o as dt,g as ut,ae as mt}from"./tinymce-vendor-3c2b3d6e.js";import{a3 as F,N as C,aW as gt,Z as L,P as yt,bM as ft,a4 as E,_ as vt}from"./antd-vue-vendor-05bfa84d.js";import{ap as W,aq as _t,_ as X,u as ht,m as bt,ao as kt,bM as Ct}from"./jeecg-online-vendor-f57c6456.js";import{k as Z,E as q}from"./index-37448b2d.js";import{T as wt}from"./index-3dc0c4fd.js";import Mt from"./DetailModal-39b00bb9.js";import St from"./DynamicNotice-0eafda19.js";import"./index-64ecc8b2.js";import{connectWebSocket as Dt,onWebSocket as Tt}from"./useWebSocket-8f95974c.js";import{r as jt}from"./mynews.api-ff127744.js";import Bt from"./SysMessageModal-da2de576.js";import"./vxe-table-vendor-26792376.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./JSelectUser-6efbe652.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./useFormItem-613b6d5d.js";import"./SysMessageList-c5d0d00b.js";import"./useSysMessage-e75c3f9d.js";var Y=(t=>(t.L="L",t.M="M",t.H="H",t))(Y||{});const Nt=[{key:"1",name:"通知",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"你收到了 14 份新周报",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"你推荐的 曲妮妮 已通过第三轮面试",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"这种模板可以区分多种通知类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"标题可以设置自动显示省略号，本例中标题行数已设为1行，如果内容超过1行将自动截断并支持tooltip显示完整标题。",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"系统消息",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"曲丽丽 评论了你",description:"描述信息描述信息描述信息",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"朱偏右 回复了你",description:"这种模板用于提醒谁与你发生了互动",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"标题",description:"请将鼠标移动到此处，以便测试超长的消息在此处将如何处理。本例中设置的描述最大行数为2，超过2行的描述内容将被省略并且可以通过tooltip查看完整内容",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}];const Pt=t=>W.get({url:"/sys/annountCement/listByUser",params:t}),H=(t,o)=>W.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:B({anntId:t},o)});const Rt=K({components:{[F.name]:F,[C.name]:C,[C.Item.name]:C.Item,AListItemMeta:C.Item.Meta,ATypographyParagraph:gt.Paragraph,[L.name]:L,Time:wt},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(t,{emit:o}){const{prefixCls:n}=Z("header-notify-list"),d=R(t.currentPage||1),g=S(()=>{const{pageSize:e,list:r}=t;if(e===!1)return[];let u=_t(e)?e:5;return r.slice(u*(D(d)-1),u*D(d))});it(()=>t.currentPage,e=>{d.value=e});const v=S(()=>!!t.onTitleClick),y=S(()=>{const{list:e,pageSize:r}=t;return r>0&&e&&e.length>r?{total:e.length,pageSize:r,current:D(d),onChange(u){d.value=u,o("update:currentPage",u)}}:!1});function i(e){t.onTitleClick&&t.onTitleClick(e)}return{prefixCls:n,getPagination:y,getData:g,handleTitleClick:i,isTitleClickable:v,PriorityTypes:Y}}});const zt={class:"title"},It={key:0,class:"extra"},Gt={key:2},At={key:0,class:"description"},$t={class:"datetime"};function Ut(t,o,n,d,g,v){const y=l("a-typography-paragraph"),i=l("a-tag"),e=l("a-avatar"),r=l("Icon"),u=l("Time"),T=l("a-list-item-meta"),b=l("a-list-item"),w=l("a-list");return p(),_(w,{class:V(t.prefixCls),pagination:t.getPagination},{default:f(()=>[(p(!0),h(U,null,rt(t.getData,s=>(p(),_(b,{key:s.id,class:"list-item",onClick:z=>t.handleTitleClick(s),style:lt({cursor:t.isTitleClickable?"pointer":""})},{default:f(()=>[c(T,null,{title:f(()=>[P("div",zt,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!s.titleDelete,ellipsis:t.$props.titleRows&&t.$props.titleRows>0?{rows:t.$props.titleRows,tooltip:!!s.title}:!1,content:s.title},null,8,["delete","ellipsis","content"]),s.extra?(p(),h("div",It,[c(i,{class:"tag",color:s.color},{default:f(()=>[ct(O(s.extra),1)]),_:2},1032,["color"])])):k("",!0)])]),avatar:f(()=>[s.avatar?(p(),_(e,{key:0,class:"avatar",src:s.avatar},null,8,["src"])):s.priority?(p(),h(U,{key:1},[s.priority===t.PriorityTypes.L?(p(),_(e,{key:0,class:"avatar priority-L",title:"一般消息"},{icon:f(()=>[c(r,{icon:"entypo:info"})]),_:1})):k("",!0),s.priority===t.PriorityTypes.M?(p(),_(e,{key:1,class:"avatar priority-M",title:"重要消息"},{icon:f(()=>[c(r,{icon:"bi:exclamation-lg"})]),_:1})):k("",!0),s.priority===t.PriorityTypes.H?(p(),_(e,{key:2,class:"avatar priority-H",title:"紧急消息"},{icon:f(()=>[c(r,{icon:"ant-design:warning-filled"})]),_:1})):k("",!0)],64)):(p(),h("span",Gt,O(s.avatar),1))]),description:f(()=>[P("div",null,[s.description?(p(),h("div",At,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:t.$props.descRows&&t.$props.descRows>0?{rows:t.$props.descRows,tooltip:!!s.description}:!1,content:s.description},null,8,["ellipsis","content"])])):k("",!0),P("div",$t,[c(u,{value:s.datetime,title:s.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const Ot=X(Rt,[["render",Ut],["__scopeId","data-v-f011ee3f"]]),Ft=K({components:{Popover:yt,BellOutlined:ft,Tabs:E,TabPane:E.TabPane,Badge:vt,NoticeList:Ot,DetailModal:Mt,DynamicNotice:St,SysMessageModal:Bt},setup(){const{prefixCls:t}=Z("header-notify"),o=ut(),n=ht(),d=bt(),g=pt({path:"",formData:{}}),[v,y]=q(),i=R(Nt),e=S(()=>{let a=0;for(let m=0;m<i.value.length;m++)a+=i.value[m].count;return a}),[r,{openModal:u}]=q();function T(){for(let a=0;a<i.value.length;a++)i.value[a].count=0;u(!0,{})}const b=R(!1);dt(()=>{J()});function w(a){return $(B({},a),{title:a.titile,description:a.msgAbstract,datetime:a.sendTime})}function s(){return N(this,null,function*(){try{let{anntMsgList:a,sysMsgList:m,anntMsgTotal:M,sysMsgTotal:j}=yield Pt({pageSize:5});i.value[0].list=a.map(w),i.value[1].list=m.map(w),i.value[0].count=M,i.value[1].count=j}catch(a){}})}s();function z(a){var m;try{H(a.id),s()}catch(M){}a.openType==="component"?(g.path=a.openPage,g.formData={id:a.busId},(m=o.refs.dynamicNoticeRef)==null||m.detail(a.openPage)):y.openModal(!0,{record:a,isUpdate:!0}),b.value=!1}function J(){var I;let a=kt(),m=Ct(a),M=D(n.getUserInfo).id+"_"+m,j=((I=d.domainUrl)==null?void 0:I.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+M;Dt(j),Tt(Q)}function Q(a){(a.cmd==="topic"||a.cmd==="user")&&setTimeout(()=>{s()},1e3)}function x(){b.value=!1,jt({},s)}function tt(a){return N(this,null,function*(){try{yield H(a),yield s()}catch(m){}})}return{prefixCls:t,listData:i,count:e,clickBadge:T,registerMessageModal:r,reloadCount:tt,onNoticeClick:z,onEmptyNotify:x,numberStyle:{},popoverVisible:b,registerDetail:v,dynamicNoticeProps:g}}});function Lt(t,o,n,d,g,v){const y=l("BellOutlined"),i=l("Badge"),e=l("DynamicNotice"),r=l("DetailModal"),u=l("sys-message-modal");return p(),h("div",{class:V(t.prefixCls)},[c(i,{count:t.count,overflowCount:9,offset:[-4,10],numberStyle:t.numberStyle,onClick:t.clickBadge},{default:f(()=>[c(y)]),_:1},8,["count","numberStyle","onClick"]),c(e,mt({ref:"dynamicNoticeRef"},t.dynamicNoticeProps),null,16),c(r,{onRegister:t.registerDetail},null,8,["onRegister"]),c(u,{onRegister:t.registerMessageModal,onRefresh:t.reloadCount},null,8,["onRegister","onRefresh"])],2)}const ue=X(Ft,[["render",Lt]]);export{ue as default};
