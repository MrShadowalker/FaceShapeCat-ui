import{d as W,e as _,Y as M,a6 as S,a7 as N,aj as q,k as s,a9 as R,Q as J,F as Q,aa as H,ab as K,ah as Z,ae as A,aq as ee,r as te,f as E,u as g,h as ne,E as se,J as ae}from"./tinymce-vendor-3c2b3d6e.js";import{ap as F,au as oe,as as re,at as le}from"./antd-vue-vendor-05bfa84d.js";import{p as ie,k as ce}from"./index-37448b2d.js";import{i as ue,_ as me,b4 as de}from"./jeecg-online-vendor-f57c6456.js";const ge=W({name:"ImagePreview",components:{Image:F,PreviewGroup:F.PreviewGroup},props:{functional:ie.bool,imageList:{type:Array}},setup(n){const{prefixCls:m}=ce("image-preview"),u=_(()=>{const{imageList:l}=n;return l?l.map(t=>ue(t)?{src:t,placeholder:!1}:t):[]});return{prefixCls:m,getImageList:u}}});function fe(n,m,u,l,t,w){const d=M("Image"),I=M("PreviewGroup");return S(),N("div",{class:q(n.prefixCls)},[s(I,null,{default:R(()=>[!n.imageList||n.$slots.default?J(n.$slots,"default",{key:0}):(S(!0),N(Q,{key:1},H(n.getImageList,i=>(S(),K(d,Z(A({key:i.src},i)),ee({_:2},[i.placeholder?{name:"placeholder",fn:R(()=>[s(d,A(i,{src:i.placeholder,preview:!1}),null,16,["src"])]),key:"0"}:void 0]),1040))),128))]),_:3})],2)}const ye=me(ge,[["render",fe]]),ve="/assets/resume-8f27866b.svg",pe="/assets/p-rotate-cb8bbfc3.svg",he="/assets/scale-44abde22.svg",_e="/assets/unscale-c552f416.svg",we="/assets/unrotate-ef6a2daf.svg";var f=function(n){return n[n.LOADING=0]="LOADING",n[n.DONE=1]="DONE",n[n.FAIL=2]="FAIL",n}(f||{});const Ie={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},o="img-preview",Le=W({name:"ImagePreview",props:Ie,emits:["img-load","img-error"],setup(n,{expose:m,emit:u}){const l=new Map,t=te({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:f.LOADING,currentIndex:0,moveX:0,moveY:0,show:n.show}),w=E(null),d=E(null);function I(){T();const{index:e,imageList:a}=n;if(!a||!a.length)throw new Error("imageList is undefined");t.currentIndex=e,y(a[e])}function i(){t.imgScale=1,t.imgRotate=0,t.imgTop=0,t.imgLeft=0}function T(){const e=g(w);e&&(e.onmousewheel=L,document.body.addEventListener("DOMMouseScroll",L),document.ondragstart=function(){return!1})}const p=_(()=>{var a;const e=(a=n==null?void 0:n.scaleStep)!=null?a:0;return(e!=null?e:0>0&&e<100)?e/100:t.imgScale/10});function L(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&h(p.value),e.delta<0&&h(-p.value)}function h(e){t.imgScale<=.2&&e<0||(t.imgScale+=e)}function $(e){t.imgRotate+=e}function Y(){const e=g(d);e&&(e.onmousemove=null)}function y(e){t.status=f.LOADING;const a=new Image;a.src=e,a.onload=r=>{if(t.currentUrl!==e){const c=r.composedPath();if(n.rememberState){l.set(t.currentUrl,{scale:t.imgScale,top:t.imgTop,left:t.imgLeft,rotate:t.imgRotate});const v=l.get(e);v?(t.imgScale=v.scale,t.imgTop=v.top,t.imgRotate=v.rotate,t.imgLeft=v.left):(i(),n.defaultWidth&&(t.imgScale=n.defaultWidth/c[0].naturalWidth))}else n.defaultWidth&&(t.imgScale=n.defaultWidth/c[0].naturalWidth);c&&u("img-load",{index:t.currentIndex,dom:c[0],url:e})}t.currentUrl=e,t.status=f.DONE},a.onerror=r=>{const c=r.composedPath();c&&u("img-error",{index:t.currentIndex,dom:c[0],url:e}),t.status=f.FAIL}}function b(e){e&&e.stopPropagation(),k()}function k(){t.show=!1,document.body.removeEventListener("DOMMouseScroll",L),document.ondragstart=null}function D(){i()}m({resume:D,close:k,prev:x.bind(null,"left"),next:x.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(t.imgScale=e)},setRotate:e=>{t.imgRotate=e}});function x(e){const{currentIndex:a}=t,{imageList:r}=n;e==="left"&&(t.currentIndex--,a<=0&&(t.currentIndex=r.length-1)),e==="right"&&(t.currentIndex++,a>=r.length-1&&(t.currentIndex=0)),y(r[t.currentIndex])}function G(e){e=e||window.event,t.moveX=e.clientX,t.moveY=e.clientY;const a=g(d);a&&(a.onmousemove=X)}function X(e){e=e||window.event,e.preventDefault();const a=e.clientX-t.moveX,r=e.clientY-t.moveY;t.imgLeft+=a,t.imgTop+=r,t.moveX=e.clientX,t.moveY=e.clientY}const B=_(()=>{const{imgScale:e,imgRotate:a,imgTop:r,imgLeft:c}=t;return{transform:`scale(${e}) rotate(${a}deg)`,marginTop:`${r}px`,marginLeft:`${c}px`,maxWidth:n.defaultWidth?"unset":"100%"}}),O=_(()=>{const{imageList:e}=n;return e.length>1});ne(()=>{n.show&&I(),n.imageList&&i()});const U=e=>{n.maskClosable&&e.target&&e.target.classList.contains(`${o}-content`)&&b(e)},j=()=>s("div",{class:`${o}__close`,onClick:b},[s(oe,{class:`${o}__close-icon`},null)]),z=()=>{if(!g(O))return null;const{currentIndex:e}=t,{imageList:a}=n;return s("div",{class:`${o}__index`},[e+1,se(" / "),a.length])},V=()=>s("div",{class:`${o}__controller`},[s("div",{class:`${o}__controller-item`,onClick:()=>h(-p.value)},[s("img",{src:_e},null)]),s("div",{class:`${o}__controller-item`,onClick:()=>h(p.value)},[s("img",{src:he},null)]),s("div",{class:`${o}__controller-item`,onClick:D},[s("img",{src:ve},null)]),s("div",{class:`${o}__controller-item`,onClick:()=>$(-90)},[s("img",{src:we},null)]),s("div",{class:`${o}__controller-item`,onClick:()=>$(90)},[s("img",{src:pe},null)])]),P=e=>g(O)?s("div",{class:[`${o}__arrow`,e],onClick:()=>x(e)},[e==="left"?s(re,null,null):s(le,null,null)]):null;return()=>t.show&&s("div",{class:o,ref:w,onMouseup:Y,onClick:U},[s("div",{class:`${o}-content`},[s("img",{style:g(B),class:[`${o}-image`,t.status===f.DONE?"":"hidden"],ref:d,src:t.currentUrl,onMousedown:G},null),j(),z(),V(),P("left"),P("right")])])}});let C=null;function be(n){var l;if(!de)return;const m={},u=document.createElement("div");return Object.assign(m,{show:!0,index:0,scaleStep:100},n),C=s(Le,m),ae(C,u),document.body.appendChild(u),(l=C.component)==null?void 0:l.exposed}export{ye as I,be as c};
