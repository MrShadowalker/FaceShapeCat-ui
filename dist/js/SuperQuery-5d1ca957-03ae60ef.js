import{f as R,r as ie,I as re,w as ae,a4 as ye,a5 as ge,ac as g,Y as p,a6 as w,a7 as se,F as ue,ab as F,a9 as o,k as a,E as f,D as Ce,Z as be,aj as ne,q as de,A as pe,aa as ke,ad as we}from"./tinymce-vendor-3c2b3d6e.js";import{B as Se}from"./index-64ecc8b2.js";import{C as _e,aU as le,E as Oe}from"./index-37448b2d.js";import{C as fe,aW as Me,b8 as Te,bs as Ie}from"./jeecg-online-vendor-f57c6456.js";import{M as xe,aH as Fe,aI as Re,bp as De,ba as je,bq as Pe,X as Ve,l as qe}from"./antd-vue-vendor-05bfa84d.js";import{M as Ne,H as Ae}from"./useExtendComponent-325fe3f1-007b9393.js";import{G as Ee}from"./SuperQueryValComponent.vue_vue_type_script_lang-e9196096-fd4361e6.js";import"./componentMap-e2e33057.js";import"./index-09260ce4.js";import"./constant-754f1a9d-eadfd1e1.js";import"./index-8e09cdad.js";import"./user.api-367a7bce.js";import"./customExpression-b2f1ff9b.js";import"./index-0f0d0317.js";import"./useListPage-66651993.js";import"./index-76418551.js";import"./LinkTableListPiece-8499a318-01ebb291.js";import"./OnlineSelectCascade-4265c95d-4cbe6ffe.js";import"./JModalTip-33c7dc44-1741a3e9.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";import"./data-9be677e2.js";import"./JUpload-70acb676.js";import"./useForm-df7d93c5.js";import"./formUtils-09c7de86.js";import"./BasicTable-400bb95b.js";import"./injectionKey-69710956.js";import"./index-2ad3f236.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./JAddInput-a2153936.js";import"./areaDataUtil-10873080.js";import"./useFormItem-613b6d5d.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./index-2d7d6454.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./depart.api-76b2f38a.js";import"./JSelectUser-6efbe652.js";import"./JSelectDept-073e3b74.js";import"./useTreeBiz-a3326efb.js";import"./JPopup-8248ac78.js";import"./JEllipsis-242e7bd0.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JTreeSelect-73cfd2cd.js";import"./JSearchSelect-4158b9a9.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JImageUpload-1b0b2e46.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";var Qe=Object.defineProperty,Le=Object.defineProperties,Be=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,me=(c,r,v)=>r in c?Qe(c,r,{enumerable:!0,configurable:!0,writable:!0,value:v}):c[r]=v,ve=(c,r)=>{for(var v in r||(r={}))Ue.call(r,v)&&me(c,v,r[v]);if(ce)for(var v of ce(r))He.call(r,v)&&me(c,v,r[v]);return c},he=(c,r)=>Le(c,Be(r));const Je={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},Ge="JSuperQuerySaved_";function $e(){const{linkTableCard2Select:c}=Ne(),{createMessage:r}=fe(),v=R(),e=ie({values:[]}),D=R("and"),[te,{setModalProps:Q}]=_e(()=>{Q({confirmLoading:!1})}),L=Object.assign({},{link_down:"text"},Je);function C(){}function K(){}function X(t,l,n){n.val=l}const j=R({}),P=R([]);function m(t){let{allFields:l,treeData:n}=S(t);j.value=l,P.value=n}function B(t){let l={field:void 0,rule:"eq",val:"",key:le(16)};t===!1?(e.values=[],e.values.push(l)):t===!0?e.values.length==0&&e.values.push(l):e.values.splice(++t,0,l)}function O(t){let l=re(e.values),n=-1;for(let i=0;i<l.length;i++)if(t.key==l[i].key){n=i;break}n!=-1&&e.values.splice(n,1)}const U={field:"val",label:"测试",component:"Input"};function H(t,l){let n=j.value[t.field];if(!n)return U;L[n.view]&&(n.view=L[n.view]);let i=Ae.createFormSchema(t.field,n);i.noChange(),i.asSearchForm(),i.updateField(t.field+l);const h=k=>{t.val=k[t.field]};i.setFunctionForFieldValue(h);let d=i.getFormItemSchema();return["empty","not_empty"].includes(t.rule)&&(d.componentProps=he(ve({},d.componentProps),{disabled:!0})),c(d),d&&d.component==="InputNumber"&&(t.curLineAlign="start"),d}const J=R(""),V=Me(),b=ie({visible:!1,title:"",content:"",saveCode:""}),Y=R(!1),q=Te();ae(()=>q.fullPath,t=>{G()});const y=R([]);ae(()=>y.value,t=>{let l=[];t&&t.length>0&&t.map(n=>{let i=le(16);l.push({title:n.title,slots:{icon:"custom"},value:i})}),J.value=l},{immediate:!0,deep:!0});function G(){let t=Ge+q.fullPath;b.saveCode=t;let l=V.get(t);l&&l instanceof Array&&(y.value=l)}G();function Z(){let t=M();if(!t){r.warning("空条件不能保存");return}let l=JSON.stringify(t);z(l)}function z(t){b.visible=!0,b.title="",b.content=t}function E(){let{title:t,content:l,saveCode:n}=b,i=$(t);i>=0?xe.confirm({title:"提示",content:`${t} 已存在，是否覆盖？`,okText:"确认",cancelText:"取消",onOk:()=>{y.value.splice(i,1,{content:l,title:t,type:D.value}),V.set(n,y.value),b.visible=!1,r.success("保存成功")}}):(y.value.push({content:l,title:t,type:D.value}),V.set(n,y.value),b.visible=!1,r.success("保存成功"))}function $(t){let l=y.value,n=-1;for(let i=0;i<l.length;i++)if(l[i].title==t){n=i;break}return n}function M(t=!1){var l;let n=e.values;if(!n||n.length==0)return!1;let i=[],h=j.value;for(let d of n){let k=["empty","not_empty"].includes(d.rule);if(d.field&&(k||d.val||d.val===0)&&d.rule){let N=h[d.field],A=(l=N==null?void 0:N.formatValue)!=null?l:_=>_,I=re(d.val);I instanceof Array?I=I.map(_=>A(_)).join(","):I=A(I);let x={field:W(d),rule:d.rule,val:I};if(t===!0){let _=h[d.field];_&&(x.type=_.view,x.dbType=_.type)}i.push(x)}}return i.length==0?!1:i}function W(t){let l=t.field;return l.indexOf("@")>0&&(l=l.replace("@",",")),l}function ee(t,{node:l}){let n=l.dataRef.title,i=y.value.filter(h=>h.title==n);if(i&&i.length>0){let{content:h,type:d}=i[0],k=JSON.parse(h),N=[];for(let A of k)N.push(Object.assign({},{key:le(16)},A));e.values=N,D.value=d}}function s(t){let l=$(t);l>=0&&(y.value.splice(l,1),V.set(b.saveCode,y.value))}function S(t){let l={},n=1,i=[];return t.properties&&(t=t.properties),Object.keys(t).map(h=>{let d=t[h];if(d.view=="table"){let k=d.properties||d.fields,N=n*100,A={title:d.title,value:h,disabled:!0,children:[],order:N};Object.keys(k).map(I=>{let x=k[I];x.order=N+x.order;let _=h+"@"+I;l[_]=x,A.children.push({title:x.title,value:_,isLeaf:!0,order:x.order})}),u(A),i.push(A),n++}else{let k=h;l[k]=d,i.push({title:d.title,value:k,isLeaf:!0,order:d.order})}}),u(i),{allFields:l,treeData:i}}function u(t){(t.children||t).sort(function(l,n){return l.order-n.order})}function T(t){const{params:l,matchType:n}=t;if(l){let i=[];for(let h of l)i.push(Object.assign({},{key:le(16)},h));e.values=i,n.value=n}}return{formRef:v,init:m,dynamicRowValues:e,matchType:D,registerModal:te,handleSubmit:C,handleCancel:K,handleSave:Z,doSaveQueryInfo:E,saveInfo:b,saveTreeData:J,handleRemoveSaveInfo:s,handleTreeSelect:ee,fieldTreeData:P,addOne:B,removeOne:O,setFormModel:X,getSchema:H,loading:Y,getQueryInfo:M,initDefaultValues:T}}const Ke={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1},online:{type:Boolean,default:!1}},components:{BasicModal:Se,MinusCircleOutlined:Fe,PlusOutlined:Re,OnlineSuperQueryValComponent:Ee,FileTextOutlined:De,CloseCircleOutlined:je,AppstoreTwoTone:Pe,Divider:Ve},emits:["search"],setup(c,{emit:r}){const[v,e]=Oe(),{createMessage:D}=fe(),te=R(!0);function Q(){e.closeModal()}function L(){if(c.online===!0){let u=E(!0);u&&u.length>0?(r("search",u,m.value),Q()):D.warning("空条件无法查询！")}else{let u=E(!0);if(u&&u.length>0){let T=C(u);r("search",T)}else D.warning("空条件无法查询！")}}function C(u){let T=[];for(let t of u){let l=t.field,n=t.val;n instanceof Array&&(n=n.join(",")),T.push(he(ve({},t),{field:l,val:n}))}return T.length>0?M.value=!0:M.value=!1,{superQueryMatchType:m.value,superQueryParams:encodeURI(JSON.stringify(T))}}function K(){P.values=[],q(!1);let u=C([]);r("search",u)}const{formRef:X,init:j,dynamicRowValues:P,matchType:m,registerModal:B,handleSave:O,doSaveQueryInfo:U,saveInfo:H,saveTreeData:J,handleTreeSelect:V,handleRemoveSaveInfo:b,fieldTreeData:Y,addOne:q,removeOne:y,setFormModel:G,getSchema:Z,loading:z,getQueryInfo:E,initDefaultValues:$}=$e(),M=R(!1);ae(()=>c.status,u=>{M.value=u},{immediate:!0});function W(){e.openModal(),q(!0)}function ee(){return document.getElementsByClassName("jee-super-query-form")[0]}function s(u){}function S(u){u.val=""}return ae(()=>c.config,u=>{u&&j(u)},{immediate:!0}),{formRef:X,registerFormModal:v,init:j,handleChangeField:S,dynamicRowValues:P,matchType:m,historyCollapsed:te,registerModal:B,handleSubmit:L,handleCancel:Q,handleSave:O,handleReset:K,doSaveQueryInfo:U,saveInfo:H,saveTreeData:J,handleTreeSelect:V,handleRemoveSaveInfo:b,fieldTreeData:Y,addOne:q,removeOne:y,setFormModel:G,getSchema:Z,loading:z,onFinish:s,getPopupContainer:ee,superQueryFlag:M,handleOpen:W,initDefaultValues:$,simpleImage:qe.PRESENTED_IMAGE_SIMPLE}}},oe=c=>(ye("data-v-bc498f51"),c=c(),ge(),c),Xe={class:"j-super-query-button"},Ye=oe(()=>g("span",null,"已有高级查询条件生效",-1)),Ze=oe(()=>g("span",null,"高级查询",-1)),ze={style:{float:"left"}},We={slot:"description"},et=oe(()=>g("span",null,"没有任何查询条件",-1)),tt=oe(()=>g("div",null,"保存的查询",-1)),lt=["title"],at={class:"icon-cancle"},ot={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function nt(c,r,v,e,D,te){const Q=p("divider"),L=p("AppstoreTwoTone"),C=p("a-button"),K=p("a-button-group"),X=p("a-tooltip"),j=p("a-divider"),P=p("a-empty"),m=p("a-select-option"),B=p("a-select"),O=p("a-form-item"),U=p("a-col"),H=p("a-row"),J=p("a-tree-select"),V=p("online-super-query-val-component"),b=p("PlusOutlined"),Y=p("MinusCircleOutlined"),q=p("a-space"),y=p("a-form"),G=p("close-circle-outlined"),Z=p("file-text-outlined"),z=p("a-tree"),E=p("Icon"),$=p("a-card"),M=p("BasicModal"),W=p("a-input"),ee=p("a-modal");return w(),se(ue,null,[g("div",Xe,[e.superQueryFlag?(w(),F(X,{key:0,mouseLeaveDelay:.2},{title:o(()=>[Ye,a(Q,{type:"vertical",style:{"background-color":"#fff"}}),g("a",{onClick:r[0]||(r[0]=(...s)=>e.handleReset&&e.handleReset(...s))},"清空")]),default:o(()=>[a(K,null,{default:o(()=>[a(C,{type:"primary",onClick:e.handleOpen},{default:o(()=>[a(L,{spin:!0}),Ze]),_:1},8,["onClick"])]),_:1})]),_:1})):(w(),F(C,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:e.handleOpen},{default:o(()=>[f(" 高级查询 ")]),_:1},8,["onClick"]))]),(w(),F(Ce,{to:"body"},[a(M,{title:"高级查询构造器",canFullscreen:!1,width:750,onRegister:e.registerFormModal,onOk:e.handleSubmit},{footer:o(()=>[g("div",ze,[a(C,{loading:e.loading,onClick:e.handleReset},{default:o(()=>[f("重置")]),_:1},8,["loading","onClick"]),a(C,{loading:e.loading,onClick:e.handleSave},{default:o(()=>[f("保存查询")]),_:1},8,["loading","onClick"])]),a(C,{key:"submit",type:"primary",onClick:e.handleSubmit},{default:o(()=>[f("确定")]),_:1},8,["onClick"]),a(C,{key:"back",onClick:e.handleCancel},{default:o(()=>[f("关闭")]),_:1},8,["onClick"])]),default:o(()=>[e.dynamicRowValues.values.length==0?(w(),F(P,{key:0},{default:o(()=>[g("div",We,[et,a(j,{type:"vertical"}),g("a",{onClick:r[1]||(r[1]=s=>e.addOne(-1))},"点击新增")])]),_:1})):be("",!0),a(H,{class:ne("j-super-query-modal-content")},{default:o(()=>[a(U,{sm:24,md:24},{default:o(()=>[de(a(H,null,{default:o(()=>[a(U,{md:12,xs:24},{default:o(()=>[a(O,{label:"匹配模式",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:o(()=>[a(B,{value:e.matchType,"onUpdate:value":r[2]||(r[2]=s=>e.matchType=s),getPopupContainer:s=>s==null?void 0:s.parentNode,style:{width:"100%"}},{default:o(()=>[a(m,{value:"and"},{default:o(()=>[f("AND（所有条件匹配）")]),_:1}),a(m,{value:"or"},{default:o(()=>[f("OR（任意一个匹配）")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[pe,e.dynamicRowValues.values.length>0]]),de(a(y,{ref:"formRef",class:ne("jee-super-query-form"),model:e.dynamicRowValues,onFinish:e.onFinish},{default:o(()=>[(w(!0),se(ue,null,ke(e.dynamicRowValues.values,(s,S)=>(w(),F(q,{key:s.key,style:{display:"flex","margin-bottom":"8px"},align:s.curLineAlign?s.align:"baseline"},{default:o(()=>[a(O,{name:["values",S,"field"],style:{width:"150px"}},{default:o(()=>[a(J,{style:{width:"100%"},placeholder:"请选择字段",value:s.field,"onUpdate:value":u=>s.field=u,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},listHeight:160,onChange:u=>e.handleChangeField(s),"tree-data":e.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),a(O,{name:["values",S,"rule"],style:{width:"100px"}},{default:o(()=>[a(B,{style:{width:"100%"},placeholder:"请选择匹配规则",value:s.rule,"onUpdate:value":u=>s.rule=u},{default:o(()=>[a(m,{value:"eq"},{default:o(()=>[f("等于")]),_:1}),a(m,{value:"like"},{default:o(()=>[f("模糊")]),_:1}),a(m,{value:"right_like"},{default:o(()=>[f("以..开始")]),_:1}),a(m,{value:"left_like"},{default:o(()=>[f("以..结尾")]),_:1}),a(m,{value:"in"},{default:o(()=>[f("在...中")]),_:1}),a(m,{value:"ne"},{default:o(()=>[f("不等于")]),_:1}),a(m,{value:"gt"},{default:o(()=>[f("大于")]),_:1}),a(m,{value:"ge"},{default:o(()=>[f("大于等于")]),_:1}),a(m,{value:"lt"},{default:o(()=>[f("小于")]),_:1}),a(m,{value:"le"},{default:o(()=>[f("小于等于")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),a(O,{name:["values",S,"val"],style:{width:"300px"}},{default:o(()=>[a(V,{style:{width:"100%"},schema:e.getSchema(s,S),formModel:s,setFormModel:(u,T)=>{e.setFormModel(u,T,s)},onSubmit:e.handleSubmit},null,8,["schema","formModel","setFormModel","onSubmit"])]),_:2},1032,["name"]),a(O,null,{default:o(()=>[a(C,{onClick:u=>e.addOne(S),style:{"margin-right":"6px"}},{default:o(()=>[a(b)]),_:2},1032,["onClick"]),a(C,{onClick:u=>e.removeOne(s)},{default:o(()=>[a(Y)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["align"]))),128))]),_:1},8,["model","onFinish"]),[[pe,e.dynamicRowValues.values.length>0]])]),_:1})]),_:1}),a($,{class:ne(["j-super-query-history-card",{collapsed:e.historyCollapsed}]),bordered:!1},{title:o(()=>[tt]),default:o(()=>[e.saveTreeData.length===0?(w(),F(P,{key:0,class:"j-super-query-history-empty",image:e.simpleImage,description:"没有保存的查询"},null,8,["image"])):(w(),F(z,{key:1,class:"j-super-query-history-tree",treeData:e.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:e.handleTreeSelect},{title:o(({title:s})=>[g("div",null,[g("span",{title:s},we(s.length>10?s.substring(0,10)+"...":s),9,lt),g("span",at,[a(G,{onClick:S=>e.handleRemoveSaveInfo(s)},null,8,["onClick"])])])]),custom:o(()=>[a(Z)]),_:1},8,["treeData","onSelect"])),g("div",{class:"collapse-box",onClick:r[3]||(r[3]=s=>e.historyCollapsed=!e.historyCollapsed)},[e.historyCollapsed?(w(),F(E,{key:0,icon:"ant-design:caret-left"})):(w(),F(E,{key:1,icon:"ant-design:caret-right"}))])]),_:1},8,["class"])]),_:1},8,["onRegister","onOk"])])),a(ee,{title:"请输入保存的名称",open:e.saveInfo.visible,onCancel:r[5]||(r[5]=s=>e.saveInfo.visible=!1),onOk:e.doSaveQueryInfo},{default:o(()=>[g("div",ot,[a(W,{value:e.saveInfo.title,"onUpdate:value":r[4]||(r[4]=s=>e.saveInfo.title=s),style:{width:"90%"},placeholder:"请输入保存的名称"},null,8,["value"])])]),_:1},8,["open","onOk"])],64)}const Cl=Ie(Ke,[["render",nt],["__scopeId","data-v-bc498f51"]]);export{Cl as default};
