var V=Object.defineProperty,N=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var M=(s,e,o)=>e in s?V(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,C=(s,e)=>{for(var o in e||(e={}))T.call(e,o)&&M(s,o,e[o]);if(k)for(var o of k(e))$.call(e,o)&&M(s,o,e[o]);return s},R=(s,e)=>N(s,O(e));var b=(s,e,o)=>new Promise((i,a)=>{var m=r=>{try{c(o.next(r))}catch(n){a(n)}},_=r=>{try{c(o.throw(r))}catch(n){a(n)}},c=r=>r.done?i(r.value):Promise.resolve(r.value).then(m,_);c((o=o.apply(s,e)).next())});import{d as y,r as j,f as d,Y as f,a6 as q,ab as A,a9 as u,k as l,u as w,E as D,ae as G}from"./tinymce-vendor-3c2b3d6e.js";import{B as L}from"./BasicModal-9d388b71.js";import{C as Y}from"./index-b5f97370.js";import{u as H,C as J,b6 as K,bg as Q}from"./jeecg-online-vendor-f57c6456.js";import"./index-64ecc8b2.js";import{rules as W}from"./validator-a0d2ebc7.js";import{a5 as X}from"./antd-vue-vendor-05bfa84d.js";import{u as Z}from"./UserSetting.api-24e5eb9b.js";import{C as ee}from"./index-37448b2d.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./user.api-367a7bce.js";const oe=y({name:"user-replace-phone-modal"}),ve=y(R(C({},oe),{emits:["register","success"],setup(s,{emit:e}){const o=H(),{createMessage:i}=J(),a=j({phone:"",smscode:""}),m=d(),_=d({}),c={phone:[C({},W.duplicateCheckRule("sys_user","phone",a,{label:"手机号"})[0]),{pattern:/^1[3456789]\d{9}$/,message:"手机号码格式有误"}],smscode:[{required:!0,message:"请输入验证码"}]},r=X.useForm,n=d(""),P=e,h=d("updatePhone"),[B,{setModalProps:F,closeModal:S}]=ee(t=>b(this,null,function*(){m.value.resetFields(),m.value.clearValidate(),F({confirmLoading:!1}),t.record.phone?(n.value="修改手机号",h.value="updatePhone"):(n.value="绑定手机号",h.value="bindPhone"),t.record.smscode="",Object.assign(a,t.record),_.value=t.record}));function x(){return K({mobile:a.phone,smsmode:Q.REGISTER})}function E(){return b(this,null,function*(){yield m.value.validateFields(),Z(a).then(t=>{t.success?(i.success(h.value==="updatePhone"?"修改手机号成功":"绑定手机号成功"),P("success"),S()):i.warning(t.message)})})}return(t,p)=>{const z=f("a-input"),v=f("a-form-item"),I=f("a-button"),U=f("a-form");return q(),A(L,G(t.$attrs,{onRegister:w(B),width:"500px",title:n.value,showCancelBtn:!1,showOkBtn:!1}),{default:u(()=>[l(U,{class:"antd-modal-form",ref_key:"formRef",ref:m,model:a,rules:c},{default:u(()=>[l(v,{name:"phone"},{default:u(()=>[l(z,{size:"large",value:a.phone,"onUpdate:value":p[0]||(p[0]=g=>a.phone=g),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),l(v,{name:"smscode"},{default:u(()=>[l(w(Y),{size:"large",value:a.smscode,"onUpdate:value":p[1]||(p[1]=g=>a.smscode=g),placeholder:"输入6位验证码",sendCodeApi:x},null,8,["value"])]),_:1}),l(v,null,{default:u(()=>[l(I,{size:"large",type:"primary",block:"",onClick:E},{default:u(()=>[D(" 确认 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister","title"])}}}));export{ve as default};
