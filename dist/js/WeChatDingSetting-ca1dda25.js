var W=Object.defineProperty,P=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var B=(i,t,a)=>t in i?W(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,F=(i,t)=>{for(var a in t||(t={}))G.call(t,a)&&B(i,a,t[a]);if(A)for(var a of A(t))O.call(t,a)&&B(i,a,t[a]);return i},E=(i,t)=>P(i,q(t));var p=(i,t,a)=>new Promise((D,o)=>{var c=r=>{try{y(a.next(r))}catch(f){o(f)}},m=r=>{try{y(a.throw(r))}catch(f){o(f)}},y=r=>r.done?D(r.value):Promise.resolve(r.value).then(c,m);y((a=a.apply(i,t)).next())});import{d as j,f as u,o as Z,a6 as I,a7 as x,ac as l,k as M,ao as S,u as n,ad as w,Z as L,aj as H}from"./tinymce-vendor-3c2b3d6e.js";import{i as J,j as K,k as Q}from"./UserSetting.api-24e5eb9b.js";import{u as R,m as X,C as Y}from"./jeecg-online-vendor-f57c6456.js";import{bf as ee,bg as se,b3 as te,M as ae}from"./antd-vue-vendor-05bfa84d.js";import{k as ne}from"./index-37448b2d.js";import"./vxe-table-vendor-26792376.js";const ie=l("div",{class:"my-account"},"第三方APP",-1),le={class:"account-row-item"},oe=l("div",{class:"account-label gray-75"},"钉钉绑定",-1),re=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"钉钉",-1),ce={key:0,class:"gray-75",style:{"margin-left":"8px"}},de={class:"account-row-item"},ue=l("div",{class:"account-label gray-75"},"账号绑定",-1),fe=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"微信",-1),ge={key:0,class:"gray-75",style:{"margin-left":"8px"}},pe=j({name:"we-chat-ding-setting"}),Ie=j(E(F({},pe),{setup(i){const{prefixCls:t}=ne("j-user-tenant-setting-container"),a=ee({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),D=R(),o=u({}),c=u({}),m=u({}),y=X(),r=u(""),f=u(""),me=u({}),{createMessage:g}=Y(),_=u(""),v=u("");function T(){return p(this,null,function*(){let e=yield J({thirdType:"wechat_open,dingtalk,wechat_enterprise"});if(o.value="",c.value="",m.value="",e&&e.result){let s=e.result;for(let d=0;d<s.length;d++)C(s[d])}})}function ye(){let e=n(m);e.sysUserId?k({sysUserId:e.sysUserId,id:e.id},"企业微信"):U("wechat_enterprise")}function z(){let e=n(c);e.sysUserId?k({sysUserId:e.sysUserId,id:e.id},"钉钉"):U("dingtalk")}function $(){let e=n(o);e.sysUserId?k({sysUserId:e.sysUserId,id:e.id},"微信"):U("wechat_open")}function U(e){let s=`${y.uploadUrl}/sys/thirdLogin/render/${e}`;n(_)&&(_.value.close(),window.removeEventListener("message",n(v),!1)),_.value=window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),r.value=e,v.value=function(d){return p(this,null,function*(){let h=d.data;if(typeof h=="string")if(h==="登录失败")b();else if(h.includes("绑定手机号")){let V=h.split(",");f.value=V[1],yield N()}else h&&g.warning("该敲敲云账号已被其它第三方账号绑定,请解绑或绑定其它敲敲云账号");else b();window.removeEventListener("message",n(v),!1),_.value=""})},window.addEventListener("message",n(v),!1)}function N(){return p(this,null,function*(){if(!n(f)){b();return}let e={thirdUserUuid:n(f),thirdType:n(r)};yield K(e).then(s=>{s.success?s.result&&C(s.result):g.warning(s.message)}).catch(s=>{g.warning(s.message)})})}function b(){g.warning("第三方账号绑定异常")}function C(e){let s=e.thirdType;s=="wechat_open"?o.value=e:s=="dingtalk"?c.value=e:s=="wechat_enterprise"&&(m.value=e)}function k(e,s){return p(this,null,function*(){ae.confirm({title:"解绑"+s,content:"确定要解绑吗",okText:"确认",cancelText:"取消",onOk:()=>p(this,null,function*(){yield Q(e).then(d=>{d.success?(T(),g.success(d.message)):g.warning(d.message)})})})})}return Z(()=>{T()}),(e,s)=>(I(),x("div",{class:H([`${n(t)}`])},[ie,l("div",le,[oe,l("span",null,[M(n(se),{style:S(c.value.sysUserId?{color:"#007FFF"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),re,c.value.realname?(I(),x("span",ce,w("已绑定："+c.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:z},w(c.value.sysUserId?"解绑":"绑定"),1)])]),l("div",de,[ue,l("span",null,[M(n(te),{style:S(o.value.sysUserId?{color:"#1ec563"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),fe,o.value.realname?(I(),x("span",ge,w("已绑定："+o.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:$},w(o.value.sysUserId?"解绑":"绑定"),1)])])],2))}}));export{Ie as default};
