import{f as F,p as Ee,w as N,Y as O,a6 as i,a7 as y,F as M,k as c,u as e,Z as g,ab as d,aj as Pe,a9 as r,E as f,aa as Le,ad as w,q as He,A as Ke,ac as D,ae as Ne,af as Oe,ag as Ae,ah as Ve,ai as ze}from"./tinymce-vendor-3c2b3d6e.js";import"./index-0f0d0317.js";import"./jeecg-online-vendor-f57c6456.js";import je from"./OnlineAutoModal-510991eb-fc2dc518.js";import Je from"./OnlineCustomModal-518ad33c-1d54cb82.js";import A from"./OnlineDetailModal-9675390d-a064b8ad.js";import{e as $e}from"./JImportModal-15f7db6a.js";import{p as qe,d as Qe}from"./useListButton-cdbab702-1beaee8c.js";import{B as Ue,d as We,N as Ye}from"./useExtendComponent-325fe3f1-007b9393.js";import Ze from"./OnlineQueryForm-1bfc8320-01818773.js";import{u as Ge}from"./useOnlinePopEvent-687070b7-3b2e3730.js";import{s as Xe}from"./constant-754f1a9d-eadfd1e1.js";import{d as eo}from"./antd-vue-vendor-05bfa84d.js";import"./index-64ecc8b2.js";import"./OnlineForm-1fa2d893-7d37908f.js";import"./index-09260ce4.js";import"./index-37448b2d.js";import"./useCustomHook-acb00837-32b1f38e.js";import"./CommentPanel-62548135.js";import"./OnlineFormDetail-0e7294ca-faf7dffa.js";import"./DetailForm-424638eb-a0926224.js";import"./index-76418551.js";import"./index-2d7d6454.js";import"./OnlineSubFormDetail-f0d2c016-93cac491.js";import"./cgformState-d9f8ec42-a08af090.js";import"./componentMap-e2e33057.js";import"./index-8e09cdad.js";import"./user.api-367a7bce.js";import"./customExpression-b2f1ff9b.js";import"./useListPage-66651993.js";import"./LinkTableListPiece-8499a318-01ebb291.js";import"./OnlineSelectCascade-4265c95d-4cbe6ffe.js";import"./JModalTip-33c7dc44-1741a3e9.js";import oo from"./BasicTable-400bb95b.js";import{Q as to}from"./index-2ad3f236.js";import"./vxe-table-vendor-26792376.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./useForm-df7d93c5.js";import"./formUtils-09c7de86.js";import"./JAddInput-a2153936.js";import"./areaDataUtil-10873080.js";import"./data-9be677e2.js";import"./useFormItem-613b6d5d.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./depart.api-76b2f38a.js";import"./JSelectUser-6efbe652.js";import"./JSelectDept-073e3b74.js";import"./useTreeBiz-a3326efb.js";import"./JPopup-8248ac78.js";import"./JEllipsis-242e7bd0.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JTreeSelect-73cfd2cd.js";import"./JSearchSelect-4158b9a9.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JImageUpload-1b0b2e46.js";import"./JUpload-70acb676.js";import"./injectionKey-69710956.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";var V=(R,T,m)=>new Promise((x,p)=>{var h=l=>{try{C(m.next(l))}catch(s){p(s)}},n=l=>{try{C(m.throw(l))}catch(s){p(s)}},C=l=>l.done?x(l.value):Promise.resolve(l.value).then(h,n);C((m=m.apply(R,T)).next())});const no={key:0,style:{"font-size":"12px","font-style":"italic"}},io={key:0,style:{"font-size":"12px","font-style":"italic"}},ro=["src","onClick"],lo=["innerHTML"],ao=["title"],Vt={__name:"OnlCgformErpSubTable",props:["data","mainTableSelectedRowRcord"],emits:["getSource"],setup(R,{emit:T}){const m=R,x=T,p=F(!1),{ID:h,onlineTableContext:n,onlineQueryFormOuter:C,loading:l,reload:s,dataSource:k,pagination:z,handleSpecialConfig:j,getColumnList:mo,handleChangeInTable:J,loadData:$,onlineExtConfigJson:E,handleFormConfig:q,registerCustomModal:Q,tableReloading:U}=qe({code:m.data.code,themeTemplate:Xe});n.isErpSubTable=!0;let{initCgEnhanceJs:W}=Ue(n);const{buttonSwitch:b,cgLinkButtonList:so,cgTopButtonList:I,importUrl:Y,registerModal:Z,handleAdd:G,handleEdit:po,handleBatchDelete:X,registerImportModal:ee,onImportExcel:oe,onExportExcel:te,cgButtonJsHandler:ne,cgButtonActionHandler:ie,cgButtonLinkHandler:co,handleSubmitFlow:uo,getDropDownActions:re,getActions:le,initButtonList:ae,initButtonSwitch:me,registerDetailModal:se,registerBpmModal:go}=Qe(n,E),B=F(!1);function pe(){return V(this,null,function*(){try{B.value=!0,yield te()}finally{setTimeout(()=>B.value=!1,1500)}})}const{columns:ce,actionColumn:de,selectedKeys:ue,rowSelection:ge,enableScrollBar:fe,tableScroll:ye,downloadRowFile:he,getImgView:Ce,getPcaText:P,getFormatDate:ke,handleColumnResult:be,hrefComponent:S,viewOnlineCellImage:Se,hrefMainTableId:ve,registerOnlineHrefModal:we,registerPopModal:Re,openPopModal:Te,onlinePopModalRef:xe,popTableId:L}=We(n,E);Ie(eo(m.data));const H=F(null),_=m.data.foreignKeys;let K;if(_!=null&&_.length){const t=_[0],a=t.field;K=t.key,n.foreignKeyField=a}else n.foreignKeyField=null,n.foreignKeyValue=null;Ee("foreignkey",H),N(()=>m.mainTableSelectedRowRcord,t=>{if(t){if(n.foreignKeyField){const a=t[K];n.foreignKeyValue=a,H.value={field:n.foreignKeyField,value:a}}p.value=!0,l.value=!0,$().finally(()=>{l.value=!1})}else p.value=!1,k.value=[]},{immediate:!0}),N(()=>k.value,()=>{x("getSource",m.data.currentTableName,k.value)},{immediate:!0});function Ie(t){return V(this,null,function*(){Be(t),l.value=!1,n.execButtonEnhance("setup")})}function Be(t){let a=W(t.enhanceJs);n.EnhanceJS=a,ae(t.cgButtonList),me(t.hideColumns),be(t),j(t)}function _e(t){n.queryParam=t,s({mode:"search"})}function Fe(t){L.value=t.id;let a={title:t.describe};t.record&&t.record.id&&(a.record=t.record,a.isUpdate=!0),Te(!0,a)}return Ge(Fe),(t,a)=>{const u=O("a-button"),Me=O("a-modal");return i(),y(M,null,[c(Ze,{ref_key:"onlineQueryFormOuter",ref:C,id:e(h),onSearch:_e},null,8,["id"]),e(U)?g("",!0):(i(),d(e(oo),{key:0,ref:"onlineTable",rowKey:"jeecg_row_key",canResize:!0,bordered:!0,showIndexColumn:!1,loading:e(l),columns:e(ce),dataSource:e(k),pagination:e(z),rowSelection:e(ge),actionColumn:e(de),showTableSetting:!0,clickToRowSelect:!1,scroll:e(ye),onTableRedo:e(s),class:Pe({"j-table-force-nowrap":e(fe)}),onChange:e(J),minHeight:300},{tableTitle:r(()=>[p.value&&e(b).add?(i(),d(u,{key:0,preIcon:"ant-design:plus-outlined",type:"primary",onClick:e(G)},{default:r(()=>[f("新增")]),_:1},8,["onClick"])):g("",!0),p.value&&e(b).import?(i(),d(u,{key:1,preIcon:"ant-design:import-outlined",type:"primary",onClick:e(oe)},{default:r(()=>[f("导入")]),_:1},8,["onClick"])):g("",!0),p.value&&e(b).export?(i(),d(u,{key:2,preIcon:"ant-design:export-outlined",type:"primary",loading:B.value,onClick:pe},{default:r(()=>[f(" 导出")]),_:1},8,["loading"])):g("",!0),p.value&&e(I)&&e(I).length>0?(i(!0),y(M,{key:3},Le(e(I),(o,v)=>(i(),y(M,null,[o.optType=="js"?(i(),d(u,{key:"cgbtn"+v,onClick:De=>e(ne)(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:r(()=>[f(w(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):o.optType=="action"?(i(),d(u,{key:"cgbtn"+v,onClick:De=>e(ie)(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:r(()=>[f(w(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):g("",!0)],64))),256)):g("",!0),e(b).batch_delete?He((i(),d(u,{key:4,preIcon:"ant-design:delete-outlined",onClick:e(X)},{default:r(()=>[f(" 批量删除")]),_:1},8,["onClick"])),[[Ke,e(ue).length>0]]):g("",!0)]),fileSlot:r(({text:o})=>[o?(i(),d(u,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:v=>e(he)(o)},{default:r(()=>[f(" 下载 ")]),_:2},1032,["onClick"])):(i(),y("span",no,"无文件"))]),imgSlot:r(({text:o})=>[o?(i(),y("img",{key:1,src:e(Ce)(o),alt:"图片不存在",class:"online-cell-image",onClick:v=>e(Se)(o)},null,8,ro)):(i(),y("span",io,"无图片"))]),htmlSlot:r(({text:o})=>[D("div",{innerHTML:o},null,8,lo)]),pcaSlot:r(({text:o})=>[D("div",{title:e(P)(o)},w(e(P)(o)),9,ao)]),dateSlot:r(({text:o})=>[D("span",null,w(e(ke)(o)),1)]),action:r(({record:o})=>[c(e(to),{actions:e(le)(o),dropDownActions:e(re)(o)},null,8,["actions","dropDownActions"])]),_:1},8,["loading","columns","dataSource","pagination","rowSelection","actionColumn","scroll","onTableRedo","class","onChange"])),c(je,{id:e(h),onRegister:e(Z),onSuccess:e(s),onFormConfig:e(q)},null,8,["id","onRegister","onSuccess","onFormConfig"]),c(A,{id:e(h),onRegister:e(se)},null,8,["id","onRegister"]),c($e,{onRegister:e(ee),url:e(Y)(),onOk:e(s),online:""},null,8,["onRegister","url","onOk"]),c(Me,Ne(e(S).model,Oe(e(S).on)),{default:r(()=>[(i(),d(Ae(e(S).is),Ve(ze(e(S).params)),null,16))]),_:1},16),c(Je,{onRegister:e(Q),onSuccess:e(s)},null,8,["onRegister","onSuccess"]),c(A,{id:e(ve),onRegister:e(we),defaultFullscreen:!1},null,8,["id","onRegister"]),c(Ye,{ref_key:"onlinePopModalRef",ref:xe,id:e(L),onRegister:e(Re),onSuccess:e(s),request:"",topTip:""},null,8,["id","onRegister","onSuccess"])],64)}}};export{Vt as default};
