var y=(v,N,i)=>new Promise((U,k)=>{var h=s=>{try{b(i.next(s))}catch(o){k(o)}},B=s=>{try{b(i.throw(s))}catch(o){k(o)}},b=s=>s.done?U(s.value):Promise.resolve(s.value).then(h,B);b((i=i.apply(v,N)).next())});import{d as le,f as u,w as se,Y as p,a6 as m,ab as I,a9 as a,k as c,E as C,aj as R,a7 as $,aa as q,ad as Y,F as Z,Z as A,ae as G,u as e,a4 as oe,a5 as ne,ac as J}from"./tinymce-vendor-3c2b3d6e.js";import{B as re}from"./index-64ecc8b2.js";import{i as ue,j as ie}from"./depart.api-76b2f38a.js";import{v as ce}from"./tenant.api-77d3d470.js";import{u as de,C as fe,_ as pe}from"./jeecg-online-vendor-f57c6456.js";import"./BasicModal-9d388b71.js";import"./antd-vue-vendor-05bfa84d.js";import"./index-37448b2d.js";import"./vxe-table-vendor-26792376.js";import"./useWindowSizeFn-e63bb4b0.js";const K=v=>(oe("data-v-d533094a"),v=v(),ne(),v),ve=K(()=>J("span",null,"您隶属于多租户，请选择当前所属租户",-1)),me=K(()=>J("span",null,"您隶属于多部门，请选择当前所在部门",-1)),_e=le({__name:"DepartSelect",props:{title:{type:String,default:"部门选择"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(v,{expose:N}){const i=de(),{createMessage:U,notification:k}=fe(),h=v,B={labelCol:{span:4},wrapperCol:{span:18}},b={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},s=u(""),o=u(!1),w=u(""),d=u(),L=u([]),x=u(""),f=u(!1),S=u(""),_=u(""),M=u([]),T=u(""),D=u(!1);function O(){return y(this,null,function*(){yield F(),yield Q(),e(o)&&e(f)?s.value="切换租户和部门":e(o)?s.value=e(w)&&e(w).length>0?`部门切换（当前部门 :${e(w)}）`:h.title:e(f)&&(s.value=e(S)&&e(S).length>0?`部门切换（当前部门 :${e(S)}）`:h.title),(e(o)||e(f))&&(D.value=!0)})}function F(){return y(this,null,function*(){const t=yield ue();if(!t.list||t.list.length==0)return;let l=t.list.filter(r=>r.orgCode==t.orgCode);M.value=t.list,_.value=l&&l.length>0?t.orgCode:"",S.value=l&&l.length>0?l[0].departName:"",f.value=!0})}function Q(){return y(this,null,function*(){const t=yield ce();if(!t.list||t.list.length==0)return;let l=i.getTenant,r=t.list.filter(g=>g.id==l);w.value=r&&r.length>0?r[0].name:"",L.value=t.list,d.value=l,o.value=!0})}function W(){return y(this,null,function*(){if(e(o)&&e(d)==null)return x.value="error",!1;if(e(f)&&!e(_))return T.value="error",!1;X().then(()=>{e(o)&&i.setTenant(e(d)),U.success("切换成功"),window.location.reload()}).catch(t=>{}).finally(()=>{e(o)&&i.setTenant(e(d)),V()})})}function X(){return new Promise((t,l)=>y(this,null,function*(){if(!e(f))t();else{const r=yield ie({username:i.getUserInfo.username,orgCode:e(_),loginTenantId:e(d)});if(r.userInfo){const g=r.userInfo;i.setUserInfo(g),t()}else ee(r),i.logout(),l()}}))}function ee(t){k.error({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})}function V(){te()}function te(){s.value="",o.value=!1,w.value="",d.value="",L.value=[],x.value="",f.value=!1,S.value="",_.value="",M.value=[],T.value="",D.value=!1}return se(()=>h.username,t=>{t&&F()}),N({show:O}),(t,l)=>{const r=p("a-avatar"),g=p("a-tooltip"),z=p("Icon"),H=p("a-select-option"),j=p("a-select"),E=p("a-form-item"),ae=p("a-form"),P=p("a-button");return m(),I(e(re),G(b,{maxHeight:500,title:s.value,visible:D.value,"onUpdate:visible":l[2]||(l[2]=n=>D.value=n),wrapClassName:"loginSelectModal"}),{footer:a(()=>[c(P,{onClick:V},{default:a(()=>[C("关闭")]),_:1}),c(P,{onClick:W,type:"primary"},{default:a(()=>[C("确认")]),_:1})]),default:a(()=>[c(ae,G({ref:"formRef"},B,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[o.value?(m(),I(E,{key:0,"validate-status":x.value},{label:a(()=>[c(g,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[c(r,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[C(" 租户 ")]),_:1})]),_:1})]),default:a(()=>[c(j,{value:d.value,"onUpdate:value":l[0]||(l[0]=n=>d.value=n),placeholder:"请选择登录部门",class:R({"valid-error":x.value=="error"})},{suffixIcon:a(()=>[c(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),$(Z,null,q(L.value,n=>(m(),I(H,{key:n.id,value:n.id},{default:a(()=>[C(Y(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):A("",!0),f.value?(m(),I(E,{key:1,"validate-status":T.value},{label:a(()=>[c(g,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[c(r,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[C(" 部门 ")]),_:1})]),_:1})]),default:a(()=>[c(j,{value:_.value,"onUpdate:value":l[1]||(l[1]=n=>_.value=n),placeholder:"请选择登录部门",class:R({"valid-error":T.value=="error"})},{suffixIcon:a(()=>[c(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),$(Z,null,q(M.value,n=>(m(),I(H,{key:n.orgCode,value:n.orgCode},{default:a(()=>[C(Y(n.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):A("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const De=pe(_e,[["__scopeId","data-v-d533094a"]]);export{De as default};
