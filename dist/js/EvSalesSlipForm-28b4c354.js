var E=(u,f,y)=>new Promise((C,I)=>{var D=b=>{try{l(y.next(b))}catch(g){I(g)}},B=b=>{try{l(y.throw(b))}catch(g){I(g)}},l=b=>b.done?C(b.value):Promise.resolve(b.value).then(D,B);l((y=y.apply(u,f)).next())});import{d as ye,f as m,r as be,e as ge,o as Y,Y as i,a6 as k,ab as q,a9 as t,k as e,ae as w,u as _,Z as F,ac as T,ad as h,E as N,a4 as Se,a5 as we,n as Te}from"./tinymce-vendor-3c2b3d6e.js";import{C as V,ap as x,_ as he}from"./jeecg-online-vendor-f57c6456.js";import{l as U}from"./JDictSelectTag-f0227cc5.js";import{J as xe}from"./JSearchSelect-4158b9a9.js";import{J as Ce}from"./JImageUpload-1b0b2e46.js";import{aI as Ue,a5 as Ie}from"./antd-vue-vendor-05bfa84d.js";import{l as Ge}from"./EvSpu.api-376e662f.js";const{createConfirm:ke}=V();const qe=u=>x.get({url:"/sys/sysDepart/queryDepartTreeSync",params:u});const J=u=>x.get({url:"/evGoods/queryById",params:u}),He="/evSale/exportXls",Xe="/evSale/importExcel",ze=u=>x.get({url:"/evSale/list",params:u}),Ze=(u,f)=>x.delete({url:"/evSale/delete",params:u},{joinParamsToUrl:!0}).then(()=>{f()}),Ke=(u,f)=>{ke({iconType:"warning",title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>x.delete({url:"/evSale/deleteBatch",data:u},{joinParamsToUrl:!0}).then(()=>{f()})})},De=(u,f)=>{let y=f?"/evSale/edit":"/evSale/addGoods";return x.post({url:y,params:u},{isTransformResponse:!1})},H=u=>(Se("data-v-cc299fd5"),u=u(),we(),u),Be=H(()=>T("span",{style:{color:"#999999"}},"客户信息",-1)),Le=H(()=>T("span",{style:{color:"#999999"}},"商品列表",-1)),Me={style:{width:"120px !important",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Oe=ye({__name:"EvSalesSlipForm",props:{formDisabled:{type:Boolean,default:!1},formData:{type:Object,default:()=>{}},formBpm:{type:Boolean,default:!0}},emits:["register","ok"],setup(u,{expose:f,emit:y}){const C=u,I=m(),D=Ie.useForm,B=y,l=be({saleTime:"",code:"",customType:"1",payType:"",salesId:"",departId:"",amountTotal:0,payMoney:0,evSaleGoodsList:[],saleUserId:""}),b=m([]),{createMessage:g}=V(),X=m({xs:{span:24},sm:{span:1}}),z=m({xs:{span:24},sm:{span:5}}),Z=m({xs:{span:24},sm:{span:16}}),K=m({xs:{span:24},sm:{span:22}}),L=m(!1),Q={saleTime:[{required:!0,message:"请选择销售时间!"}],code:[{required:!0,message:"请输入销售单号!"}],customType:[{required:!0,message:"请选择客户类型!"}],payType:[{required:!0,message:"请选择支付方式!"}],saleUserId:[{required:!0,message:"请选择销售人员!"}],departId:[{required:!0,message:"请选择销售店铺!"}],payMoney:[{required:!0,message:"请输入实际金额!"}]},{resetFields:W,validate:A,validateInfos:S}=D(l,Q,{immediate:!0}),Fe=m([]),p=ge(()=>C.formBpm===!0?C.formData.disabled!==!1:C.formDisabled);Y(()=>{ee()});const R=n=>{n.saleMoney&&n.num&&(n.total=n.saleMoney*n.num),j()},j=()=>{l.amountTotal=0;for(let n=0;n<l.evSaleGoodsList.length;n++){const o=l.evSaleGoodsList[n];l.amountTotal+=o.total}},ee=()=>{qe().then(n=>{})},ae=m([]);function te(){return E(this,null,function*(){const n=yield Ge({pageSize:9999});ae.value=n.records})}function le(){l.evSaleGoodsList.unshift({unit:"",code:"",spec:"",goodsId:"",saleMoney:"",num:"",total:""})}function oe(n){l.evSaleGoodsList.splice(n,1)}function se(n,o){J({id:n}).then(d=>{const s=l.evSaleGoodsList[o];s.spec=d.spec,s.unit=d.unit,s.code=d.code,s.salePrice=d.price})}Y(()=>{te()});function ne(){P({})}function P(n){Te(()=>{W(),n.id&&de(n.id)})}const de=n=>{J({id:n}).then(o=>{if(Object.assign(l,o),l.evSaleGoodsList.length>0)for(let d=0;d<l.evSaleGoodsList.length;d++){const s=l.evSaleGoodsList[d];changeRowGood(s.goodsId),R(s)}})};function ue(){return E(this,null,function*(){if(yield A(),l.evSaleGoodsList.length<1){g.warning("请填写商品信息");return}for(let d=0;d<l.evSaleGoodsList.length;d++){const s=l.evSaleGoodsList[d];if(!s.num||!s.total||!s.saleMoney||!s.goodsId){g.warning("请将商品数据填写完整");return}}L.value=!0;const n=m(!1);let o=l;o.id&&(n.value=!0),yield De(o,n.value).then(d=>{d.success?(g.success(d.message),B("ok")):g.warning(d.message)}).finally(()=>{L.value=!1})})}return f({add:ne,edit:P,submitForm:ue}),(n,o)=>{const d=i("a-input"),s=i("a-form-item"),r=i("a-col"),re=i("a-date-picker"),G=i("a-input-number"),M=i("a-row"),$=i("a-divider"),ie=i("a-textarea"),v=i("a-table-column"),pe=i("a-tooltip"),ce=i("a-space"),me=i("a-button"),fe=i("a-table"),ve=i("a-form"),_e=i("a-spin");return k(),q(_e,{spinning:L.value},{default:t(()=>[e(ve,{ref_key:"formRef",ref:I,class:"antd-modal-form",labelCol:z.value,wrapperCol:Z.value},{default:t(()=>[e(M,null,{default:t(()=>[e(r,{span:16},{default:t(()=>[e(M,null,{default:t(()=>[e(r,{span:12},{default:t(()=>[e(s,w({label:"销售单号"},_(S).code),{default:t(()=>[e(d,{value:l.code,"onUpdate:value":o[0]||(o[0]=a=>l.code=a),placeholder:"请输入销售单号",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"销售时间"},_(S).saleTime),{default:t(()=>[e(re,{placeholder:"请选择销售时间",value:l.saleTime,"onUpdate:value":o[1]||(o[1]=a=>l.saleTime=a),showTime:"","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"销售店铺"},_(S).departId),{default:t(()=>[e(U,{type:"select",value:l.departId,"onUpdate:value":o[2]||(o[2]=a=>l.departId=a),dictCode:"sys_depart,depart_name,id,parent_id!=''",placeholder:"请选择销售店铺",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"收款方式"},_(S).payType),{default:t(()=>[e(U,{type:"select",value:l.payType,"onUpdate:value":o[3]||(o[3]=a=>l.payType=a),dictCode:"ev_pay_type",placeholder:"请选择付款方式",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"销售人员"},_(S).saleUserId),{default:t(()=>[e(U,{type:"select",value:l.saleUserId,"onUpdate:value":o[4]||(o[4]=a=>l.saleUserId=a),dictCode:"sys_user,realname,id,username!='admin'",placeholder:"请选择销售人员",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,{label:"应付金额"},{default:t(()=>[e(G,{id:"inputNumber",value:l.amountTotal,"onUpdate:value":o[5]||(o[5]=a=>l.amountTotal=a),formatter:a=>`${a}元`,min:0,disabled:""},null,8,["value","formatter"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"客户类型"},_(S).customType),{default:t(()=>[e(U,{type:"radioButton",value:l.customType,"onUpdate:value":o[6]||(o[6]=a=>l.customType=a),dictCode:"ev_custom_type",placeholder:"请选择客户类型",disabled:p.value},null,8,["value","disabled"])]),_:1},16)]),_:1}),e(r,{span:12},{default:t(()=>[e(s,w({label:"实付金额"},_(S).payMoney),{default:t(()=>[e(G,{id:"inputNumber",value:l.payMoney,"onUpdate:value":o[7]||(o[7]=a=>l.payMoney=a),formatter:a=>`${a}元`,min:0,disabled:p.value},null,8,["value","formatter","disabled"])]),_:1},16)]),_:1})]),_:1})]),_:1}),e(r,{span:8},{default:t(()=>[e(s,{label:"付款凭证",required:"true"},{default:t(()=>[e(Ce,{value:l.img,"onUpdate:value":o[8]||(o[8]=a=>l.img=a),disabled:p.value,fileMax:4},null,8,["value","disabled"])]),_:1})]),_:1}),l.customType=="2"?(k(),q($,{key:0,orientation:"left",style:{height:"2px","border-color":"#999999"}},{default:t(()=>[Be]),_:1})):F("",!0),e(r,{span:24},{default:t(()=>[l.customType=="2"?(k(),q(M,{key:0},{default:t(()=>[e(r,{span:8},{default:t(()=>[e(s,{label:"客户名称",required:"true"},{default:t(()=>[e(U,{type:"select",value:l.name,"onUpdate:value":o[9]||(o[9]=a=>l.name=a),dictCode:"ev_custom,name,id,del_flag='0'",placeholder:"请选择客户名称",disabled:p.value},null,8,["value","disabled"])]),_:1})]),_:1}),e(r,{span:8},{default:t(()=>[e(s,{label:"联系电话"},{default:t(()=>[e(d,{value:l.phone,"onUpdate:value":o[10]||(o[10]=a=>l.phone=a),placeholder:"请输入联系电话",disabled:"false"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:t(()=>[e(s,{label:"联系地址"},{default:t(()=>[e(d,{value:l.address,"onUpdate:value":o[11]||(o[11]=a=>l.address=a),placeholder:"请输入联系地址",disabled:"false"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:24},{default:t(()=>[e(s,w({label:"备注"},_(S).description,{labelCol:X.value,wrapperCol:K.value}),{default:t(()=>[e(ie,{value:l.description,"onUpdate:value":o[12]||(o[12]=a=>l.description=a),disabled:p.value,rows:4},null,8,["value","disabled"])]),_:1},16,["labelCol","wrapperCol"])]),_:1})]),_:1})):F("",!0)]),_:1}),e($,{orientation:"left",style:{height:"2px","border-color":"#999999"}},{default:t(()=>[Le]),_:1}),e(r,{span:24},{default:t(()=>[e(fe,{pagination:!1,"data-source":l.evSaleGoodsList},{default:t(()=>[e(v,{title:"序号",width:"80px",align:"center"},{default:t(({record:a,index:c})=>[T("span",null,h(c+1),1)]),_:1}),e(v,{title:"商品名称",align:"center",width:"160px"},{default:t(({record:a,index:c})=>[e(xe,{onChange:O=>se(O,c),style:{width:"160px"},dict:"ev_goods,name,id,del_flag = '0'",value:a.goodsId,"onUpdate:value":O=>a.goodsId=O},null,8,["onChange","value","onUpdate:value"])]),_:1}),e(v,{title:"商品编号",align:"center",width:"120px"},{default:t(({record:a})=>[T("span",null,h(a.code),1)]),_:1}),e(v,{title:"计量单位",align:"center",width:"120px"},{default:t(({record:a})=>[T("span",null,h(a.unit),1)]),_:1}),e(v,{title:"规格型号",align:"center",width:"120px"},{default:t(({record:a})=>[e(pe,{autoAdjustOverflow:"true"},{title:t(()=>[N(h(a.spec),1)]),default:t(()=>[T("span",Me,h(a.spec),1)]),_:2},1024)]),_:1}),e(v,{title:"零售价",width:"100px",align:"center"},{default:t(({record:a})=>[T("span",null,h(a.salePrice)+"元",1)]),_:1}),e(v,{title:"数量",align:"center"},{default:t(({record:a})=>[e(G,{id:"inputNumber",value:a.num,"onUpdate:value":c=>a.num=c,min:0,onChange:c=>R(a),disabled:p.value},null,8,["value","onUpdate:value","onChange","disabled"])]),_:1}),e(v,{title:"总价",align:"center"},{default:t(({record:a})=>[e(G,{id:"inputNumber",value:a.total,"onUpdate:value":c=>a.total=c,formatter:c=>`${c}元`,min:0,onChange:j,disabled:p.value},null,8,["value","onUpdate:value","formatter","disabled"])]),_:1}),p.value?F("",!0):(k(),q(v,{key:0,align:"center"},{title:t(()=>[e(ce,{style:{cursor:"pointer"},onClick:le},{default:t(()=>[N("添加"),e(_(Ue))]),_:1})]),default:t(({index:a})=>[T("span",null,[e(me,{onClick:c=>oe(a)},{default:t(()=>[N("删除")]),_:2},1032,["onClick"])])]),_:1}))]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1},8,["labelCol","wrapperCol"])]),_:1},8,["spinning"])}}});const Ee=he(Oe,[["__scopeId","data-v-cc299fd5"]]),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));export{Ee as E,Xe as a,Ke as b,Qe as c,Ze as d,He as g,ze as l};
