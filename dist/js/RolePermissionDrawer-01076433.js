var h=(m,C,v)=>new Promise((y,u)=>{var i=a=>{try{c(v.next(a))}catch(p){u(p)}},f=a=>{try{c(v.throw(a))}catch(p){u(p)}},c=a=>a.done?y(a.value):Promise.resolve(a.value).then(i,f);c((v=v.apply(m,C)).next())});import{d as z,f as r,Y as k,a6 as P,ab as T,a9 as t,E as s,k as o,u as l,ad as G,Z as H,ae as J,a4 as Q,a5 as U,ac as A}from"./tinymce-vendor-3c2b3d6e.js";import{a as W,u as X,B as ee}from"./index-563223fc.js";import{_ as te}from"./index-d4a67b72.js";import{P as ae}from"./index-37448b2d.js";import oe from"./RoleDataRuleDrawer-3cbd10c3.js";import{m as le,n as b,o as se}from"./role.api-90341a61.js";import{_ as ne}from"./jeecg-online-vendor-f57c6456.js";import"./antd-vue-vendor-05bfa84d.js";import"./bem-a6e46c9e.js";import"./vxe-table-vendor-26792376.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";const B=m=>(Q("data-v-ce6058ab"),m=m(),U(),m),re=B(()=>A("div",{class:"line"},null,-1)),ie=B(()=>A("div",{class:"line"},null,-1)),ce=z({__name:"RolePermissionDrawer",emits:["register"],setup(m,{emit:C}){const v=C,y=r([]),u=r([]),i=r([]),f=r([]),c=r([]),a=r(""),p=r(null),g=r(!1),w=r([]),D=r(!0),[N,{openDrawer:$}]=W(),[V,{setDrawerProps:I,closeDrawer:x}]=X(e=>h(this,null,function*(){yield j(),I({confirmLoading:!1,loading:!0}),a.value=e.roleId;const n=yield le();y.value=n.treeList,u.value=n.ids,w.value=n.ids;const d=yield b({roleId:l(a)});i.value=d,f.value=d,I({loading:!1})}));function E(e){i.value=e.checked?e.checked:e}function L(e){e&&e.length>0&&(c.value=e),$(!0,{functionId:l(c)[0],roleId:l(a)})}function j(){y.value=[],u.value=[],i.value=[],f.value=[],c.value=[],a.value=""}function q(){const e=l(p);if(!e)throw new Error("tree is null!");return e}function K(e){return h(this,null,function*(){let n={roleId:l(a),permissionIds:l(q().getCheckedKeys()).join(","),lastpermissionIds:l(f).join(",")};if(g.value===!1&&(yield F(n)),e)x();else{const d=yield b({roleId:l(a)});f.value=d}})}function F(e){return h(this,null,function*(){g.value=!0,yield se(e),setTimeout(()=>{g.value=!1},500)})}function M({key:e}){e==="checkAll"?i.value=u.value:e==="cancelCheck"?i.value=[]:e==="openAll"?w.value=u.value:e==="closeAll"?w.value=[]:e==="relation"?D.value=!1:D.value=!0}return(e,n)=>{const d=k("Icon"),_=k("a-menu-item"),O=k("a-menu"),Y=k("a-dropdown"),S=k("a-button");return P(),T(l(ee),J(e.$attrs,{onRegister:l(V),width:"650px",destroyOnClose:"",showFooter:""}),{title:t(()=>[s(" 角色权限配置 "),o(Y,null,{overlay:t(()=>[o(O,{onClick:M},{default:t(()=>[o(_,{key:"checkAll"},{default:t(()=>[s("选择全部")]),_:1}),o(_,{key:"cancelCheck"},{default:t(()=>[s("取消选择")]),_:1}),re,o(_,{key:"openAll"},{default:t(()=>[s("展开全部")]),_:1}),o(_,{key:"closeAll"},{default:t(()=>[s("折叠全部")]),_:1}),ie,o(_,{key:"relation"},{default:t(()=>[s("层级关联")]),_:1}),o(_,{key:"standAlone"},{default:t(()=>[s("层级独立")]),_:1})]),_:1})]),default:t(()=>[o(d,{icon:"ant-design:more-outlined",class:"more-icon"})]),_:1})]),footer:t(()=>[o(l(ae),{title:"确定放弃编辑？",onConfirm:l(x),okText:"确定",cancelText:"取消"},{default:t(()=>[s("取消")]),_:1},8,["onConfirm"]),o(S,{onClick:n[0]||(n[0]=R=>K(!1)),type:"primary",loading:g.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:t(()=>[s("仅保存")]),_:1},8,["loading"]),o(S,{onClick:n[1]||(n[1]=R=>K(!0)),type:"primary",loading:g.value},{default:t(()=>[s("保存并关闭")]),_:1},8,["loading"])]),default:t(()=>[o(l(te),{ref_key:"treeRef",ref:p,checkable:"",treeData:y.value,checkedKeys:i.value,expandedKeys:w.value,selectedKeys:c.value,checkStrictly:D.value,clickRowToExpand:!1,title:"所拥有的的权限",onCheck:E,onSelect:L},{title:t(({slotTitle:R,ruleFlag:Z})=>[s(G(R)+" ",1),Z?(P(),T(d,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):H("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys","checkStrictly"]),o(oe,{onRegister:l(N)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});const De=ne(ce,[["__scopeId","data-v-ce6058ab"]]);export{De as default};
