import{d as O,f as g,r as G,Y as m,a6 as B,ab as M,a9 as u,k as v,E as D,ac as W,ao as P,Z as j}from"./tinymce-vendor-3c2b3d6e.js";import{ap as q,bs as z}from"./jeecg-online-vendor-f57c6456.js";import{B as U}from"./index-64ecc8b2.js";import{bH as Y,c as Z}from"./antd-vue-vendor-05bfa84d.js";import"./index-09260ce4.js";import{Q}from"./JAddInput-a2153936.js";import{C as $}from"./index-37448b2d.js";import"./vxe-table-vendor-26792376.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./useForm-df7d93c5.js";import"./componentMap-e2e33057.js";import"./useFormItem-613b6d5d.js";import"./index-2ad3f236.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./JSelectUser-6efbe652.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./JImageUpload-1b0b2e46.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JSelectDept-073e3b74.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./useTreeBiz-a3326efb.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JPopup-8248ac78.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./JTreeSelect-73cfd2cd.js";import"./JEllipsis-242e7bd0.js";import"./JUpload-70acb676.js";import"./index-76418551.js";import"./JSearchSelect-4158b9a9.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";import"./formUtils-09c7de86.js";import"./areaDataUtil-10873080.js";import"./data-9be677e2.js";import"./index-2d7d6454.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./depart.api-76b2f38a.js";var E=(i,f,p)=>new Promise((C,h)=>{var w=r=>{try{s(p.next(r))}catch(l){h(l)}},x=r=>{try{s(p.throw(r))}catch(l){h(l)}},s=r=>r.done?C(r.value):Promise.resolve(r.value).then(w,x);s((p=p.apply(i,f)).next())});const X=O({name:"CodeFileViewModal",components:{BasicModal:U,InfoCircleTwoTone:Y,JCodeEditor:Q},emits:["download","register","close"],setup(i,{emit:f}){const p=g([]),C=g(""),h=g([]),w=g(!1),x=window.innerHeight-160,s=g("java"),r=g("");let l=G({});const[b,{closeModal:_}]=$(e=>E(this,null,function*(){l=G({}),r.value="",p.value=e.codeList,C.value=e.pathKey,y(),w.value=!0}));function y(){let e=A(),n=e[0];k(n,e);let o=[];const t=function(d){if(d.children){let a=d.children;a.length==1?t(a[0]):a.length>1&&o.push(d)}};t(n),h.value=o,setTimeout(()=>{L(n)},300)}function L(e){return E(this,null,function*(){const n=function(t){if(t.isLeaf===!0)return t;if(t.children)return n(t.children[0])};let o=n(e);if(o&&o.isLeaf===!0){let t=o.path;l[t]||(yield I(t)),s.value=F(t),r.value=l[t]}})}function k(e,n){for(let o of n)e.key==o.pid&&(e.children||(e.children=[]),e.children.push(o),k(o,n))}function N(e,n){let o=0,t="";for(;o<=n;)t+=e[o],o++;return t}function A(){let e=[],n=[],o=p.value;for(let t of o){let d=t.replace(new RegExp("\\\\","g"),"/").replace("生成成功：","").trim();if(d){let a=d.split("/");for(let c=0;c<a.length;c++){let R=a[c],V=N(a,c);if(R){let T={title:R,key:V};if(R!=0){let S=N(a,c-1);S&&(T.pid=S)}c==a.length-1&&(T.isLeaf=!0,T.path=d),(n.indexOf(V)<0||c==a.length-1)&&(e.push(T),n.push(V))}}}}return e}function H(){_(),f("close")}function J(){f("download")}function F(e){return e.endsWith("xml")?"application/xml":e.endsWith("sql")?"text/x-sql":e.endsWith("vue")?"text/x-vue":e.endsWith("ts")?"text/typescript":"text/x-java"}function K(e,n){return E(this,null,function*(){let o=n.node.dataRef;if(o.isLeaf){let t=o.path;l[t]||(yield I(t)),s.value=F(t),r.value=l[t]}})}function I(e){return new Promise(n=>{let o={path:encodeURI(e),pathKey:C.value};q.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(t=>{if(!t||t.size===0){Z.warning("文件下载失败");return}let d=new Blob([t]),a=new FileReader;a.readAsText(d,"utf8"),a.onload=function(){let c=this.result;l[e]=c,n(1)}})})}return{registerModal:b,codeList:p,onDownloadGenerateCode:J,handleClose:H,treeData:h,showCodeContent:K,activeCodeContent:r,expandStatus:w,height:x,language:s}}});function ee(i,f,p,C,h,w){const x=m("info-circle-two-tone"),s=m("a-directory-tree"),r=m("a-col"),l=m("JCodeEditor"),b=m("a-empty"),_=m("a-row"),y=m("a-button"),L=m("BasicModal");return B(),M(L,{onRegister:i.registerModal,okText:"",cancelText:"关闭",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:i.onDownloadGenerateCode},{title:u(()=>[v(x),D(" 代码在线预览 ")]),footer:u(()=>[v(y,{onClick:i.handleClose},{default:u(()=>[D("关闭")]),_:1},8,["onClick"]),v(y,{type:"primary",onClick:i.onDownloadGenerateCode},{default:u(()=>[D("下载到本地")]),_:1},8,["onClick"])]),default:u(()=>[W("div",null,[v(_,null,{default:u(()=>[v(r,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:u(()=>[W("div",{style:P({height:i.height+"px",overflowY:"auto"})},[i.treeData.length?(B(),M(s,{key:0,defaultExpandAll:!0,"tree-data":i.treeData,onSelect:i.showCodeContent},null,8,["tree-data","onSelect"])):j("",!0)],4)]),_:1}),v(r,{span:18,gutter:3},{default:u(()=>[i.activeCodeContent?(B(),M(l,{key:0,value:i.activeCodeContent,"onUpdate:value":f[0]||(f[0]=k=>i.activeCodeContent=k),theme:"idea",language:i.language,fullScreen:!1,lineNumbers:!0,height:i.height+"px","language-change":!0},null,8,["value","language","height"])):(B(),M(b,{key:1,style:{"margin-top":"50px"},description:"请选择左侧文件，显示详细代码"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}const tt=z(X,[["render",ee]]);export{tt as default};
