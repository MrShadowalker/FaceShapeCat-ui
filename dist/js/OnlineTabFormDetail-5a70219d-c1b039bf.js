import{C as W,ap as Y,ao as q,bv as G,bs as X}from"./jeecg-online-vendor-f57c6456.js";import{f as u,w as Z,r as ee,Y as d,a6 as s,a7 as g,k as S,Z as B,a9 as D,ab as w,F as te,aa as re,ao as oe,Q as ae}from"./tinymce-vendor-3c2b3d6e.js";import{ae as ie}from"./index-37448b2d.js";import{br as ne}from"./antd-vue-vendor-05bfa84d.js";import pe from"./DetailForm-424638eb-a0926224.js";import me from"./OnlineSubFormDetail-f0d2c016-93cac491.js";import{p as le}from"./useExtendComponent-325fe3f1-007b9393.js";import{s as se,e as ue}from"./constant-754f1a9d-eadfd1e1.js";import"./index-76418551.js";import"./index-2d7d6454.js";import"./index-09260ce4.js";import"./componentMap-e2e33057.js";import"./index-64ecc8b2.js";import"./index-8e09cdad.js";import"./user.api-367a7bce.js";import"./customExpression-b2f1ff9b.js";import"./index-0f0d0317.js";import"./useListPage-66651993.js";import"./LinkTableListPiece-8499a318-01ebb291.js";import"./OnlineSelectCascade-4265c95d-4cbe6ffe.js";import"./JModalTip-33c7dc44-1741a3e9.js";import"./vxe-table-vendor-26792376.js";import"./data-9be677e2.js";import"./JUpload-70acb676.js";import"./useForm-df7d93c5.js";import"./formUtils-09c7de86.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./BasicTable-400bb95b.js";import"./injectionKey-69710956.js";import"./index-2ad3f236.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./JAddInput-a2153936.js";import"./areaDataUtil-10873080.js";import"./useFormItem-613b6d5d.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./depart.api-76b2f38a.js";import"./JSelectUser-6efbe652.js";import"./JSelectDept-073e3b74.js";import"./useTreeBiz-a3326efb.js";import"./JPopup-8248ac78.js";import"./JEllipsis-242e7bd0.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JTreeSelect-73cfd2cd.js";import"./JSearchSelect-4158b9a9.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JImageUpload-1b0b2e46.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";var de=Object.defineProperty,I=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,M=(n,a,o)=>a in n?de(n,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[a]=o,be=(n,a)=>{for(var o in a||(a={}))ce.call(a,o)&&M(n,o,a[o]);if(I)for(var o of I(a))fe.call(a,o)&&M(n,o,a[o]);return n},K=(n,a,o)=>new Promise((r,h)=>{var v=m=>{try{l(o.next(m))}catch(c){h(c)}},y=m=>{try{l(o.throw(m))}catch(c){h(c)}},l=m=>m.done?r(m.value):Promise.resolve(m.value).then(v,y);l((o=o.apply(n,a)).next())});const he={name:"OnlineTabFormDetail",components:{DetailForm:pe,Loading:ie,PrinterOutlined:ne,OnlineSubFormDetail:me},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},showSub:{type:Boolean,default:!0},themeTemplate:{type:String,default:""},tabIndex:{type:String,default:""}},emits:["success","rendered"],setup(n,{emit:a}){const{createMessage:o}=W(),r=u(""),h=u(!0),v=u(!1),y=u(1),l=u({}),m=u(300),c=u(340),T=u("0");Z(()=>n.tabIndex,(e,t)=>{T.value=e,t&&_()},{immediate:!0});const b=ee({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{detailFormSchemas:P,hasSubTable:k,subTabInfo:p,refMap:x,showStatus:F,subDataSource:C,createFormSchemas:R,formSpan:V}=le(n);function A(e){let t={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};e&&(t=JSON.parse(e)),Object.keys(t).map(i=>{b[i]=t[i]})}function J(e){return K(this,null,function*(){y.value=e.head.tableType,r.value=e.head.tableName,h.value=e.head.tableType==1,A(e.head.extConfigJson),R(e.schema.properties),a("rendered",b)})}function N(e,t){return K(this,null,function*(){yield H(t),O(!0)})}function E(e){let t=`/online/cgform/api/detail/${n.id}/${e}`;return new Promise((i,f)=>{Y.get({url:t},{isTransformResponse:!1}).then(j=>{j.success?i(j.result):(f(),o.warning(j.message))}).catch(()=>{f()})})}function O(e){Object.keys(F).map(t=>{F[t]=e})}function _(){O(!1),setTimeout(()=>{O(!0)},300)}function H(e){return K(this,null,function*(){let t=yield E(e.id);l.value=be({},t),U(t)})}function U(e){e||(e={});let t=Object.keys(C.value);if(t&&t.length>0){let i={};for(let f of t)i[f]=e[f]||[];C.value=i}}function L(e){return"online_"+e+":"}function z(){let e=b.reportPrintUrl,t=l.value;if(t){let i=t.id,f=q();G(e,i,f)}}function Q(e){let t=l.value;return $(t,e)}function $(e,t){if(e){let i=e[t];return!i&&i!==0&&(i=e[t.toLowerCase()],!i&&i!==0&&(i=e[t.toUpperCase()])),i}return""}return{detailFormSchemas:P,formData:l,formSpan:V,tableName:r,loading:v,hasSubTable:k,subTabInfo:p,subFormHeight:m,subTableHeight:c,refMap:x,onTabChange:_,subDataSource:C,getSubTableAuthPre:L,show:N,createRootProperties:J,onOpenReportPrint:z,onlineExtConfigJson:b,getSubTableForeignKeyValue:Q,showStatus:F,ERP:se,TAB:ue,subActiveKey:T}}},ye=["id"],ge={key:0,style:{"text-align":"right",position:"absolute",top:"15px",right:"20px","z-index":"999"}},Se={key:1};function ve(n,a,o,r,h,v){const y=d("PrinterOutlined"),l=d("detail-form"),m=d("a-tab-pane"),c=d("online-sub-form-detail"),T=d("JVxeTable"),b=d("a-spin"),P=d("a-tabs"),k=d("Loading");return s(),g("div",{id:r.tableName+"_form"},[r.formData.id&&r.onlineExtConfigJson.reportPrintShow?(s(),g("div",ge,[S(y,{title:"打印",onClick:r.onOpenReportPrint,style:{"font-size":"16px"}},null,8,["onClick"])])):B("",!0),S(P,{class:"tabTheme",onChange:r.onTabChange,activeKey:r.subActiveKey,"onUpdate:activeKey":a[0]||(a[0]=p=>r.subActiveKey=p)},{default:D(()=>[(s(),w(m,{tab:"主表",key:"-1"},{default:D(()=>[S(l,{schemas:r.detailFormSchemas,data:r.formData,span:r.formSpan},null,8,["schemas","data","span"])]),_:1})),r.hasSubTable&&o.showSub?(s(!0),g(te,{key:0},re(r.subTabInfo,(p,x)=>(s(),w(m,{tab:p.describe,key:x+"",forceRender:!0},{default:D(()=>[p.relationType==1?(s(),g("div",{key:0,style:oe({"overflow-y":"auto","overflow-x":"hidden","max-height":r.subFormHeight+"px"})},[S(c,{table:p.key,"form-template":o.formTemplate,"main-id":r.getSubTableForeignKeyValue(p.foreignKey),properties:p.properties},null,8,["table","form-template","main-id","properties"])],4)):(s(),g("div",Se,[r.showStatus[p.key]?(s(),w(T,{key:0,ref_for:!0,ref:r.refMap[p.key],toolbar:"","keep-source":"","row-number":"","row-selection":"",height:r.subTableHeight,disabled:!0,columns:p.columns,dataSource:r.subDataSource[p.key],authPre:r.getSubTableAuthPre(p.key)},null,8,["height","columns","dataSource","authPre"])):(s(),w(b,{key:1,spinning:!0}))]))]),_:2},1032,["tab"]))),128)):B("",!0)]),_:1},8,["onChange","activeKey"]),S(k,{loading:r.loading,absolute:!1},null,8,["loading"]),ae(n.$slots,"bottom",{},void 0,!0)],8,ye)}const Mt=X(he,[["render",ve],["__scopeId","data-v-e0b07b2d"]]);export{Mt as default};
