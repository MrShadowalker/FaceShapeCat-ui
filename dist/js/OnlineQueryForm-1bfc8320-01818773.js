import"./index-09260ce4.js";import{f as O,r as pe,w as N,I as H,a4 as me,a5 as ue,ac as V,Y,a6 as A,a7 as J,k as c,a9 as w,E,ad as ce,Z as $}from"./tinymce-vendor-3c2b3d6e.js";import{C as de,ap as fe,bs as he}from"./jeecg-online-vendor-f57c6456.js";import{M as ge,f as Z,m as ye,H as L,n as ve,A as be,c as G,D as we}from"./useExtendComponent-325fe3f1-007b9393.js";import{o as Se}from"./constant-754f1a9d-eadfd1e1.js";import"./componentMap-e2e33057.js";import"./index-37448b2d.js";import"./antd-vue-vendor-05bfa84d.js";import"./index-64ecc8b2.js";import"./index-8e09cdad.js";import"./user.api-367a7bce.js";import"./customExpression-b2f1ff9b.js";import"./index-0f0d0317.js";import"./useListPage-66651993.js";import"./index-76418551.js";import"./LinkTableListPiece-8499a318-01ebb291.js";import"./OnlineSelectCascade-4265c95d-4cbe6ffe.js";import"./JModalTip-33c7dc44-1741a3e9.js";import{B as Fe,u as xe}from"./useForm-df7d93c5.js";import"./JAddInput-a2153936.js";import"./areaDataUtil-10873080.js";import"./data-9be677e2.js";import"./useFormItem-613b6d5d.js";import"./useSelectBiz-b5c21498.js";import"./props-ea47501e.js";import"./JSelectBiz-b887fca6.js";import"./index-2d7d6454.js";import"./BasicModal-9d388b71.js";import"./useWindowSizeFn-e63bb4b0.js";import"./vxe-table-vendor-26792376.js";import"./htmlmixed-6ab39e30.js";import"./codemirror-vendor-0a03fef5.js";import"./vue-41a95ea0.js";/* empty css             */import"./anyword-hint-577f8e6e.js";import"./index-d4a67b72.js";import"./bem-a6e46c9e.js";import"./props-3977d3d5.js";import"./useContextMenu-3e9e42e0.js";import"./depart.api-76b2f38a.js";import"./JSelectUser-6efbe652.js";import"./JSelectDept-073e3b74.js";import"./useTreeBiz-a3326efb.js";import"./JPopup-8248ac78.js";import"./JEllipsis-242e7bd0.js";import"./JDictSelectTag-f0227cc5.js";import"./CompTypeEnum-5c91fd88.js";import"./JTreeSelect-73cfd2cd.js";import"./JSearchSelect-4158b9a9.js";import"./JEditor-75d90eae.js";import"./index-13e7f179.js";import"./JImageUpload-1b0b2e46.js";import"./JUpload-70acb676.js";import"./BasicTable-400bb95b.js";import"./injectionKey-69710956.js";import"./index-2ad3f236.js";import"./download-2caf3e60.js";import"./base64Conver-fa2fe1af.js";import"./index-ee632f67.js";import"./index-b5f97370.js";import"./useCountdown-d833a954.js";import"./useFormItemSingle-4fd81116.js";import"./cron-parser-vendor-a4cfb0b0.js";import"./index-3dc0c4fd.js";import"./index-aba90786.js";import"./formUtils-09c7de86.js";var _e=Object.defineProperty,W=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,z=(s,l,n)=>l in s?_e(s,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[l]=n,T=(s,l)=>{for(var n in l||(l={}))ke.call(l,n)&&z(s,n,l[n]);if(W)for(var n of W(l))Oe.call(l,n)&&z(s,n,l[n]);return s},C=(s,l,n)=>new Promise((p,S)=>{var D=f=>{try{y(n.next(f))}catch(x){S(x)}},F=f=>{try{y(n.throw(f))}catch(x){S(x)}},y=f=>f.done?p(f.value):Promise.resolve(f.value).then(D,F);y((n=n.apply(s,l)).next())});const je={name:"OnlineQueryForm",components:{BasicForm:Fe},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(s,{emit:l}){const n="/online/cgform/api/getQueryInfoVue3/",p=O(null),S=O([]),D=O({xs:24,sm:24,md:12,lg:6,xl:6}),F=O(!1),y=O(!1),f=O({}),x=O([]),{createMessage:M}=de(),{linkTableCard2Select:B}=ge(),P=O(80),o=pe({config:{},cache:{},param:{},status:!1});N(()=>o.status,t=>C(this,null,function*(){const{config:e,cache:i,param:v}=H(o);let u=Object.assign({},e,i,v);yield X(u)}),{immediate:!0,deep:!0});function m(t,e){return C(this,null,function*(){o.cache=T({},t),o.param=T({},e),o.status=!o.status})}N(()=>s.id,t=>{t?K():S.value=[]},{immediate:!0});function d(t){return C(this,null,function*(){let e=[],i={},v=Object.keys(t),u=-1;for(let r of v){const a=t[r];r==="sys_org_code"&&(a.fieldExtendJson||(a.fieldExtendJson='{"store":"orgCode"}'));let h=a.view;if(Z[h]&&(a.view=Z[h]),yield ye(r,a,i),a.mode=="group"&&(h=="date"||h=="datetime"||h=="number")){let k=L.createSlotFormSchema(r,a);e.push(k)}else if(a.view===ve){let k=be(a,r);for(let j of k){let U=L.createFormSchema(j.key,j),Q=G(e,j.key);Q==-1?e.push(U):e[Q]=U}}else if(G(e,r)==-1){let k=L.createFormSchema(r,a);e.push(k)}let _=a.fieldExtendJson;_&&(_=JSON.parse(_),_.labelLength&&(u>-1?u=_.labelLength>u?_.labelLength:u:u=_.labelLength))}u==-1&&(u=Se),e.sort(function(r,a){return r.order-a.order});let g=[];e.length>2&&(F.value=!0);let b=[];for(let r=0;r<e.length;r++){let a=e[r];a.setFormRef(p),a.noChange(),a.asSearchForm(),r>1&&(b.push(a.field),a.isHidden());let h=a.getFormItemSchema();a.slot=="groupDatetime"&&(h.colProps={xs:24,sm:24,md:12,lg:8,xl:8}),B(h),g.push(h)}x.value=b,S.value=g,o.config=T({},i),o.status=!o.status,setTimeout(()=>{const r=u*14+u+24;P.value=r},0)})}function K(){return C(this,null,function*(){let t=yield re(),e=te(t);l("loaded",t);let{formProperties:i,hasField:v}=ee(e,t);if(v==!1){S.value=[];return}yield d(i)})}function X(t){return C(this,null,function*(){yield we(p),yield q(t),Object.keys(t).length>0&&I()})}function ee(t,e){const{searchFieldList:i,joinQuery:v,table:u}=e;let g=!1,b={};return t&&Object.keys(t).map(r=>{i.indexOf(r)>=0&&(v==!0?r.indexOf("@")<0?(b[u+"@"+r]=t[r],g=!0):(b[r]=t[r],g=!0):r.indexOf("@")<0&&(b[r]=t[r],g=!0))}),{formProperties:b,hasField:g}}function te(t){const{properties:e,searchFieldList:i,joinQuery:v,table:u}=t;let g={},b=1;return Object.keys(e).map(r=>{let a=e[r];if(a.view=="table"){let h=a.properties,_=b*100;Object.keys(h).map(k=>{let j=h[k];j.order=_+Number(j.order);let U=r+"@"+k;g[U]=j}),b++}else a.order=Number(a.order),g[r]=a}),g}function re(){let t=`${n}${s.id}`;return new Promise(e=>{fe.get({url:t},{isTransformResponse:!1}).then(i=>{i.success?e(i.result):(e(!1),M.warning(i.message))}).catch(()=>{M.warning("获取查询条件失败!"),e(!1)})})}const[oe,{resetFields:ae,setFieldsValue:q,updateSchema:le,getFieldsValue:ie}]=xe({schemas:S,showActionButtonGroup:!1,baseColProps:D,autoSubmitOnEnter:!0,labelWidth:P,wrapperCol:null,submitFunc(){I()}});function I(){let t=ie(),e=Object.assign({},H(o.param),se(t));l("search",e,!0)}function ne(){return C(this,null,function*(){yield ae();const{config:t,param:e}=H(o);let i=Object.assign({},t,e);Object.keys(i).length>0&&(yield q(i)),l("search",i,!1)})}function se(t){return Object.keys(t).map(e=>{t[e]&&t[e]instanceof Array&&(t[e]=t[e].join(","))}),t}return N(()=>y.value,t=>{let e=x.value;if(e&&e.length>0){let i=[];for(let v of e)i.push({field:v,show:t});le(i)}},{immediate:!1}),{onlineQueryFormRef:p,registerForm:oe,initDefaultValues:m,toggleButtonShow:F,toggleSearchStatus:y,doSearch:I,resetSearch:ne,queryParams:f,formSchemas:S}}},R=s=>(me("data-v-3e6e229f"),s=s(),ue(),s),Ye={key:0,class:"jeecg-basic-table-form-container online-query-form p-0"},Ce=R(()=>V("span",{class:"group-query-string"},"~",-1)),De=R(()=>V("span",{class:"group-query-string"},"~",-1)),Me=R(()=>V("span",{class:"group-query-string"},"~",-1)),Pe={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function Ue(s,l,n,p,S,D){const F=Y("a-date-picker"),y=Y("a-form-item-rest"),f=Y("a-input-number"),x=Y("a-button"),M=Y("a-icon"),B=Y("a-col"),P=Y("BasicForm");return p.formSchemas&&p.formSchemas.length>0?(A(),J("div",Ye,[c(P,{ref:"onlineQueryFormRef",onRegister:p.registerForm},{groupDate:w(({model:o,field:m})=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"开始日期",value:o[m+"_begin"],"onUpdate:value":d=>o[m+"_begin"]=d,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),Ce,c(y,null,{default:w(()=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"结束日期",value:o[m+"_end"],"onUpdate:value":d=>o[m+"_end"]=d,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupDatetime:w(({model:o,field:m})=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",value:o[m+"_begin"],"onUpdate:value":d=>o[m+"_begin"]=d,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),De,c(y,null,{default:w(()=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",value:o[m+"_end"],"onUpdate:value":d=>o[m+"_end"]=d,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupNumber:w(({model:o,field:m})=>[c(f,{placeholder:"开始值",value:o[m+"_begin"],"onUpdate:value":d=>o[m+"_begin"]=d,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),Me,c(y,null,{default:w(()=>[c(f,{placeholder:"结束值",value:o[m+"_end"],"onUpdate:value":d=>o[m+"_end"]=d,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),formFooter:w(()=>[c(B,{md:6,sm:8},{default:w(()=>[V("span",Pe,[c(x,{preIcon:"ant-design:search",type:"primary",onClick:p.doSearch},{default:w(()=>[E("查询")]),_:1},8,["onClick"]),c(x,{preIcon:"ant-design:reload",type:"primary",onClick:p.resetSearch,style:{"margin-left":"8px"}},{default:w(()=>[E("重置")]),_:1},8,["onClick"]),p.toggleButtonShow?(A(),J("a",{key:0,onClick:l[0]||(l[0]=o=>p.toggleSearchStatus=!p.toggleSearchStatus),style:{"margin-left":"8px"}},[E(ce(p.toggleSearchStatus?"收起":"展开")+" ",1),c(M,{type:p.toggleSearchStatus?"up":"down"},null,8,["type"])])):$("",!0)])]),_:1})]),_:1},8,["onRegister"])])):$("",!0)}const Jt=he(je,[["render",Ue],["__scopeId","data-v-3e6e229f"]]);export{Jt as default};
