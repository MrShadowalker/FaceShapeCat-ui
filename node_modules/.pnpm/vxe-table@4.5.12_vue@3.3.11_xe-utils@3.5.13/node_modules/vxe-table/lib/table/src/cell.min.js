"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_util=require("./util"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,r=1,t=arguments.length;r<t;r++)for(var n in l=arguments[r])Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);return e}).apply(this,arguments)};function renderHelpIcon(l){var r=l.$table,e=l.column,e=e.titlePrefix||e.titleHelp;return e?[(0,_vue.h)("i",{class:["vxe-cell-help-icon",e.icon||_conf.default.icon.TABLE_HELP],onMouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},onMouseleave:function(e){r.handleTargetLeaveEvent(e)}})]:[]}function renderTitleContent(l,e){var r=l.$table,t=l.column,n=r.props,a=r.reactData,o=r.getComputeMaps().computeTooltipOpts,n=n.showHeaderOverflow,i=t.type,d=t.showHeaderOverflow,c=o.value.showAll,o=_xeUtils.default.isUndefined(d)||_xeUtils.default.isNull(d)?n:d,s="title"===o,u=!0===o||"tooltip"===o,n={};return(s||u||c)&&(n.onMouseenter=function(e){a._isResize||(s?(0,_dom.updateCellTitle)(e.currentTarget,t):(u||c)&&r.triggerHeaderTooltipEvent(e,l))}),(u||c)&&(n.onMouseleave=function(e){a._isResize||(u||c)&&r.handleTargetLeaveEvent(e)}),["html"===i&&_xeUtils.default.isString(e)?(0,_vue.h)("span",__assign({class:"vxe-cell--title",innerHTML:e},n)):(0,_vue.h)("span",__assign({class:"vxe-cell--title"},n),(0,_vn.getSlotVNs)(e))]}function getFooterContent(e){var l=e.$table,r=e.column,t=e._columnIndex,n=e.items,a=r.slots,o=r.editRender,r=r.cellRender,o=o||r,r=a?a.footer:null;if(r)return l.callSlot(r,e);if(o){a=_vXETable.VXETable.renderer.get(o.name);if(a&&a.renderFooter)return(0,_vn.getSlotVNs)(a.renderFooter(o,e))}return[(0,_utils.formatText)(n[t],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,e=e.column;return(0,_utils.formatText)(l.getCellLabel(r,e),1)}var Cell={createColumn:function(e,l){var r=l.type,t=l.sortable,n=l.filters,a=l.editRender,o=l.treeNode,i=e.props.editConfig,d=e.getComputeMaps(),c=d.computeEditOpts,s=d.computeCheckboxOpts.value,u=c.value,C={renderHeader:Cell.renderDefaultHeader,renderCell:o?Cell.renderTreeCell:Cell.renderDefaultCell,renderFooter:Cell.renderDefaultFooter};switch(r){case"seq":C.renderHeader=Cell.renderSeqHeader,C.renderCell=o?Cell.renderTreeIndexCell:Cell.renderSeqCell;break;case"radio":C.renderHeader=Cell.renderRadioHeader,C.renderCell=o?Cell.renderTreeRadioCell:Cell.renderRadioCell;break;case"checkbox":C.renderHeader=Cell.renderCheckboxHeader,C.renderCell=s.checkField?o?Cell.renderTreeSelectionCellByProp:Cell.renderCheckboxCellByProp:o?Cell.renderTreeSelectionCell:Cell.renderCheckboxCell;break;case"expand":C.renderCell=Cell.renderExpandCell,C.renderData=Cell.renderExpandData;break;case"html":C.renderCell=o?Cell.renderTreeHTMLCell:Cell.renderHTMLCell,n&&t?C.renderHeader=Cell.renderSortAndFilterHeader:t?C.renderHeader=Cell.renderSortHeader:n&&(C.renderHeader=Cell.renderFilterHeader);break;default:i&&a?(C.renderHeader=Cell.renderEditHeader,C.renderCell="cell"===u.mode?o?Cell.renderTreeCellEdit:Cell.renderCellEdit:o?Cell.renderTreeRowEdit:Cell.renderRowEdit):n&&t?C.renderHeader=Cell.renderSortAndFilterHeader:t?C.renderHeader=Cell.renderSortHeader:n&&(C.renderHeader=Cell.renderFilterHeader)}return(0,_util.createColumn)(e,l,C)},renderHeaderTitle:function(e){var l=e.$table,r=e.column,t=r.slots,n=r.editRender,a=r.cellRender,n=n||a,a=t?t.header:null;if(a)return renderTitleContent(e,l.callSlot(a,e));if(n){t=_vXETable.VXETable.renderer.get(n.name);if(t&&t.renderHeader)return renderTitleContent(e,(0,_vn.getSlotVNs)(t.renderHeader(n,e)))}return renderTitleContent(e,(0,_utils.formatText)(r.getTitle(),1))},renderDefaultHeader:function(e){return renderHelpIcon(e).concat(Cell.renderHeaderTitle(e))},renderDefaultCell:function(e){var l=e.$table,r=e.row,t=e.column,n=t.slots,a=t.editRender,o=t.cellRender,o=a||o,n=n?n.default:null;if(n)return l.callSlot(n,e);if(o){var n=a?"renderCell":"renderDefault",i=_vXETable.VXETable.renderer.get(o.name),i=i?i[n]:null;if(i)return(0,_vn.getSlotVNs)(i(o,Object.assign({$type:a?"edit":"cell"},e)))}n=l.getCellLabel(r,t),i=a?a.placeholder:"";return[(0,_vue.h)("span",{class:"vxe-cell--label"},a&&(0,_utils.eqEmptyValue)(n)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(i),1))]:(0,_utils.formatText)(n,1))]},renderTreeCell:function(e){return Cell.renderTreeIcon(e,Cell.renderDefaultCell(e))},renderDefaultFooter:function(e){return[(0,_vue.h)("span",{class:"vxe-cell--item"},getFooterContent(e))]},renderTreeIcon:function(l,e){var r=l.$table,t=l.isHidden,n=r.reactData,a=r.getComputeMaps().computeTreeOpts,o=n.treeExpandedMaps,n=n.treeExpandLazyLoadedMaps,a=a.value,i=l.row,d=l.column,c=l.level,d=d.slots,s=a.indent,u=a.lazy,C=a.trigger,_=a.iconLoaded,f=a.showIcon,v=a.iconOpen,p=a.iconClose,E=a.children||a.childrenField,a=a.hasChild||a.hasChildField,E=i[E],d=d?d.icon:null,h=!1,b=!1,x=!1,T={};return d?r.callSlot(d,l):(t||(b=!!o[d=(0,_util.getRowid)(r,i)],u&&(x=!!n[d],h=i[a])),C&&"default"!==C||(T.onClick=function(e){e.stopPropagation(),r.triggerTreeExpandEvent(e,l)}),[(0,_vue.h)("div",{class:["vxe-cell--tree-node",{"is--active":b}],style:{paddingLeft:"".concat(c*s,"px")}},[f&&(E&&E.length||h)?[(0,_vue.h)("div",__assign({class:"vxe-tree--btn-wrapper"},T),[(0,_vue.h)("i",{class:["vxe-tree--node-btn",x?_||_conf.default.icon.TABLE_TREE_LOADED:b?v||_conf.default.icon.TABLE_TREE_OPEN:p||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,(0,_vue.h)("div",{class:"vxe-tree-cell"},e)])])},renderSeqHeader:function(e){var l=e.$table,r=e.column,t=r.slots,t=t?t.header:null;return renderTitleContent(e,t?l.callSlot(t,e):(0,_utils.formatText)(r.getTitle(),1))},renderSeqCell:function(e){var l=e.$table,r=e.column,t=l.props.treeConfig,n=l.getComputeMaps().computeSeqOpts.value,r=r.slots,r=r?r.default:null;return r?l.callSlot(r,e):(l=e.seq,r=n.seqMethod,[(0,_utils.formatText)(r?r(e):t?l:(n.startIndex||0)+l,1)])},renderTreeIndexCell:function(e){return Cell.renderTreeIcon(e,Cell.renderSeqCell(e))},renderRadioHeader:function(e){var l=e.$table,r=e.column,t=r.slots,n=t?t.header:null,t=t?t.title:null;return renderTitleContent(e,n?l.callSlot(n,e):[(0,_vue.h)("span",{class:"vxe-radio--label"},t?l.callSlot(t,e):(0,_utils.formatText)(r.getTitle(),1))])},renderRadioCell:function(l){var e,r=l.$table,t=l.column,n=l.isHidden,a=r.reactData,o=r.getComputeMaps().computeRadioOpts,a=a.selectRadioRow,o=o.value,t=t.slots,i=o.labelField,d=o.checkMethod,o=o.visibleMethod,c=l.row,s=t?t.default:null,t=t?t.radio:null,a=r.eqRow(c,a),u=!o||o({row:c}),C=!!d,o=(n||(e={onClick:function(e){!C&&u&&(e.stopPropagation(),r.triggerRadioRowEvent(e,l))}},d&&(C=!d({row:c}))),__assign(__assign({},l),{checked:a,disabled:C,visible:u}));return t?r.callSlot(t,o):(n=[],u&&n.push((0,_vue.h)("span",{class:["vxe-radio--icon",a?_conf.default.icon.TABLE_RADIO_CHECKED:_conf.default.icon.TABLE_RADIO_UNCHECKED]})),(s||i)&&n.push((0,_vue.h)("span",{class:"vxe-radio--label"},s?r.callSlot(s,o):_xeUtils.default.get(c,i))),[(0,_vue.h)("span",__assign({class:["vxe-cell--radio",{"is--checked":a,"is--disabled":C}]},e),n)])},renderTreeRadioCell:function(e){return Cell.renderTreeIcon(e,Cell.renderRadioCell(e))},renderCheckboxHeader:function(e){var l,r=e.$table,t=e.column,n=e.isHidden,a=r.reactData,o=r.getComputeMaps(),i=o.computeIsAllCheckboxDisabled,o=o.computeCheckboxOpts,d=a.isAllSelected,a=a.isIndeterminate,c=i.value,i=t.slots,s=i?i.header:null,i=i?i.title:null,o=o.value,t=t.getTitle(),n=(n||(l={onClick:function(e){c||(e.stopPropagation(),r.triggerCheckAllEvent(e,!d))}}),__assign(__assign({},e),{checked:d,disabled:c,indeterminate:a}));return s?renderTitleContent(n,r.callSlot(s,n)):(o.checkStrictly?o.showHeader:!1!==o.showHeader)?renderTitleContent(n,[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":d,"is--disabled":c,"is--indeterminate":a}],title:_conf.default.i18n("vxe.table.allTitle")},l),[(0,_vue.h)("span",{class:["vxe-checkbox--icon",a?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:d?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})].concat(i||t?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},i?r.callSlot(i,n):t)]:[]))]):renderTitleContent(n,[(0,_vue.h)("span",{class:"vxe-checkbox--label"},i?r.callSlot(i,n):t)])},renderCheckboxCell:function(l){var e,r=l.$table,t=l.row,n=l.column,a=l.isHidden,o=r.props,i=r.reactData,o=o.treeConfig,d=i.selectCheckboxMaps,i=i.treeIndeterminateMaps,c=r.getComputeMaps().computeCheckboxOpts.value,s=c.labelField,u=c.checkMethod,c=c.visibleMethod,n=n.slots,C=n?n.default:null,n=n?n.checkbox:null,_=!1,f=!1,v=!c||c({row:t}),p=!!u,a=(a||(c=(0,_util.getRowid)(r,t),f=!!d[c],e={onClick:function(e){!p&&v&&(e.stopPropagation(),r.triggerCheckRowEvent(e,l,!f))}},u&&(p=!u({row:t})),o&&(_=!!i[c])),__assign(__assign({},l),{checked:f,disabled:p,visible:v,indeterminate:_}));return n?r.callSlot(n,a):(d=[],v&&d.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",_?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:f?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(C||s)&&d.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},C?r.callSlot(C,a):_xeUtils.default.get(t,s))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":f,"is--disabled":p,"is--indeterminate":_}]},e),d)])},renderTreeSelectionCell:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCell(e))},renderCheckboxCellByProp:function(l){var e,r=l.$table,t=l.row,n=l.column,a=l.isHidden,o=r.props,i=r.reactData,o=o.treeConfig,i=i.treeIndeterminateMaps,d=r.getComputeMaps().computeCheckboxOpts.value,c=d.labelField,s=d.checkField,u=d.checkMethod,C=d.visibleMethod,d=d.indeterminateField||d.halfField,n=n.slots,_=n?n.default:null,n=n?n.checkbox:null,f=!1,v=!1,p=!C||C({row:t}),E=!!u,a=(a||(C=(0,_util.getRowid)(r,t),v=_xeUtils.default.get(t,s),e={onClick:function(e){!E&&p&&(e.stopPropagation(),r.triggerCheckRowEvent(e,l,!v))}},u&&(E=!u({row:t})),o&&(f=!!i[C])),__assign(__assign({},l),{checked:v,disabled:E,visible:p,indeterminate:f}));return n?r.callSlot(n,a):(s=[],p&&(s.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",f?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:v?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),_||c)&&s.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},_?r.callSlot(_,a):_xeUtils.default.get(t,c))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":v,"is--disabled":E,"is--indeterminate":d&&!v?t[d]:f}]},e),s)])},renderTreeSelectionCellByProp:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCellByProp(e))},renderExpandCell:function(l){var r=l.$table,e=l.isHidden,t=l.row,n=l.column,a=r.reactData,o=a.rowExpandedMaps,a=a.rowExpandLazyLoadedMaps,i=r.getComputeMaps().computeExpandOpts.value,d=i.lazy,c=i.labelField,s=i.iconLoaded,u=i.showIcon,C=i.iconOpen,_=i.iconClose,i=i.visibleMethod,n=n.slots,f=n?n.default:null,n=n?n.icon:null,v=!1,p=!1;return n?r.callSlot(n,l):(e||(v=!!o[n=(0,_util.getRowid)(r,t)],d&&(p=!!a[n])),[!u||i&&!i(l)?null:(0,_vue.h)("span",{class:["vxe-table--expanded",{"is--active":v}],onClick:function(e){e.stopPropagation(),r.triggerRowExpandEvent(e,l)}},[(0,_vue.h)("i",{class:["vxe-table--expand-btn",p?s||_conf.default.icon.TABLE_EXPAND_LOADED:v?C||_conf.default.icon.TABLE_EXPAND_OPEN:_||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),f||c?(0,_vue.h)("span",{class:"vxe-table--expand-label"},f?r.callSlot(f,l):_xeUtils.default.get(t,c)):null])},renderExpandData:function(e){var l=e.$table,r=e.column,t=r.slots,r=r.contentRender,t=t?t.content:null;if(t)return l.callSlot(t,e);if(r){l=_vXETable.VXETable.renderer.get(r.name);if(l&&l.renderExpand)return(0,_vn.getSlotVNs)(l.renderExpand(r,e))}return[]},renderHTMLCell:function(e){var l=e.$table,r=e.column.slots,r=r?r.default:null;return r?l.callSlot(r,e):[(0,_vue.h)("span",{class:"vxe-cell--html",innerHTML:getDefaultCellLabel(e)})]},renderTreeHTMLCell:function(e){return Cell.renderTreeIcon(e,Cell.renderHTMLCell(e))},renderSortAndFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e)).concat(Cell.renderFilterIcon(e))},renderSortHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e))},renderSortIcon:function(e){var l=e.$table,r=e.column,e=l.getComputeMaps().computeSortOpts.value,t=e.showIcon,n=e.iconAsc,e=e.iconDesc,a=r.order;return t?[(0,_vue.h)("span",{class:"vxe-cell--sort"},[(0,_vue.h)("i",{class:["vxe-sort--asc-btn",n||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===a}],title:_conf.default.i18n("vxe.table.sortAsc"),onClick:function(e){e.stopPropagation(),l.triggerSortEvent(e,r,"asc")}}),(0,_vue.h)("i",{class:["vxe-sort--desc-btn",e||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===a}],title:_conf.default.i18n("vxe.table.sortDesc"),onClick:function(e){e.stopPropagation(),l.triggerSortEvent(e,r,"desc")}})])]:[]},renderFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderFilterIcon(e))},renderFilterIcon:function(l){var r=l.$table,e=l.column,t=l.hasFilter,n=r.reactData.filterStore,a=r.getComputeMaps().computeFilterOpts.value,o=a.showIcon,i=a.iconNone,a=a.iconMatch;return o?[(0,_vue.h)("span",{class:["vxe-cell--filter",{"is--active":n.visible&&n.column===e}]},[(0,_vue.h)("i",{class:["vxe-filter--btn",t?a||_conf.default.icon.TABLE_FILTER_MATCH:i||_conf.default.icon.TABLE_FILTER_NONE],title:_conf.default.i18n("vxe.table.filter"),onClick:function(e){r.triggerFilterEvent&&r.triggerFilterEvent(e,l.column,l)}})])]:[]},renderEditHeader:function(e){var l=e.$table,r=e.column,t=l.props,l=l.getComputeMaps().computeEditOpts,n=t.editConfig,t=t.editRules,l=l.value,a=r.sortable,o=r.filters,i=r.editRender,d=!1;return t&&(t=_xeUtils.default.get(t,r.field))&&(d=t.some(function(e){return e.required})),((0,_utils.isEnableConf)(n)?[d&&l.showAsterisk?(0,_vue.h)("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(i)&&l.showIcon?(0,_vue.h)("i",{class:["vxe-cell--edit-icon",l.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e)).concat(a?Cell.renderSortIcon(e):[]).concat(o?Cell.renderFilterIcon(e):[])},renderRowEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row)},renderTreeRowEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderRowEdit(e))},renderCellEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row&&l.column===e.column)},renderTreeCellEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderCellEdit(e))},runRenderer:function(e,l){var r=e.$table,t=e.column,n=t.slots,a=t.editRender,t=t.formatter,o=n?n.default:null,n=n?n.edit:null,i=_vXETable.VXETable.renderer.get(a.name);return l?n?r.callSlot(n,e):i&&i.renderEdit?(0,_vn.getSlotVNs)(i.renderEdit(a,Object.assign({$type:"edit"},e))):[]:o?r.callSlot(o,e):t?[(0,_vue.h)("span",{class:"vxe-cell--label"},getDefaultCellLabel(e))]:Cell.renderDefaultCell(e)}},_default=exports.Cell=Cell;exports.default=_default;