"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("./util"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var a in l=arguments[t])Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);return e}).apply(this,arguments)},__spreadArray=function(e,l,t){if(t||2===arguments.length)for(var o,a=0,r=l.length;a<r;a++)!o&&a in l||((o=o||Array.prototype.slice.call(l,0,a))[a]=l[a]);return e.concat(o||Array.prototype.slice.call(l))},renderType="body",lineOffsetSizes={mini:3,small:2,medium:1},_default=(0,_vue.defineComponent)({name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(m){function c(){if(l){var e=l.value;if(e)return lineOffsetSizes[e]||0}return 0}function u(e,l){var t=1;if(e){var o=d.value,a=e[o.children||o.childrenField];if(a&&ne.isTreeExpandByRow(e))for(var r=0;r<a.length;r++)t+=u(a[r],l)}return t}function re(e){var l=e.row,t=e.column,o=ie.treeConfig,a=d.value,r=t.slots,t=t.treeNode,l=ce.fullAllDataRowIdData[(0,_util.getRowid)(ne,l)],n=0,i=0,s=[];return l&&(n=l.level,i=l._index,s=l.items),r&&r.line?ne.callSlot(r.line,e):o&&t&&(a.showLine||a.line)?[(0,_vue.h)("div",{class:"vxe-tree--line-wrapper"},[(0,_vue.h)("div",{class:"vxe-tree--line",style:{height:"".concat((l=e,r=s,o=1,(t=i)&&(o=u(r[t-1],l)),se.rowHeight*o-(t?1:12-c())),"px"),left:"".concat(n*a.indent+(n?2-c():0)+16,"px")}})])]:[]}function _(e,l,t,o){(t||o)&&(t&&((0,_util.removeScrollListener)(t),t.scrollTop=l),o&&((0,_util.removeScrollListener)(o),o.scrollTop=l),clearTimeout(a),a=setTimeout(function(){(0,_util.restoreScrollListener)(t),(0,_util.restoreScrollListener)(o),se.lastScrollTime=Date.now()},300))}function o(e){var l=m.fixedType,t=ie.highlightHoverRow,o=se.scrollXLoad,a=se.scrollYLoad,r=ce.elemStore,n=ce.lastScrollTop,i=ce.lastScrollLeft,s=ve.value,c=U.value,u=w.value,d=A.value,p=b.value,v=T.value,f=B.value,h=S.value,c=c?c.$el:null,d=d?d.$el:null,u=u.$el,p=p?p.$el:null,v=v?v.$el:null,x=(x=r["main-body-ySpace"])?x.value:null,r=(r=r["main-body-xSpace"])?r.value:null,x=(a&&x?x:u).clientHeight,r=(o&&r?r:u).clientWidth,h=h.scrollTop,g=u.scrollLeft,i=g!==i,n=h!==n;ce.lastScrollTop=h,ce.lastScrollLeft=g,se.lastScrollTime=Date.now(),(s.isHover||t)&&ne.clearHoverRow(),p&&"left"===l?(h=p.scrollTop,_(0,h,u,v)):v&&"right"===l?(h=v.scrollTop,_(0,h,u,p)):(i&&(c&&(c.scrollLeft=u.scrollLeft),d)&&(d.scrollLeft=u.scrollLeft),(p||v)&&(ne.checkScrolling(),n)&&_(0,h,p,v)),o&&i&&ne.triggerScrollXEvent(e),a&&n&&ne.triggerScrollYEvent(e),i&&f&&f.reactData.visible&&f.updatePlacement(),ne.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:h,scrollLeft:g,scrollHeight:u.scrollHeight,scrollWidth:u.scrollWidth,bodyHeight:x,bodyWidth:r,isX:i,isY:n},e)}function k(e){var l=e.deltaY,t=e.deltaX,o=ie.highlightHoverRow,a=se.scrollYLoad,r=ce.lastScrollTop,n=ce.lastScrollLeft,i=ve.value,s=w.value,c=S.value,s=s.$el,u=l<0;(u?c.scrollTop<=0:c.scrollTop>=c.scrollHeight-c.clientHeight)||(c=c.scrollTop+l,t=(s=s.scrollLeft+t)!==n,(n=c!==r)&&(e.preventDefault(),ce.lastScrollTop=c,ce.lastScrollLeft=s,se.lastScrollTime=Date.now(),(i.isHover||o)&&ne.clearHoverRow(),p(e,u,l,t,n),a)&&ne.triggerScrollYEvent(e))}var a,g,ne=(0,_vue.inject)("$xetable",{}),l=(0,_vue.inject)("xesize",null),y=ne.xID,ie=ne.props,q=ne.context,se=ne.reactData,ce=ne.internalData,e=ne.getRefMaps(),U=e.refTableHeader,w=e.refTableBody,A=e.refTableFooter,b=e.refTableLeftBody,T=e.refTableRightBody,B=e.refValidTooltip,e=ne.getComputeMaps(),ue=e.computeEditOpts,Y=e.computeMouseOpts,de=e.computeSYOpts,W=e.computeEmptyOpts,N=e.computeKeyboardOpts,he=e.computeTooltipOpts,t=e.computeRadioOpts,F=e.computeExpandOpts,d=e.computeTreeOpts,pe=e.computeCheckboxOpts,xe=e.computeValidOpts,ve=e.computeRowOpts,ge=e.computeColumnOpts,S=(0,_vue.ref)(),C=(0,_vue.ref)(),L=(0,_vue.ref)(),E=(0,_vue.ref)(),R=(0,_vue.ref)(),H=(0,_vue.ref)(),O=(0,_vue.ref)(),fe=function(){var e=ie.delayHover,l=se.lastScrollTime;return!!(se._isResize||l&&Date.now()<l+e)},V=function(e,l,t,q,o,a,r,n,i,s,U,A){var c,B=ie.columnKey,u=ie.height,d=ie.showOverflow,X=ie.cellClassName,p=ie.cellStyle,v=ie.align,f=ie.spanMethod,Y=ie.mouseConfig,h=ie.editConfig,x=ie.editRules,W=ie.tooltipConfig,N=se.tableData,g=se.overflowX,F=se.scrollYLoad,V=se.currentColumn,m=se.mergeList,_=se.editStore,j=se.isAllOverflow,P=se.validErrorMaps,K=ce.afterFullData,y=xe.value,z=pe.value,w=ue.value,G=he.value,b=ve.value,T=de.value,J=ge.value,Q=i.type,Z=i.cellRender,S=i.editRender,C=i.align,L=i.showOverflow,ee=i.className,le=i.treeNode,_=_.actived,T=T.rHeight,b=b.height,E=S||Z,E=E?_vXETable.VXETable.renderer.get(E.name):null,te=E?E.cellClassName:"",E=E?E.cellStyle:"",R=G.showAll,G=ne.getColumnIndex(i),oe=ne.getVTColumnIndex(i),ae=(0,_utils.isEnableConf)(S),g=t?i.fixed!==t:i.fixed&&g,L=_xeUtils.default.isUndefined(L)||_xeUtils.default.isNull(L)?d:L,H="ellipsis"===L,O="title"===L,M=!0===L||"tooltip"===L,L=O||M||H,D={},C=C||v,v=P["".concat(l,":").concat(i.id)],P=x&&y.showMessage&&("default"===y.message?u||1<N.length:"inline"===y.message),x={colid:i.id},I={$table:ne,$grid:ne.xegrid,seq:e,rowid:l,row:o,rowIndex:a,$rowIndex:r,_rowIndex:n,column:i,columnIndex:G,$columnIndex:s,_columnIndex:oe,fixed:t,type:renderType,isHidden:g,level:q,visibleData:K,data:N,items:A};if(F&&!L&&(H=L=!0),(O||M||R||W)&&(D.onMouseenter=function(e){fe()||(O?(0,_dom.updateCellTitle)(e.currentTarget,i):(M||R)&&ne.triggerBodyTooltipEvent(e,I),ne.dispatchEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},I),e))}),(M||R||W)&&(D.onMouseleave=function(e){fe()||((M||R)&&ne.handleTargetLeaveEvent(e),ne.dispatchEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},I),e))}),(z.range||Y)&&(D.onMousedown=function(e){ne.triggerCellMousedownEvent(e,I)}),D.onClick=function(e){ne.triggerCellClickEvent(e,I)},D.onDblclick=function(e){ne.triggerCellDblclickEvent(e,I)},m.length){u=(0,_util.mergeBodyMethod)(m,n,oe);if(u){var $=u.rowspan,k=u.colspan;if(!$||!k)return null;1<$&&(x.rowspan=$),1<k&&(x.colspan=k)}}else if(f){y=f(I)||{},e=y.rowspan,$=void 0===e?1:e,l=y.colspan,k=void 0===l?1:l;if(!$||!k)return null;1<$&&(x.rowspan=$),1<k&&(x.colspan=k)}!(g=g&&m&&(1<x.colspan||1<x.rowspan)?!1:g)&&h&&(S||Z)&&(w.showStatus||w.showUpdateStatus)&&(c=ne.isUpdateByRow(o,i.field));a=[];return g&&d&&j?a.push((0,_vue.h)("div",{class:["vxe-cell",{"c--title":O,"c--tooltip":M,"c--ellipsis":H}],style:{maxHeight:L&&(T||b)?"".concat(T||b,"px"):""}})):(a.push.apply(a,__spreadArray(__spreadArray([],re(I),!1),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":O,"c--tooltip":M,"c--ellipsis":H}],style:{maxHeight:L&&(T||b)?"".concat(T||b,"px"):""},title:O?ne.getCellLabel(o,i):null},i.renderCell(I))],!1)),P&&v&&a.push((0,_vue.h)("div",{class:"vxe-cell--valid",style:v.rule&&v.rule.maxWidth?{width:"".concat(v.rule.maxWidth,"px")}:null},[(0,_vue.h)("span",{class:"vxe-cell--valid-msg"},v.content)]))),(0,_vue.h)("td",__assign(__assign(__assign({class:["vxe-body--column",i.id,((r={})["col--".concat(C)]=C,r["col--".concat(Q)]=Q,r["col--last"]=s===U.length-1,r["col--tree-node"]=le,r["col--edit"]=ae,r["col--ellipsis"]=L,r["fixed--hidden"]=g,r["col--dirty"]=c,r["col--actived"]=h&&ae&&_.row===o&&(_.column===i||"row"===w.mode),r["col--valid-error"]=!!v,r["col--current"]=V===i,r),(0,_dom.getPropClass)(te,I),(0,_dom.getPropClass)(ee,I),(0,_dom.getPropClass)(X,I)],key:B||J.useKey?i.id:s},x),{style:Object.assign({height:L&&(T||b)?"".concat(T||b,"px"):""},_xeUtils.default.isFunction(E)?E(I):E,_xeUtils.default.isFunction(p)?p(I):p)}),D),a)},X=function(f,h,x){var g=ie.stripe,m=ie.rowKey,_=ie.highlightHoverRow,y=ie.rowClassName,w=ie.rowStyle,b=ie.showOverflow,T=ie.editConfig,S=ie.treeConfig,C=se.hasFixedColumn,L=se.treeExpandedMaps,E=se.scrollYLoad,R=se.rowExpandedMaps,H=se.expandColumn,O=se.selectRadioRow,M=ce.fullAllDataRowIdData,D=pe.value,I=t.value,$=d.value,k=ue.value,q=ve.value,U=$.transform,A=$.children||$.childrenField,B=[];return h.forEach(function(t,o){var e,l={},a=ne.getRowIndex(t),r=((q.isHover||_)&&(l.onMouseenter=function(e){fe()||ne.triggerHoverEvent(e,{row:t,rowIndex:a})},l.onMouseleave=function(){fe()||ne.clearHoverRow()}),(0,_util.getRowid)(ne,t)),n=M[r],i=0,s=-1,c=0,n=(n&&(i=n.level,s=n.seq,c=n._index),{$table:ne,seq:s,rowid:r,fixed:f,type:renderType,level:i,row:t,rowIndex:a,$rowIndex:o,_rowIndex:c}),u=H&&!!R[r],d=!1,p=[],v=!1;T&&(v=ne.isInsertByRow(t)),!S||E||U||(d=(p=t[A])&&p.length&&!!L[r]),B.push((0,_vue.h)("tr",__assign({class:["vxe-body--row",S?"row--level-".concat(i):"",{"row--stripe":g&&(ne.getVTRowIndex(t)+1)%2==0,"is--new":v,"is--expand-row":u,"is--expand-tree":d,"row--new":v&&(k.showStatus||k.showInsertStatus),"row--radio":I.highlight&&ne.eqRow(O,t),"row--checked":D.highlight&&ne.isCheckedByCheckboxRow(t)},(0,_dom.getPropClass)(y,n)],rowid:r,style:w?_xeUtils.default.isFunction(w)?w(n):w:null,key:m||q.useKey||S?r:o},l),x.map(function(e,l){return V(s,r,f,i,t,a,o,c,e,l,x,h)}))),u&&(v={},(n=F.value.height)&&(v.height="".concat(n,"px")),S&&(v.paddingLeft="".concat(i*$.indent+30,"px")),u=H.showOverflow,u=_xeUtils.default.isUndefined(u)||_xeUtils.default.isNull(u)?b:u,e={$table:ne,seq:s,column:H,fixed:f,type:renderType,level:i,row:t,rowIndex:a,$rowIndex:o,_rowIndex:c},B.push((0,_vue.h)("tr",__assign({class:"vxe-body--expanded-row",key:"expand_".concat(r),style:w?_xeUtils.default.isFunction(w)?w(e):w:null},l),[(0,_vue.h)("td",{class:{"vxe-body--expanded-column":1,"fixed--hidden":f&&!C,"col--ellipsis":u},colspan:x.length},[(0,_vue.h)("div",{class:{"vxe-body--expanded-cell":1,"is--ellipsis":n},style:v},[H.renderData(e)])])]))),d&&B.push.apply(B,X(f,p,x))}),B},M=0,D=0,I=0,$=!1,p=function(a,r,e,n,i){function s(){var e,l,t,o;I<M&&(e=m.fixedType,D=Math.max(5,Math.floor(1.5*D)),M<(I+=D)&&(D-=I-M),o=f.scrollTop,l=f.clientHeight,t=f.scrollHeight,o=o+D*(r?-1:1),f.scrollTop=o,p&&(p.scrollTop=o),v&&(v.scrollTop=o),(r?o<t-l:0<=o)&&(g=setTimeout(s,10)),ne.dispatchEvent("scroll",{type:renderType,fixed:e,scrollTop:f.scrollTop,scrollLeft:f.scrollLeft,scrollHeight:f.scrollHeight,scrollWidth:f.scrollWidth,bodyHeight:h,bodyWidth:x,isX:n,isY:i},a))}var l=ce.elemStore,t=se.scrollXLoad,o=se.scrollYLoad,c=w.value,u=b.value,d=T.value,p=u?u.$el:null,v=d?d.$el:null,f=c.$el,u=l["main-body-ySpace"],d=u?u.value:null,c=l["main-body-xSpace"],u=c?c.value:null,h=(o&&d?d:f).clientHeight,x=(t&&u?u:f).clientWidth,l=$===r?Math.max(0,M-I):0;$=r,M=Math.abs(r?e-l:e+l),I=D=0,clearTimeout(g);s()};(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=m.fixedType,l=ce.elemStore,e="".concat(e||"main","-body-"),t=S.value;l["".concat(e,"wrapper")]=S,l["".concat(e,"table")]=C,l["".concat(e,"colgroup")]=L,l["".concat(e,"list")]=E,l["".concat(e,"xSpace")]=R,l["".concat(e,"ySpace")]=H,l["".concat(e,"emptyBlock")]=O,t.onscroll=o,t._onscroll=o})}),(0,_vue.onBeforeUnmount)(function(){var e=S.value;clearTimeout(g),e&&(e._onscroll=null,e.onscroll=null)}),(0,_vue.onUnmounted)(function(){var e=m.fixedType,l=ce.elemStore,e="".concat(e||"main","-body-");l["".concat(e,"wrapper")]=null,l["".concat(e,"table")]=null,l["".concat(e,"colgroup")]=null,l["".concat(e,"list")]=null,l["".concat(e,"xSpace")]=null,l["".concat(e,"ySpace")]=null,l["".concat(e,"emptyBlock")]=null});return function(){var e=m.fixedColumn,l=m.fixedType,t=m.tableColumn,o=ie.keyboardConfig,a=ie.showOverflow,r=ie.spanMethod,n=ie.mouseConfig,i=se.tableData,s=se.mergeList,c=se.scrollYLoad,u=se.isAllOverflow,d=ce.visibleColumn,p=q.slots,v=de.value,f=W.value,h=N.value,x=Y.value;return l&&(t=se.expandColumn||!(c||a&&u)||s.length||r||o&&h.isMerge?d:e),u=p.empty?ne.callSlot(p.empty,{$table:ne,$grid:ne.xegrid}):(a=(c=f.name?_vXETable.VXETable.renderer.get(f.name):null)?c.renderEmpty:null)?(0,_vn.getSlotVNs)(a(f,{$table:ne})):ie.emptyText||_conf.default.i18n("vxe.table.emptyText"),(0,_vue.h)("div",__assign({ref:S,class:["vxe-table--body-wrapper",l?"fixed-".concat(l,"--wrapper"):"body--wrapper"],xid:y},"wheel"===v.mode?{onWheel:k}:{}),[l?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:R,class:"vxe-body--x-space"}),(0,_vue.h)("div",{ref:H,class:"vxe-body--y-space"}),(0,_vue.h)("table",{ref:C,class:"vxe-table--body",xid:y,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:L},t.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})})),(0,_vue.h)("tbody",{ref:E},X(l,i,t))]),(0,_vue.h)("div",{class:"vxe-table--checkbox-range"}),n&&x.area?(0,_vue.h)("div",{class:"vxe-table--cell-area"},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"},x.extension?[(0,_vue.h)("span",{class:"vxe-table--cell-main-area-btn",onMousedown:function(e){ne.triggerCellExtendMousedownEvent(e,{$table:ne,fixed:l,type:renderType})}})]:[]),(0,_vue.h)("span",{class:"vxe-table--cell-copy-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"})]):null,l?null:(0,_vue.h)("div",{class:"vxe-table--empty-block",ref:O},[(0,_vue.h)("div",{class:"vxe-table--empty-content"},u)])])}}});exports.default=_default;