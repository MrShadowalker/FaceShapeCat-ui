"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event"),_date=require("./date"),_number=require("./number");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __spreadArray=function(e,t,a){if(a||2===arguments.length)for(var n,u=0,l=t.length;u<l;u++)!n&&u in t||((n=n||Array.prototype.slice.call(t,0,u))[u]=t[u]);return e.concat(n||Array.prototype.slice.call(t))},yearSize=12,monthSize=20,quarterSize=8,_default=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:{type:String,default:function(){return _xeUtils.default.eqNull(_conf.default.input.placeholder)?_conf.default.i18n("vxe.base.pleaseInput"):_conf.default.input.placeholder}},maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:function(){return _conf.default.input.size||_conf.default.size}},multiple:Boolean,showWordCount:Boolean,countMethod:Function,min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:function(){return _conf.default.input.exponential}},controls:{type:Boolean,default:function(){return _conf.default.input.controls}},digits:{type:[String,Number],default:function(){return _conf.default.input.digits}},startDate:{type:[String,Number,Date],default:function(){return _conf.default.input.startDate}},endDate:{type:[String,Number,Date],default:function(){return _conf.default.input.endDate}},minDate:[String,Number,Date],maxDate:[String,Number,Date],startWeek:Number,startDay:{type:[String,Number],default:function(){return _conf.default.input.startDay}},labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:function(){return _conf.default.input.festivalMethod}},disabledMethod:{type:Function,default:function(){return _conf.default.input.disabledMethod}},selectDay:{type:[String,Number],default:function(){return _conf.default.input.selectDay}},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup:function(W,e){function H(e){var t=e.target.value;nt(t,e)}function L(e){Xe.value||s(e)}function j(e){K.isActivated=!0,I.value&&E(e),s(e)}function S(e,t){var a=W.type,n=F.value;I.value&&b(),(n||-1<["text","search","password"].indexOf(a))&&focus(),r.dispatchEvent("clear",{value:t},e)}function y(){var e=I.value,t=K.inputValue;e&&(p(t),K.inputValue=W.multiple?Ne.value:K.datePanelLabel)}function t(){var e=W.type,t=K.inputValue,a=I.value,n=ge.value;a?y():"float"===e&&t&&t!==(a=(0,_number.toFloatValueFixed)(t,n))&&f(a,{type:"init"})}function B(e){var t=K.inputValue;Xe.value||f(t,e),U(),K.visiblePanel||(K.isActivated=!1),r.dispatchEvent("blur",{value:t},e)}function D(e){var t=W.readonly,a=W.disabled,n=K.showPwd;a||t||(K.showPwd=!n),r.dispatchEvent("toggle-visible",{visible:K.showPwd},e)}function P(e){r.dispatchEvent("search-click",{},e)}function N(e,t){var a=W.min,n=W.max,u=W.type,l=K.inputValue,i=be.value,u="integer"===u?_xeUtils.default.toInteger((0,_number.handleNumber)(l)):_xeUtils.default.toNumber((0,_number.handleNumber)(l)),l=e?_xeUtils.default.add(u,i):_xeUtils.default.subtract(u,i),e=rt(l)?it(l)?l:n:a;nt(at(e),t)}function V(e){u=window.setTimeout(function(){h(e),V(e)},60)}function G(e){var t,a,n,u,l=W.exponential,i=W.controls;F.value&&(t=e.ctrlKey,a=e.shiftKey,n=e.altKey,u=e.keyCode,t||a||n||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!l||69!==u)&&65<=u&&u<=90||186<=u&&u<=188||191<=u)||e.preventDefault(),i)&&ot(e),s(e)}function Q(e){s(e)}function a(){clearTimeout(u)}function w(e){u=window.setTimeout(function(){x(e),w(e)},60)}function $(e){var t;a(),0===e.button&&(((t=(0,_dom.hasClass)(e.currentTarget,"is--prev"))?x:h)(e),u=window.setTimeout(function(){(t?w:V)(e)},500))}function Z(e){var t;F.value&&W.controls&&K.isActivated&&(0<(t=e.deltaY)?h(e):t<0&&x(e),e.preventDefault()),s(e)}function X(){var e="month"===(e=K.datePanelType)||"quarter"===e?"year":"month";K.datePanelType=e}function J(e){dt(),W.multiple||(m(K.currentDate),b()),r.dispatchEvent("date-today",{type:W.type},e)}function Y(e){var t=W.disabledMethod,a=K.datePanelType;return t&&t({type:a,viewType:a,date:e.date,$input:i})}function ee(e){var t=W.type,a=W.multiple,n=K.datePanelType;"month"===t?"year"===n?(K.datePanelType="month",_(e)):(m(e),a||b()):"year"===t?(m(e),a||b()):"quarter"===t?"year"===n?(K.datePanelType="quarter",_(e)):(m(e),a||b()):"month"===n?(K.datePanelType="week"===t?t:"day",_(e)):"year"===n?(K.datePanelType="month",_(e)):(m(e),a||b())}function A(e){Y(e)||ee(e.date)}function C(e){var t;Y(e)||("month"===(t=K.datePanelType)?ht:"quarter"===t?mt:"year"===t?_t:pt)(e.date)}function l(e){K.datetimePanelValue=new Date(K.datetimePanelValue.getTime()),xt(e.currentTarget)}function te(){var t,a,e=W.multiple,n=K.datetimePanelValue,u=z.value,l=c.value;l&&(t=d.value,e?(e=Pe.value,l?(l=__spreadArray([],O.value,!0),a=[],l.forEach(function(e){e&&(e.setHours(n.getHours()),e.setMinutes(n.getMinutes()),e.setSeconds(n.getSeconds()),a.push(e))}),f(a.map(function(e){return _xeUtils.default.toDateString(e,t)}).join(","),{type:"update"})):f(e.join(","),{type:"update"})):m(u||K.currentDate)),b()}function n(){return(0,_vue.nextTick)().then(function(){var e,t,a,n,u,l,i,r=W.transfer,s=W.placement,o=K.panelIndex,c=T.value,d=M.value;if(c&&d)return e=c.offsetHeight,t=c.offsetWidth,a=d.offsetHeight,d=d.offsetWidth,o={zIndex:o},n=(c=(0,_dom.getAbsolutePos)(c)).boundingTop,i=c.boundingLeft,u=c.visibleHeight,c=c.visibleWidth,l="bottom",r?(r=n+e,"top"===s?(l="top",r=n-a):s||(u<r+a+5&&(l="top",r=n-a),r<5&&(l="bottom",r=n+e)),c<(i=i)+d+5&&(i-=i+d+5-c),i<5&&(i=5),Object.assign(o,{left:"".concat(i,"px"),top:"".concat(r,"px"),minWidth:"".concat(t,"px")})):"top"===s?(l="top",o.bottom="".concat(e,"px")):s||u<n+e+a&&5<n-e-a&&(l="top",o.bottom="".concat(e,"px")),K.panelStyle=o,K.panelPlacement=l,(0,_vue.nextTick)()})}function ae(e){s(e)}function ne(e){var t=W.disabled,a=K.visiblePanel,n=K.isActivated,u=I.value,l=k.value,i=M.value;!t&&n&&(K.isActivated=(0,_dom.getEventTargetNode)(e,l).flag||(0,_dom.getEventTargetNode)(e,i).flag,K.isActivated||(u?a&&(b(),U()):U()))}function ue(e){var t,a,n,u,l,i,r,s,o,c,d,v,f,p,_,m=W.clearable,h=W.disabled,x=K.visiblePanel,y=I.value;h||(h=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.TAB),t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.DELETE),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE),n=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER),o=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),u=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),s=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN),i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_DOWN),o=o||u||s||l,s=K.isActivated,h?(s&&U(),K.isActivated=s=!1):o?y&&s&&(x?(o=e,f=K.isActivated,p=K.datePanelValue,_=K.datePanelType,f&&(o.preventDefault(),f=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_LEFT),c=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_UP),d=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_RIGHT),o=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_DOWN),"year"===_?(v=_xeUtils.default.getWhatYear(p||Date.now(),0,"first"),f?v=_xeUtils.default.getWhatYear(v,-1):c?v=_xeUtils.default.getWhatYear(v,-4):d?v=_xeUtils.default.getWhatYear(v,1):o&&(v=_xeUtils.default.getWhatYear(v,4)),_t(v)):"quarter"===_?(v=_xeUtils.default.getWhatQuarter(p||Date.now(),0,"first"),f?v=_xeUtils.default.getWhatQuarter(v,-1):c?v=_xeUtils.default.getWhatQuarter(v,-2):d?v=_xeUtils.default.getWhatQuarter(v,1):o&&(v=_xeUtils.default.getWhatQuarter(v,2)),mt(v)):"month"===_?(v=_xeUtils.default.getWhatMonth(p||Date.now(),0,"first"),f?v=_xeUtils.default.getWhatMonth(v,-1):c?v=_xeUtils.default.getWhatMonth(v,-4):d?v=_xeUtils.default.getWhatMonth(v,1):o&&(v=_xeUtils.default.getWhatMonth(v,4)),ht(v)):(_=p||_xeUtils.default.getWhatDay(Date.now(),0,"first"),v=g.value,f?_=_xeUtils.default.getWhatDay(_,-1):c?_=_xeUtils.default.getWhatWeek(_,-1,v):d?_=_xeUtils.default.getWhatDay(_,1):o&&(_=_xeUtils.default.getWhatWeek(_,1,v)),pt(_)))):(u||l)&&E(e)):n?y&&(x?K.datePanelValue?ee(K.datePanelValue):b():s&&E(e)):(i||r)&&y&&s&&(p=e,K.isActivated)&&(f=(0,_event.hasEventKey)(p,_event.EVENT_KEYS.PAGE_UP),p.preventDefault(),(f?vt:ft)(p)),h||a?x&&b():t&&m&&s&&S(e,null))}function le(e){var t=W.disabled,a=K.visiblePanel;t||a&&(t=M.value,((0,_dom.getEventTargetNode)(e,t).flag?n:(b(),U))())}function ie(){var e=K.isActivated;K.visiblePanel?(b(),U()):e&&U()}function q(e,t){var a,n=W.festivalMethod;return n?(n=(e=(n=n({type:n=K.datePanelType,viewType:n,date:e.date,$input:i}))?_xeUtils.default.isString(n)?{label:n}:n:{}).extra?_xeUtils.default.isString(e.extra)?{label:e.extra}:e.extra:null,n=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":e.notice}]},n&&n.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",n.important?"is-important":"",n.className],style:n.style},_xeUtils.default.toValueString(n.label))]:t)],(a=e.label)&&(a=_xeUtils.default.toValueString(a).split(","),n.push((0,_vue.h)("span",{class:["vxe-input--date-festival",e.important?"is-important":"",e.className],style:e.style},[1<a.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--".concat(a.length)]},a.map(function(e){return(0,_vue.h)("span",e.substring(0,3))})):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},a[0].substring(0,3))]))),n):t}function re(){var a,n,u,e,l,i,r,s,o,t,c,d,v,f,p,_,m,h,x,y,g,b,U,E,S,D,P,N,V,w,k,T,M;switch(K.datePanelType){case"week":return h=W.multiple,x=K.datePanelType,y=K.datePanelValue,g=z.value,b=Ce.value,U=He.value,E=O.value,S="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(x,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",b.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",U.map(function(e){var t=h?e.some(function(t){return E.some(function(e){return _xeUtils.default.isDateSame(e,t.date,S)})}):e.some(function(e){return _xeUtils.default.isDateSame(g,e.date,S)}),a=e.some(function(e){return _xeUtils.default.isDateSame(y,e.date,S)});return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Y(e),"is--selected":t,"is--hover":a},onClick:function(){return A(e)},onMouseenter:function(){return C(e)}},q(e,e.label))}))}))])];case"month":return v=W.multiple,x=K.datePanelType,f=K.datePanelValue,p=z.value,b=Re.value,_=O.value,m="yyyyMM",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(x,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",b.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":v?_.some(function(e){return _xeUtils.default.isDateSame(e,t.date,m)}):_xeUtils.default.isDateSame(p,t.date,m),"is--hover":_xeUtils.default.isDateSame(f,t.date,m)},onClick:function(){return A(t)},onMouseenter:function(){return C(t)}},q(t,_conf.default.i18n("vxe.input.date.months.m".concat(t.month))))}))}))])];case"quarter":return r=W.multiple,U=K.datePanelType,s=K.datePanelValue,o=z.value,t=Fe.value,c=O.value,d="yyyyq",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(U,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":r?c.some(function(e){return _xeUtils.default.isDateSame(e,t.date,d)}):_xeUtils.default.isDateSame(o,t.date,d),"is--hover":_xeUtils.default.isDateSame(s,t.date,d)},onClick:function(){return A(t)},onMouseenter:function(){return C(t)}},q(t,_conf.default.i18n("vxe.input.date.quarters.q".concat(t.quarter))))}))}))])];case"year":return a=W.multiple,t=K.datePanelType,n=K.datePanelValue,u=z.value,e=qe.value,l=O.value,i="yyyy",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(t,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",e.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":a?l.some(function(e){return _xeUtils.default.isDateSame(e,t.date,i)}):_xeUtils.default.isDateSame(u,t.date,i),"is--hover":_xeUtils.default.isDateSame(n,t.date,i)},onClick:function(){return A(t)},onMouseenter:function(){return C(t)}},q(t,t.year))}))}))])]}return D=W.multiple,P=K.datePanelType,N=K.datePanelValue,V=z.value,w=Ae.value,k=ze.value,T=O.value,M="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(P,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",w.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",k.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":D?T.some(function(e){return _xeUtils.default.isDateSame(e,t.date,M)}):_xeUtils.default.isDateSame(V,t.date,M),"is--hover":_xeUtils.default.isDateSame(N,t.date,M)},onClick:function(){return A(t)},onMouseenter:function(){return C(t)}},q(t,t.label))}))}))])]}var se,u,oe=e.slots,ce=e.emit,de=(0,_vue.inject)("$xeform",null),ve=(0,_vue.inject)("$xeformiteminfo",null),fe=_xeUtils.default.uniqueId(),pe=(0,_size.useSize)(W),K=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),k=(0,_vue.ref)(),T=(0,_vue.ref)(),M=(0,_vue.ref)(),_e=(0,_vue.ref)(),me={refElem:k,refInput:T},i={xID:fe,props:W,context:e,reactData:K,getRefMaps:function(){return me}},r={},o=function(e,t){return"time"===W.type?(0,_date.toStringTimeDate)(e):_xeUtils.default.toStringDate(e,t)},c=(0,_vue.computed)(function(){var e=W.type;return"time"===e||"datetime"===e}),F=(0,_vue.computed)(function(){return-1<["number","integer","float"].indexOf(W.type)}),he=(0,_vue.computed)(function(){return _xeUtils.default.getSize(K.inputValue)}),xe=(0,_vue.computed)(function(){var e=he.value;return W.maxlength&&e>_xeUtils.default.toNumber(W.maxlength)}),I=(0,_vue.computed)(function(){return c.value||-1<["date","week","month","quarter","year"].indexOf(W.type)}),R=(0,_vue.computed)(function(){return"password"===W.type}),ye=(0,_vue.computed)(function(){return"search"===W.type}),ge=(0,_vue.computed)(function(){return _xeUtils.default.toInteger(W.digits)||1}),be=(0,_vue.computed)(function(){var e=W.type,t=ge.value,a=W.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),Ue=(0,_vue.computed)(function(){var e=W.type,t=F.value,a=I.value,n=R.value;return W.clearable&&(n||t||a||"text"===e||"search"===e)}),Ee=(0,_vue.computed)(function(){return W.startDate?_xeUtils.default.toStringDate(W.startDate):null}),Se=(0,_vue.computed)(function(){return W.endDate?_xeUtils.default.toStringDate(W.endDate):null}),De=(0,_vue.computed)(function(){return["date","week","month","quarter","year"].includes(W.type)}),O=(0,_vue.computed)(function(){var e=W.modelValue,t=W.multiple,a=I.value,n=d.value;return t&&e&&a?_xeUtils.default.toValueString(e).split(",").map(function(e){e=o(e,n);return _xeUtils.default.isValidDate(e)?e:null}):[]}),Pe=(0,_vue.computed)(function(){var e=O.value,t=d.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)})}),Ne=(0,_vue.computed)(function(){var e=O.value,t=v.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)}).join(", ")}),d=(0,_vue.computed)(function(){var e=W.type;return"time"===e?"HH:mm:ss":W.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),z=(0,_vue.computed)(function(){var e=W.modelValue,t=I.value,a=d.value,n=null;return n=e&&t&&(t=o(e,a),_xeUtils.default.isValidDate(t))?t:n}),Ve=(0,_vue.computed)(function(){var e=Ee.value,t=K.selectMonth;return!(!t||!e)&&t<=e}),we=(0,_vue.computed)(function(){var e=Se.value,t=K.selectMonth;return!(!t||!e)&&e<=t}),ke=(0,_vue.computed)(function(){var e=K.datetimePanelValue;return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),Te=(0,_vue.computed)(function(){var e=z.value,t=c.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),v=(0,_vue.computed)(function(){return I.value?W.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat.".concat(W.type)):null}),Me=(0,_vue.computed)(function(){var e=K.selectMonth,t=K.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),t=e.getFullYear(),u=new Date(t-t%yearSize,0,1),l=-4;l<yearSize+4;l++){var i=_xeUtils.default.getWhatYear(u,l,"first"),r=i.getFullYear();a.push({date:i,isCurrent:!0,isPrev:l<0,isNow:n===r,isNext:yearSize<=l,year:r})}return a}),We=(0,_vue.computed)(function(){var e,t,a,n,u;return I.value?(e=K.datePanelType,t=K.selectMonth,a=Me.value,n="",u=void 0,t&&(n=t.getFullYear(),u=t.getMonth()+1),"quarter"===e?_conf.default.i18n("vxe.input.date.quarterLabel",[n]):"month"===e?_conf.default.i18n("vxe.input.date.monthLabel",[n]):"year"===e?a.length?"".concat(a[0].year," - ").concat(a[a.length-1].year):"":_conf.default.i18n("vxe.input.date.dayLabel",[n,u?_conf.default.i18n("vxe.input.date.m".concat(u)):"-"])):""}),g=(0,_vue.computed)(function(){var e=W.startDay,t=W.startWeek;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),Ye=(0,_vue.computed)(function(){var e=[];if(I.value){var t=g.value;e.push(t);for(var a=0;a<6;a++)6<=t?t=0:t++,e.push(t)}return e}),Ae=(0,_vue.computed)(function(){return I.value?Ye.value.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w".concat(e))}}):[]}),Ce=(0,_vue.computed)(function(){var e;return I.value?(e=Ae.value,[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)):[]}),qe=(0,_vue.computed)(function(){var e=Me.value;return _xeUtils.default.chunk(e,4)}),Ke=(0,_vue.computed)(function(){var e=K.selectMonth,t=K.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=(0,_date.getDateQuarter)(t),l=_xeUtils.default.getWhatYear(e,0,"first"),i=l.getFullYear(),r=-2;r<quarterSize-2;r++){var s=_xeUtils.default.getWhatQuarter(l,r),o=s.getFullYear(),c=(0,_date.getDateQuarter)(s),d=o<i;a.push({date:s,isPrev:d,isCurrent:o===i,isNow:o===n&&c===u,isNext:!d&&i<o,quarter:c})}return a}),Fe=(0,_vue.computed)(function(){var e=Ke.value;return _xeUtils.default.chunk(e,2)}),Ie=(0,_vue.computed)(function(){var e=K.selectMonth,t=K.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=t.getMonth(),l=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),i=-4;i<monthSize-4;i++){var r=_xeUtils.default.getWhatYear(e,0,i),s=r.getFullYear(),o=r.getMonth(),c=s<l;a.push({date:r,isPrev:c,isCurrent:s===l,isNow:s===n&&o===u,isNext:!c&&l<s,month:o})}return a}),Re=(0,_vue.computed)(function(){var e=Ie.value;return _xeUtils.default.chunk(e,4)}),Oe=(0,_vue.computed)(function(){var e=K.selectMonth,t=K.currentDate,a=[];if(e&&t)for(var n=Te.value,u=Ye.value,l=t.getFullYear(),i=t.getMonth(),r=t.getDate(),s=e.getFullYear(),o=e.getMonth(),t=e.getDay(),u=-u.indexOf(t),c=new Date(_xeUtils.default.getWhatDay(e,u).getTime()+n),d=0;d<42;d++){var v=_xeUtils.default.getWhatDay(c,d),f=v.getFullYear(),p=v.getMonth(),_=v.getDate(),m=v<e;a.push({date:v,isPrev:m,isCurrent:f===s&&p===o,isNow:f===l&&p===i&&_===r,isNext:!m&&o!==p,label:_})}return a}),ze=(0,_vue.computed)(function(){var e=Oe.value;return _xeUtils.default.chunk(e,7)}),He=(0,_vue.computed)(function(){var e=ze.value,a=g.value;return e.map(function(e){var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),Le=(0,_vue.computed)(function(){var e=[];if(c.value)for(var t=0;t<24;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),je=(0,_vue.computed)(function(){var e=[];if(c.value)for(var t=0;t<60;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),Be=(0,_vue.computed)(function(){return je.value}),Ge=(0,_vue.computed)(function(){var e=W.type,t=W.readonly,a=W.editable,n=W.multiple;return t||n||!a||"week"===e||"quarter"===e}),Qe=(0,_vue.computed)(function(){var e=W.type,t=K.showPwd,a=F.value,n=I.value,u=R.value;return n||a||u&&t||"number"===e?"text":e}),$e=(0,_vue.computed)(function(){var e=W.placeholder;return e?(0,_utils.getFuncText)(e):""}),Ze=(0,_vue.computed)(function(){var e=W.maxlength;return F.value&&!_xeUtils.default.toNumber(e)?16:e}),Xe=(0,_vue.computed)(function(){var e=W.type;return W.immediate||!("text"===e||"number"===e||"integer"===e||"float"===e)}),Je=(0,_vue.computed)(function(){var e=W.type,t=K.inputValue;return F.value?"integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(t)):_xeUtils.default.toNumber((0,_number.handleNumber)(t)):0}),et=(0,_vue.computed)(function(){var e=W.min,t=K.inputValue,a=F.value,n=Je.value;return!(!t&&0!==t||!a||null===e)&&n<=_xeUtils.default.toNumber(e)}),tt=(0,_vue.computed)(function(){var e=W.max,t=K.inputValue,a=F.value,n=Je.value;return!(!t&&0!==t||!a||null===e)&&n>=_xeUtils.default.toNumber(e)}),at=function(e){var t=W.type,a=W.exponential,n=Ze.value,u=ge.value,t="float"===t?(0,_number.toFloatValueFixed)(e,u):_xeUtils.default.toValueString(e);return!a||e!==t&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(t).toExponential()?t.slice(0,n):e},s=function(e){var t=K.inputValue;r.dispatchEvent(e.type,{value:t},e)},f=function(e,t){K.inputValue=e,ce("update:modelValue",e),r.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(W.modelValue)!==e&&(r.dispatchEvent("change",{value:e},t),de)&&ve&&de.triggerItemEvent(t,ve.itemConfig.field,e)},nt=function(e,t){var a=I.value,n=Xe.value;K.inputValue=e,a||(n?f(e,t):r.dispatchEvent("input",{value:e},t))},ut=function(e){var t;W.disabled||(t=K.inputValue,r.dispatchEvent("prefix-click",{value:t},e))},b=function(){return new Promise(function(e){K.visiblePanel=!1,se=window.setTimeout(function(){K.animatVisible=!1,e()},350)})},lt=function(e){var t;W.disabled||((0,_dom.hasClass)(e.currentTarget,"is--clear")?(f("",e),S(e,"")):(t=K.inputValue,r.dispatchEvent("suffix-click",{value:t},e)))},p=function(e){var t=W.type,a=W.valueFormat,n=v.value,u=g.value,l=null,i="";e&&(l=o(e,a)),_xeUtils.default.isValidDate(l)?(i=_xeUtils.default.toDateString(l,n,{firstDay:u}),n&&"week"===t&&_xeUtils.default.getWhatWeek(l,0,u,u).getFullYear()<l.getFullYear()&&-1<(e=n.indexOf("yyyy"))&&(a=Number(i.substring(e,e+4)))&&!isNaN(a)&&(i=i.replace("".concat(a),"".concat(a-1)))):l=null,K.datePanelValue=l,K.datePanelLabel=i},it=function(e){return null===W.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(W.max)},rt=function(e){return null===W.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(W.min)},st=function(){K.inputValue=W.multiple?Ne.value:K.datePanelLabel},_=function(e){e=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(e,K.selectMonth)||(K.selectMonth=e)},m=function(t){var e,a,n=W.modelValue,u=W.multiple,l=K.datetimePanelValue,i=c.value,r=d.value,s=g.value,o=("week"===W.type?(e=_xeUtils.default.toNumber(W.selectDay),t=_xeUtils.default.getWhatWeek(t,0,e,s)):i&&(t.setHours(l.getHours()),t.setMinutes(l.getMinutes()),t.setSeconds(l.getSeconds())),_xeUtils.default.toDateString(t,r,{firstDay:s}));_(t),u?(e=Pe.value,i?(s=__spreadArray([],O.value,!0),a=[],-1===(u=_xeUtils.default.findIndexOf(s,function(e){return _xeUtils.default.isDateSame(t,e,"yyyyMMdd")}))?s.push(t):s.splice(u,1),s.forEach(function(e){e&&(e.setHours(l.getHours()),e.setMinutes(l.getMinutes()),e.setSeconds(l.getSeconds()),a.push(e))}),f(a.map(function(e){return _xeUtils.default.toDateString(e,r)}).join(","),{type:"update"})):e.some(function(e){return _xeUtils.default.isEqual(e,o)})?f(e.filter(function(e){return!_xeUtils.default.isEqual(e,o)}).join(","),{type:"update"}):f(e.concat([o]).join(","),{type:"update"})):_xeUtils.default.isEqual(n,o)||f(o,{type:"update"})},U=function(){var e=W.type,t=W.min,a=W.max,n=W.exponential,u=K.inputValue,l=K.datetimePanelValue,i=F.value,r=I.value,s=v.value;Ge.value||(i?u&&(i="integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(u)):_xeUtils.default.toNumber((0,_number.handleNumber)(u)),rt(i)?it(i)||(i=a):i=t,n&&(a=_xeUtils.default.toValueString(u).toLowerCase())===_xeUtils.default.toNumber(i).toExponential()&&(i=a),f(at(i),{type:"check"})):r&&(u?(t=o(u,s),_xeUtils.default.isValidDate(t)?"time"===e?(u!==(t=_xeUtils.default.toDateString(t,s))&&f(t,{type:"check"}),K.inputValue=t):(n=!1,a=g.value,"datetime"===e?(i=z.value,u===_xeUtils.default.toDateString(i,s)&&u===_xeUtils.default.toDateString(t,s)||(n=!0,l.setHours(t.getHours()),l.setMinutes(t.getMinutes()),l.setSeconds(t.getSeconds()))):n=!0,K.inputValue=_xeUtils.default.toDateString(t,s,{firstDay:a}),n&&m(t)):st()):f("",{type:"check"})))},h=function(e){var t=W.readonly,a=W.disabled,n=et.value;clearTimeout(u),a||t||n||N(!1,e),r.dispatchEvent("next-number",{},e)},x=function(e){var t=W.readonly,a=W.disabled,n=tt.value;clearTimeout(u),a||t||n||N(!0,e),r.dispatchEvent("prev-number",{},e)},ot=function(e){var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);(t||a)&&(e.preventDefault(),(t?x:h)(e))},ct=function(e,t){K.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},dt=function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");K.currentDate=e,ct(e,0)},vt=function(e){var t=W.type,a=K.datePanelType,n=K.selectMonth;Ve.value||(K.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):_xeUtils.default.getWhatYear(n,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,-1,"first"):_xeUtils.default.getWhatMonth(n,-1,"first"),r.dispatchEvent("date-prev",{type:t},e))},ft=function(e){var t=W.type,a=K.datePanelType,n=K.selectMonth;we.value||(K.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):_xeUtils.default.getWhatYear(n,1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,1,"first"):_xeUtils.default.getWhatMonth(n,1,"first"),r.dispatchEvent("date-next",{type:t},e))},pt=function(t){Y({date:t})||(Oe.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMMdd")})||_(t),p(t))},_t=function(t){Y({date:t})||(Me.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||_(t),p(t))},mt=function(t){Y({date:t})||(Ke.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyq")})||_(t),p(t))},ht=function(t){Y({date:t})||(Ie.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMM")})||_(t),p(t))},xt=function(e){var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)},yt=function(){var e=W.disabled,t=K.visiblePanel,a=I.value;return(e||t?(0,_vue.nextTick):(K.inited||(K.inited=!0),clearTimeout(se),K.isActivated=!0,K.animatVisible=!0,a&&(e=W.type,t=c.value,a=z.value,-1<["year","quarter","month","week"].indexOf(e)?K.datePanelType=e:K.datePanelType="day",K.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(ct(a,0),p(a)):dt(),t)&&(K.datetimePanelValue=K.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(function(){var e=_e.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),xt)})),setTimeout(function(){K.visiblePanel=!0},10),K.panelIndex<(0,_utils.getLastZIndex)()&&(K.panelIndex=(0,_utils.nextZIndex)()),n))()},E=function(e){W.readonly||(e.preventDefault(),yt())},gt=function(){var e=W.multiple,t=K.datePanelType,a=Ve.value,n=we.value,u=We.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===t?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},u):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:X},u)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":a}],onClick:vt},[(0,_vue.h)("i",{class:"vxe-icon-caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:J},[(0,_vue.h)("i",{class:"vxe-icon-dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":n}],onClick:ft},[(0,_vue.h)("i",{class:"vxe-icon-caret-right"})]),e&&De.value?(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-confirm-btn"},[(0,_vue.h)("button",{class:"vxe-input--date-picker-confirm",type:"button",onClick:te},_conf.default.i18n("vxe.button.confirm"))]):null])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},re())]},bt=function(){var a=K.datetimePanelValue,e=ke.value,t=Le.value,n=je.value,u=Be.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:te},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:_e,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},t.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getHours()===t.value},onClick:function(e){return e=e,K.datetimePanelValue.setHours(t.value),void l(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},n.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getMinutes()===t.value},onClick:function(e){return e=e,K.datetimePanelValue.setMinutes(t.value),void l(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getSeconds()===t.value},onClick:function(e){return e=e,K.datetimePanelValue.setSeconds(t.value),void l(e)}},t.label)}))])]},Ut=function(){var e=tt.value,t=et.value;return(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:["vxe-input--number-prev is--prev",{"is--disabled":e}],onMousedown:$,onMouseup:a,onMouseleave:a},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:["vxe-input--number-next is--next",{"is--disabled":t}],onMousedown:$,onMouseup:a,onMouseleave:a},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])},Et=function(){return(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:E},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})])},St=function(){return(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:P},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})])},Dt=function(){var e=K.showPwd;return(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:D},[(0,_vue.h)("i",{class:["vxe-input--password-icon",e?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])},r={dispatchEvent:function(e,t,a){ce(e,Object.assign({$input:i,$event:a},t))},focus:function(){var e=T.value;return K.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur:function(){return T.value.blur(),(K.isActivated=!1,_vue.nextTick)()},select:function(){return T.value.select(),(K.isActivated=!1,_vue.nextTick)()},showPanel:yt,hidePanel:b,updatePlacement:n};Object.assign(i,r),(0,_vue.watch)(function(){return W.modelValue},function(e){K.inputValue=e,y()}),(0,_vue.watch)(function(){return W.type},function(){Object.assign(K,{inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),t()}),(0,_vue.watch)(v,function(){I.value&&(p(K.datePanelValue),K.inputValue=W.multiple?Ne.value:K.datePanelLabel)}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(i,"mousewheel",le),_event.GlobalEvent.on(i,"mousedown",ne),_event.GlobalEvent.on(i,"keydown",ue),_event.GlobalEvent.on(i,"blur",ie)}),(0,_vue.onUnmounted)(function(){a(),_event.GlobalEvent.off(i,"mousewheel"),_event.GlobalEvent.off(i,"mousedown"),_event.GlobalEvent.off(i,"keydown"),_event.GlobalEvent.off(i,"blur")}),t();return i.renderVN=function(){var e,t,a,n,u,l=W.className,i=W.controls,r=W.type,s=W.align,o=W.showWordCount,c=W.countMethod,d=W.name,v=W.disabled,f=W.readonly,p=W.autocomplete,_=K.inputValue,m=K.visiblePanel,h=K.isActivated,x=pe.value,y=xe.value,g=he.value,b=I.value,U=Ge.value,E=Ze.value,S=Qe.value,D=$e.value,P=[],N=(u=W.prefixIcon,N=oe.prefix,n=[],N?n.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},N({}))):u&&n.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",u]})),n.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:ut},n):null),V=(u=W.disabled,n=W.suffixIcon,t=K.inputValue,V=oe.suffix,a=Ue.value,w=[],V?w.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},V({}))):n&&w.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",n]})),a&&w.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),w.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":a&&!u&&!(""===t||_xeUtils.default.eqNull(t))}],onClick:lt},w):null),w=(N&&P.push(N),P.push((0,_vue.h)("input",{ref:T,class:"vxe-input--inner",value:_,name:d,type:S,placeholder:D,maxlength:E,readonly:U,disabled:v,autocomplete:p,onKeydown:G,onKeyup:Q,onWheel:Z,onClick:ae,onInput:H,onChange:L,onFocus:j,onBlur:B})),V&&P.push(V),P.push((n=W.controls,a=F.value,u=I.value,t=R.value,w=ye.value,t?e=Dt():a?n&&(e=Ut()):u?e=Et():w&&(e=St()),e?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[e]):null)),b&&P.push((d=W.type,S=W.transfer,D=K.inited,U=K.animatVisible,p=K.visiblePanel,t=K.panelPlacement,a=K.panelStyle,n=pe.value,u=[],I.value?(u.push("datetime"===d?(0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},gt()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},bt())]):"time"===d?(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},bt()):(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},gt())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!S||!D},[(0,_vue.h)("div",{ref:M,class:["vxe-table--ignore-clear vxe-input--panel","type--".concat(d),((D={})["size--".concat(n)]=n,D["is--transfer"]=S,D["animat--leave"]=U,D["animat--enter"]=p,D)],placement:t,style:a},u)])):null)),!1);return o&&["text","search"].includes(r)&&(w=!0,P.push((0,_vue.h)("span",{class:["vxe-input--count",{"is--error":y}]},c?"".concat(c({value:_})):"".concat(g).concat(E?"/".concat(E):"")))),(0,_vue.h)("div",{ref:k,class:["vxe-input","type--".concat(r),l,((e={})["size--".concat(x)]=x,e["is--".concat(s)]=s,e["is--controls"]=i,e["is--prefix"]=!!N,e["is--suffix"]=!!V,e["is--readonly"]=f,e["is--visivle"]=m,e["is--count"]=w,e["is--disabled"]=v,e["is--active"]=h,e)]},P)},i},render:function(){return this.renderVN()}});exports.default=_default;